<?xml version='1.0' encoding='utf-8'?>
<html epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg">
<head>
<meta content="PXE Basic 1.0" name="dcterms.conformsTo"/>
<meta content="PXE Tools version 1.39.52" name="generator"/>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
<title>Chapter 11 Network Programming</title>
<link href="../css/theme/night.css" rel="alternate stylesheet" title="night" type="text/css"/>
<link href="../css/theme/sepia.css" rel="alternate stylesheet" title="sepia" type="text/css"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body class="pcalibre1 pcalibre2 pcalibre" epub:type="bodymatter">
<section class="pcalibre1 pcalibre2 pcalibre3" epub:type="chapter" id="P7000497027000000000000000007B7A"><header class="pcalibre1 pcalibre2 pcalibre48"><h1 class="pcalibre1 pcalibre2 pcalibre49" data-uri="chapter11.xhtml#P7000497027000000000000000046683" epub:type="title" id="P7000497027000000000000000046683"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007B7C" epub:type="pagebreak" id="P7000497027000000000000000007B7C" title="917"></span><span class="pcalibre1 pcalibre21 pcalibre2">Chapter </span><span class="pcalibre1 pcalibre50 pcalibre2">11 </span>Network Programming</h1></header>
<section class="pcalibre1 pcalibre2 pcalibre3" id="d9e166589">
<nav class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000046684" epub:type="toc" id="P7000497027000000000000000046684">
<div class="pcalibre1 pcalibre2 pcalibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046685" id="P7000497027000000000000000046685">
<ol class="pcalibre23 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046686" id="P7000497027000000000000000046686">
<li class="pcalibre1 pcalibre2 pcalibre24" data-class="toclevel1" data-uri="chapter11.xhtml#P7000497027000000000000000046687" id="P7000497027000000000000000046687"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046688" id="P7000497027000000000000000046688"><a class="pcalibre1 pcalibre2 pcalibre25 pcalibre16 pcalibre14 pcalibre15" href="fileP7000497027000000000000000007B9A.xhtml#P7000497027000000000000000007B9A"><span class="pcalibre1 pcalibre2" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">11.1 </span>The Client-Server Programming Model </span><span class="pcalibre1 pcalibre2" epub:type="pagebreak">918</span></a></p></li>
<li class="pcalibre1 pcalibre2 pcalibre24" data-class="toclevel1" data-uri="chapter11.xhtml#P7000497027000000000000000046689" id="P7000497027000000000000000046689"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004668A" id="P700049702700000000000000004668A"><a class="pcalibre1 pcalibre2 pcalibre25 pcalibre16 pcalibre14 pcalibre15" href="fileP7000497027000000000000000007BB0.xhtml#P7000497027000000000000000007BB0"><span class="pcalibre1 pcalibre2" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">11.2 </span>Networks </span><span class="pcalibre1 pcalibre2" epub:type="pagebreak">919</span></a></p></li>
<li class="pcalibre1 pcalibre2 pcalibre24" data-class="toclevel1" data-uri="chapter11.xhtml#P700049702700000000000000004668B" id="P700049702700000000000000004668B"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004668C" id="P700049702700000000000000004668C"><a class="pcalibre1 pcalibre2 pcalibre25 pcalibre16 pcalibre14 pcalibre15" href="fileP7000497027000000000000000007BFE.xhtml#P7000497027000000000000000007BFE"><span class="pcalibre1 pcalibre2" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">11.3 </span>The Global IP Internet </span><span class="pcalibre1 pcalibre2" epub:type="pagebreak">924</span></a></p></li>
<li class="pcalibre1 pcalibre2 pcalibre24" data-class="toclevel1" data-uri="chapter11.xhtml#P700049702700000000000000004668D" id="P700049702700000000000000004668D"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004668E" id="P700049702700000000000000004668E"><a class="pcalibre1 pcalibre2 pcalibre25 pcalibre16 pcalibre14 pcalibre15" href="fileP7000497027000000000000000007CC1.xhtml#P7000497027000000000000000007CC1"><span class="pcalibre1 pcalibre2" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">11.4 </span>The Sockets Interface </span><span class="pcalibre1 pcalibre2" epub:type="pagebreak">932</span></a></p></li>
<li class="pcalibre1 pcalibre2 pcalibre24" data-class="toclevel1" data-uri="chapter11.xhtml#P700049702700000000000000004668F" id="P700049702700000000000000004668F"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046690" id="P7000497027000000000000000046690"><a class="pcalibre1 pcalibre2 pcalibre25 pcalibre16 pcalibre14 pcalibre15" href="fileP7000497027000000000000000007E82.xhtml#P7000497027000000000000000007E82"><span class="pcalibre1 pcalibre2" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">11.5 </span>Web Servers </span><span class="pcalibre1 pcalibre2" epub:type="pagebreak">948</span></a></p></li>
<li class="pcalibre1 pcalibre2 pcalibre24" data-class="toclevel1" data-uri="chapter11.xhtml#P7000497027000000000000000046691" id="P7000497027000000000000000046691"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046692" id="P7000497027000000000000000046692"><a class="pcalibre1 pcalibre2 pcalibre25 pcalibre16 pcalibre14 pcalibre15" href="fileP7000497027000000000000000007F64.xhtml#P7000497027000000000000000007F64"><span class="pcalibre1 pcalibre2" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">11.6 </span>Putting It Together: The Tiny Web Server </span><span class="pcalibre1 pcalibre2" epub:type="pagebreak">956</span></a></p></li>
</ol></div>
<div class="pcalibre1 pcalibre2 pcalibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046693" id="P7000497027000000000000000046693">
<ol class="pcalibre23 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046694" id="P7000497027000000000000000046694">
<li class="pcalibre1 pcalibre2 pcalibre24" data-uri="chapter11.xhtml#P7000497027000000000000000046695" id="P7000497027000000000000000046695"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046696" id="P7000497027000000000000000046696"><a class="pcalibre1 pcalibre2 pcalibre25 pcalibre16 pcalibre14 pcalibre15" href="fileP7000497027000000000000000007FE5.xhtml#P7000497027000000000000000007FE5"><span class="pcalibre1 pcalibre2" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">11.7 </span><span class="pcalibre1 pcalibre21 pcalibre2">Summary</span> </span><span class="pcalibre1 pcalibre2" epub:type="pagebreak">964</span></a></p></li>
<li class="pcalibre1 pcalibre2 pcalibre24" data-uri="chapter11.xhtml#P7000497027000000000000000046697" id="P7000497027000000000000000046697"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046698" id="P7000497027000000000000000046698"><a class="pcalibre1 pcalibre2 pcalibre25 pcalibre16 pcalibre14 pcalibre15" href="fileP7000497027000000000000000007FEC.xhtml#P7000497027000000000000000007FEC"><span class="pcalibre1 pcalibre2" epub:type="title">Bibliographic Notes </span><span class="pcalibre1 pcalibre2" epub:type="pagebreak">965</span></a></p></li>
<li class="pcalibre1 pcalibre2 pcalibre24" data-uri="chapter11.xhtml#P7000497027000000000000000046699" id="P7000497027000000000000000046699"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004669A" id="P700049702700000000000000004669A"><a class="pcalibre1 pcalibre2 pcalibre25 pcalibre16 pcalibre14 pcalibre15" href="fileP7000497027000000000000000007FF4.xhtml#P7000497027000000000000000007FF4"><span class="pcalibre1 pcalibre2" epub:type="title">Homework Problems </span><span class="pcalibre1 pcalibre2" epub:type="pagebreak">965</span></a></p></li>
<li class="pcalibre1 pcalibre2 pcalibre24" data-uri="chapter11.xhtml#P700049702700000000000000004669B" id="P700049702700000000000000004669B"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004669C" id="P700049702700000000000000004669C"><a class="pcalibre1 pcalibre2 pcalibre25 pcalibre16 pcalibre14 pcalibre15" href="fileP7000497027000000000000000008021.xhtml#P7000497027000000000000000008021"><span class="pcalibre1 pcalibre2" epub:type="title">Solutions to Practice Problems </span><span class="pcalibre1 pcalibre2" epub:type="pagebreak">966</span></a></p></li>
</ol></div>
</nav>
<section class="pcalibre1 pcalibre2 pcalibre51" data-uri="chapter11.xhtml#P700049702700000000000000004669D" epub:type="introduction" id="P700049702700000000000000004669D">
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004669E" id="P700049702700000000000000004669E"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007B98" epub:type="pagebreak" id="P7000497027000000000000000007B98" title="918"></span>Network applications are everywhere. Any time you browse the Web, send an email message, or play an online game, you are using a network application. Interestingly, all network applications are based on the same basic programming model, have similar overall logical structures, and rely on the same programming interface.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004669F" id="P700049702700000000000000004669F">Network applications rely on many of the concepts that you have already learned in our study of systems. For example, processes, signals, byte ordering, memory mapping, and dynamic storage allocation all play important roles. There are new concepts to master as well. You will need to understand the basic client-server programming model and how to write client-server programs that use the services provided by the Internet. At the end, we will tie all of these ideas together by developing a tiny but functional Web server that can serve both static and dynamic content with text and graphics to real Web browsers.</p>
</section>
</section>
<!--EOF:P7000497027000000000000000007B9A-->
<!--EOF:P7000497027000000000000000007BB0-->
<!--EOF:P7000497027000000000000000007BFE-->
<!--EOF:P7000497027000000000000000007CC1-->
<!--EOF:P7000497027000000000000000007E82-->
<!--EOF:P7000497027000000000000000007F64-->
<!--EOF:P7000497027000000000000000007FE5-->
<!--EOF:P7000497027000000000000000007FEC-->
<!--EOF:P7000497027000000000000000007FF4-->
<!--EOF:P7000497027000000000000000008021-->
</section></body></html>
<?xml version='1.0' encoding='utf-8'?>
<html epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg">
<head>
<meta content="PXE Basic 1.0" name="dcterms.conformsTo"/>
<meta content="PXE Tools version 1.39.52" name="generator"/>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
<title>11.1 The Client-Server Programming Model</title>
<link href="../css/theme/night.css" rel="alternate stylesheet" title="night" type="text/css"/>
<link href="../css/theme/sepia.css" rel="alternate stylesheet" title="sepia" type="text/css"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body class="pcalibre1 pcalibre2 pcalibre" epub:type="bodymatter">
<section class="pcalibre1 pcalibre2 pcalibre3" id="P7000497027000000000000000007B9A"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre2 pcalibre4" data-uri="chapter11.xhtml#P70004970270000000000000000466A0" epub:type="title" id="P70004970270000000000000000466A0"><span class="pcalibre1 pcalibre21 pcalibre2">11.1 </span>The Client-Server Programming Model</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466A1" id="P70004970270000000000000000466A1">Every network application is based on the <i class="pcalibre17 pcalibre2 pcalibre1">client-server model</i>. With this model, an application consists of a <i class="pcalibre17 pcalibre2 pcalibre1">server</i> process and one or more <i class="pcalibre17 pcalibre2 pcalibre1">client</i> processes. A server manages some <i class="pcalibre17 pcalibre2 pcalibre1">resource</i>, and it provides some <i class="pcalibre17 pcalibre2 pcalibre1">service</i> for its clients by manipulating that resource. For example, a Web server manages a set of disk files that it retrieves and executes on behalf of clients. An FTP server manages a set of disk files that it stores and retrieves for clients. Similarly, an email server manages a spool file that it reads and updates for clients.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466A2" id="P70004970270000000000000000466A2">The fundamental operation in the client-server model is the <i class="pcalibre17 pcalibre2 pcalibre1">transaction</i> (<a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007BA5"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.1</span></a>). A client-server transaction consists of four steps:</p>
<ol class="pcalibre1 calibre19 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466A3" id="P70004970270000000000000000466A3">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466A4" id="P70004970270000000000000000466A4"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466A5" id="P70004970270000000000000000466A5">When a client needs service, it initiates a transaction by sending a <i class="pcalibre17 pcalibre2 pcalibre1">request</i> to the server. For example, when a Web browser needs a file, it sends a request to a Web server.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466A6" id="P70004970270000000000000000466A6"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466A7" id="P70004970270000000000000000466A7">The server receives the request, interprets it, and manipulates its resources in the appropriate way. For example, when a Web server receives a request from a browser, it reads a disk file.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466A8" id="P70004970270000000000000000466A8"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466A9" id="P70004970270000000000000000466A9">The server sends a <i class="pcalibre17 pcalibre2 pcalibre1">response</i> to the client and then waits for the next request. For example, a Web server sends the file back to a client.</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007BA5" id="P7000497027000000000000000007BA5">
<img alt="A diagram illustrates steps in a client-server transaction." class="pcalibre1 pcalibre2 pcalibre298" data-uri="P700049702700000000000000000B7BA" id="P70004970270000000000000000466AA" src="Images/chapter-10-image-01.png"/>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P70004970270000000000000000466AB" id="P70004970270000000000000000466AB"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P70004970270000000000000000466AC" epub:type="title" id="P70004970270000000000000000466AC"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.1 </span>A client-server transaction.</h1></header>
<details class="pcalibre1 pcalibre2 pcalibre59" data-uri="chapter11.xhtml#P7000497027000000000000000026A12" id="P7000497027000000000000000026A12">
<summary class="pcalibre1 pcalibre2 pcalibre61 pcalibre60"><span class="pcalibre1 pcalibre2 pcalibre37">Description</span></summary>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466AD" id="P70004970270000000000000000466AD">Steps in the transaction are listed below.</p>
<ol class="pcalibre75 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466AE" id="P70004970270000000000000000466AE">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466AF" id="P70004970270000000000000000466AF"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466B0" id="P70004970270000000000000000466B0">Client sends request (client process to server process)</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466B1" id="P70004970270000000000000000466B1"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466B2" id="P70004970270000000000000000466B2">Server processes request (server process interaction with resource)</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466B3" id="P70004970270000000000000000466B3"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466B4" id="P70004970270000000000000000466B4">Server sends response (server process to client process)</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466B5" id="P70004970270000000000000000466B5"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466B6" id="P70004970270000000000000000466B6">Client processes response</p></li>
</ol>
</details>
</figcaption>
</figure>
<aside class="pcalibre31 pcalibre32 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000007BA9" id="P7000497027000000000000000007BA9"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre33" data-uri="chapter11.xhtml#P70004970270000000000000000466B7" epub:type="title" id="P70004970270000000000000000466B7"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007BAB" epub:type="pagebreak" id="P7000497027000000000000000007BAB" title="919"></span><span class="pcalibre1 pcalibre2 pcalibre34">Aside </span>Client-server transactions versus database transactions</h1></header>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466B8" id="P70004970270000000000000000466B8">Client-server transactions are <i class="pcalibre17 pcalibre2 pcalibre1">not</i> database transactions and do not share any of their properties, such as atomicity. In our context, a transaction is simply a sequence of steps carried out by a client and a server.</p>
</aside></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466B9" id="P70004970270000000000000000466B9"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466BA" id="P70004970270000000000000000466BA">The client receives the response and manipulates it. For example, after a Web browser receives a page from the server, it displays it on the screen.</p></li>
</ol>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466BB" id="P70004970270000000000000000466BB">It is important to realize that clients and servers are processes and not machines, or <i class="pcalibre17 pcalibre2 pcalibre1">hosts</i> as they are often called in this context. A single host can run many different clients and servers concurrently, and a client and server transaction can be on the same or different hosts. The client-server model is the same, regardless of the mapping of clients and servers to hosts.</p>
</section></body></html>
<?xml version='1.0' encoding='utf-8'?>
<html epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg">
<head>
<meta content="PXE Basic 1.0" name="dcterms.conformsTo"/>
<meta content="PXE Tools version 1.39.52" name="generator"/>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
<title>11.2 Networks</title>
<link href="../css/theme/night.css" rel="alternate stylesheet" title="night" type="text/css"/>
<link href="../css/theme/sepia.css" rel="alternate stylesheet" title="sepia" type="text/css"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body class="pcalibre1 pcalibre2 pcalibre" epub:type="bodymatter">
<section class="pcalibre1 pcalibre2 pcalibre3" id="P7000497027000000000000000007BB0"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre2 pcalibre4" data-uri="chapter11.xhtml#P70004970270000000000000000466BC" epub:type="title" id="P70004970270000000000000000466BC"><span class="pcalibre1 pcalibre21 pcalibre2">11.2 </span>Networks</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466BD" id="P70004970270000000000000000466BD">Clients and servers often run on separate hosts and communicate using the hardware and software resources of a <i class="pcalibre17 pcalibre2 pcalibre1">computer network</i>. Networks are sophisticated systems, and we can only hope to scratch the surface here. Our aim is to give you a workable mental model from a programmer's perspective.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466BE" id="P70004970270000000000000000466BE">To a host, a network is just another I/O device that serves as a source and sink for data, as shown in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007BB4"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.2</span></a>.</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007BB4" id="P7000497027000000000000000007BB4">
<img alt="A diagram illustrates hardware organization of a network host." class="pcalibre1 pcalibre2 calibre83" data-uri="P700049702700000000000000000B7BB" id="P70004970270000000000000000466BF" src="Images/chapter-10-image-02.png"/>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P70004970270000000000000000466C0" id="P70004970270000000000000000466C0"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P70004970270000000000000000466C1" epub:type="title" id="P70004970270000000000000000466C1"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.2 </span>Hardware organization of a network host.</h1></header>
<details class="pcalibre1 pcalibre2 pcalibre59" data-uri="chapter11.xhtml#P7000497027000000000000000026A28" id="P7000497027000000000000000026A28">
<summary class="pcalibre1 pcalibre2 pcalibre61 pcalibre60"><span class="pcalibre1 pcalibre2 pcalibre37">Description</span></summary>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466C2" id="P70004970270000000000000000466C2">Within a hardware organization, a network adapter interacts with a network and with one of the expansion slots of the I/O bus. The I/O bus interacts with USB controller (mouse and keyboard), graphics adapter (monitor), disk controller, and I/O bridge. The I/O bridge interacts with the main memory (via memory bus) and Bus interface (via system bus). Within the CPU chip, the bus interface interacts with the register file, which interacts with ALU.</p>
</details>
</figcaption>
</figure>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007BB8" id="P7000497027000000000000000007BB8">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007BB9" epub:type="pagebreak" id="P7000497027000000000000000007BB9" title="920"></span>
<img alt="A diagram illustrates three hosts connected to a hub, with connections 100 Mb/s." class="pcalibre1 pcalibre2 calibre84" data-uri="P700049702700000000000000000B7BC" id="P70004970270000000000000000466C3" src="Images/chapter-10-image-03.png"/>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P70004970270000000000000000466C4" id="P70004970270000000000000000466C4"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P70004970270000000000000000466C5" epub:type="title" id="P70004970270000000000000000466C5"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.3 </span>Ethernet segment.</h1></header>
</figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466C6" id="P70004970270000000000000000466C6">An adapter plugged into an expansion slot on the I/O bus provides the physical interface to the network. Data received from the network are copied from the adapter across the I/O and memory buses into memory, typically by a DMA transfer. Similarly, data can also be copied from memory to the network.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466C7" id="P70004970270000000000000000466C7">Physically, a network is a hierarchical system that is organized by geographical proximity. At the lowest level is a LAN (local area network) that spans a building or a campus. The most popular LAN technology by far is <i class="pcalibre17 pcalibre2 pcalibre1">Ethernet</i>, which was developed in the mid-1970s at Xerox PARC. Ethernet has proven to be remarkably resilient, evolving from 3 Mb/s to 10 Gb/s.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466C8" id="P70004970270000000000000000466C8">An <i class="pcalibre17 pcalibre2 pcalibre1">Ethernet segment</i> consists of some wires (usually twisted pairs of wires) and a small box called a <i class="pcalibre17 pcalibre2 pcalibre1">hub</i>, as shown in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007BB8"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.3</span></a>. Ethernet segments typically span small areas, such as a room or a floor in a building. Each wire has the same maximum bit bandwidth, typically 100 Mb/s or 1 Gb/s. One end is attached to an adapter on a host, and the other end is attached to a <i class="pcalibre17 pcalibre2 pcalibre1">port</i> on the hub. A hub slavishly copies every bit that it receives on each port to every other port. Thus, every host sees every bit.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466C9" id="P70004970270000000000000000466C9">Each Ethernet adapter has a globally unique 48-bit address that is stored in a nonvolatile memory on the adapter. A host can send a chunk of bits called a <i class="pcalibre17 pcalibre2 pcalibre1">frame</i> to any other host on the segment. Each frame includes some fixed number of <i class="pcalibre17 pcalibre2 pcalibre1">header</i> bits that identify the source and destination of the frame and the frame length, followed by a <i class="pcalibre17 pcalibre2 pcalibre1">payload</i> of data bits. Every host adapter sees the frame, but only the destination host actually reads it.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466CA" id="P70004970270000000000000000466CA">Multiple Ethernet segments can be connected into larger LANs, called <i class="pcalibre17 pcalibre2 pcalibre1">bridged Ethernets</i>, using a set of wires and small boxes called <i class="pcalibre17 pcalibre2 pcalibre1">bridges</i>, as shown in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007BC7"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.4</span></a>. Bridged Ethernets can span entire buildings or campuses. In a bridged Ethernet, some wires connect bridges to bridges, and others connect bridges to hubs. The bandwidths of the wires can be different. In our example, the bridge-bridge wire has a 1 Gb/s bandwidth, while the four hub-bridge wires have bandwidths of 100 Mb/s.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466CB" id="P70004970270000000000000000466CB">Bridges make better use of the available wire bandwidth than hubs. Using a clever distributed algorithm, they automatically learn over time which hosts are reachable from which ports and then selectively copy frames from one port to another only when it is necessary. For example, if host A sends a frame to host B, which is on the segment, then bridge X will throw away the frame when it arrives at its input port, thus saving bandwidth on the other segments. However, if host A sends a frame to host C on a different segment, then bridge X will copy the frame only to the port connected to bridge Y, which will copy the frame only to the port connected to host C's segment.</p>
<aside class="pcalibre31 pcalibre32 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000007BC3" id="P7000497027000000000000000007BC3"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre33" data-uri="chapter11.xhtml#P70004970270000000000000000466CC" epub:type="title" id="P70004970270000000000000000466CC"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007BC5" epub:type="pagebreak" id="P7000497027000000000000000007BC5" title="921"></span><span class="pcalibre1 pcalibre2 pcalibre34">Aside </span>Internet versus internet</h1></header>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466CD" id="P70004970270000000000000000466CD">We will always use lowercase <i class="pcalibre17 pcalibre2 pcalibre1">internet</i> to denote the general concept, and uppercase <i class="pcalibre17 pcalibre2 pcalibre1">Internet</i> to denote a specific implementationâ€”namely, the global IP Internet.</p>
</aside>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007BC7" id="P7000497027000000000000000007BC7">
<img alt="A diagram illustrates bridged Ethernet segments." class="pcalibre1 pcalibre2 pcalibre299" data-uri="P700049702700000000000000000B7BD" id="P70004970270000000000000000466CE" src="Images/chapter-10-image-04.png"/>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P70004970270000000000000000466CF" id="P70004970270000000000000000466CF"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P70004970270000000000000000466D0" epub:type="title" id="P70004970270000000000000000466D0"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.4 </span>Bridged Ethernet segments.</h1></header>
<details class="pcalibre1 pcalibre2 pcalibre59" data-uri="chapter11.xhtml#P7000497027000000000000000026A38" id="P7000497027000000000000000026A38">
<summary class="pcalibre1 pcalibre2 pcalibre61 pcalibre60"><span class="pcalibre1 pcalibre2 pcalibre37">Description</span></summary>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466D1" id="P70004970270000000000000000466D1">A diagram shows bridges X and Y connected by 1 Gb/s connection. Bridge X is connected to two hubs via 100 Mb/s connections; one hub connected to three hosts, including A and B, and the other connected to two hosts. Bridge Y is connected to two hubs via 100 Mb/s connections; one hub connected to five hosts, including C, and the other connected to two hosts.</p>
</details>
</figcaption>
</figure>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007BCB" id="P7000497027000000000000000007BCB">
<img alt="A diagram shows hosts connected to a common line." class="pcalibre300 pcalibre2 pcalibre1" data-uri="P700049702700000000000000000B7BE" id="P70004970270000000000000000466D2" src="Images/chapter-10-image-05.png"/>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P70004970270000000000000000466D3" id="P70004970270000000000000000466D3"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P70004970270000000000000000466D4" epub:type="title" id="P70004970270000000000000000466D4"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.5 </span>Conceptual view of a LAN.</h1></header>
</figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466D5" id="P70004970270000000000000000466D5">To simplify our pictures of LANs, we will draw the hubs and bridges and the wires that connect them as a single horizontal line, as shown in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007BCB"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.5</span></a>.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466D6" id="P70004970270000000000000000466D6">At a higher level in the hierarchy, multiple incompatible LANs can be connected by specialized computers called <i class="pcalibre17 pcalibre2 pcalibre1">routers</i> to form an <i class="pcalibre17 pcalibre2 pcalibre1">internet</i> (interconnected network). Each router has an adapter (port) for each network that it is connected to. Routers can also connect high-speed point-to-point phone connections, which are examples of networks known as WANs (wide area networks), so called because they span larger geographical areas than LANs. In general, routers can be used to build internets from arbitrary collections of LANs and WANs. For example, <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007BD1"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.6</span></a> shows an example internet with a pair of LANs and WANs connected by three routers.</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007BD1" id="P7000497027000000000000000007BD1">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007BD2" epub:type="pagebreak" id="P7000497027000000000000000007BD2" title="922"></span>
<img alt="A diagram shows two LAN connected to separate hosts and separate routers. The routers are connected to a third via WAN." class="pcalibre301 pcalibre1 pcalibre2" data-uri="P700049702700000000000000000B7BF" id="P70004970270000000000000000466D7" src="Images/chapter-10-image-06.png"/>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P70004970270000000000000000466D8" id="P70004970270000000000000000466D8"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P70004970270000000000000000466D9" epub:type="title" id="P70004970270000000000000000466D9"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.6 </span>A small internet.</h1></header>
<div class="pcalibre1 caption pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466DA" id="P70004970270000000000000000466DA"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466DB" id="P70004970270000000000000000466DB">Two LANs and two WANs are connected by three routers.</p></div>
</figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466DC" id="P70004970270000000000000000466DC">The crucial property of an internet is that it can consist of different LANs and WANs with radically different and incompatible technologies. Each host is physically connected to every other host, but how is it possible for some <i class="pcalibre17 pcalibre2 pcalibre1">source host</i> to send data bits to another <i class="pcalibre17 pcalibre2 pcalibre1">destination host</i> across all of these incompatible networks?</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466DD" id="P70004970270000000000000000466DD">The solution is a layer of <i class="pcalibre17 pcalibre2 pcalibre1">protocol software</i> running on each host and router that smoothes out the differences between the different networks. This software implements a <i class="pcalibre17 pcalibre2 pcalibre1">protocol</i> that governs how hosts and routers cooperate in order to transfer data. The protocol must provide two basic capabilities:</p>
<ul class="pcalibre38 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466DE" id="P70004970270000000000000000466DE">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466DF" id="P70004970270000000000000000466DF"><p class="pcalibre1 pcalibre2 pcalibre40" data-uri="chapter11.xhtml#P70004970270000000000000000466E0" id="P70004970270000000000000000466E0"><span class="pcalibre1 pcalibre2 pcalibre41">Naming scheme. </span>Different LAN technologies have different and incompatible ways of assigning addresses to hosts. The internet protocol smoothes these differences by defining a uniform format for host addresses. Each host is then assigned at least one of these <i class="pcalibre17 pcalibre2 pcalibre1">internet addresses</i> that uniquely identifies it.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466E1" id="P70004970270000000000000000466E1"><p class="pcalibre1 pcalibre2 pcalibre40" data-uri="chapter11.xhtml#P70004970270000000000000000466E2" id="P70004970270000000000000000466E2"><span class="pcalibre1 pcalibre2 pcalibre41">Delivery mechanism. </span>Different networking technologies have different and incompatible ways of encoding bits on wires and of packaging these bits into frames. The internet protocol smoothes these differences by defining a uniform way to bundle up data bits into discrete chunks called <i class="pcalibre17 pcalibre2 pcalibre1">packets</i>. A packet consists of a <i class="pcalibre17 pcalibre2 pcalibre1">header</i>, which contains the packet size and addresses of the source and destination hosts, and a <i class="pcalibre17 pcalibre2 pcalibre1">payload</i>, which contains data bits sent from the source host.</p></li>
</ul>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466E3" id="P70004970270000000000000000466E3"><a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007BE5"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.7</span></a> shows an example of how hosts and routers use the internet protocol to transfer data across incompatible LANs. The example internet consists of two LANs connected by a router. A client running on host A, which is attached to LAN1, sends a sequence of data bytes to a server running on host B, which is attached to LAN2. There are eight basic steps:</p>
<ol class="pcalibre1 calibre19 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000466E4" id="P70004970270000000000000000466E4">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466E5" id="P70004970270000000000000000466E5"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466E6" id="P70004970270000000000000000466E6">The client on host A invokes a system call that copies the data from the client's virtual address space into a kernel buffer.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466E7" id="P70004970270000000000000000466E7"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466E8" id="P70004970270000000000000000466E8">The protocol software on host A creates a LAN1 frame by appending an internet header and a LAN1 frame header to the data. The internet header is addressed to internet host B. The LAN1 frame header is addressed to the router. It then passes the frame to the adapter. Notice that the payload of the LAN1 frame is an internet packet, whose payload is the actual user data. This kind of <i class="pcalibre17 pcalibre2 pcalibre1">encapsulation</i> is one of the fundamental insights of internetworking.</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007BE5" id="P7000497027000000000000000007BE5">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007BE6" epub:type="pagebreak" id="P7000497027000000000000000007BE6" title="923"></span>
<img alt="A diagram illustrates how data travel from one host to another on an Internet." class="pcalibre1 pcalibre2 pcalibre302" data-uri="P700049702700000000000000000B7C0" id="P70004970270000000000000000466E9" src="Images/chapter-10-image-07.png"/>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P70004970270000000000000000466EA" id="P70004970270000000000000000466EA"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P70004970270000000000000000466EB" epub:type="title" id="P70004970270000000000000000466EB"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.7 </span>How data travel from one host to another on an internet.</h1></header>
<div class="pcalibre1 pcalibre2 pcalibre7" data-uri="chapter11.xhtml#P70004970270000000000000000466EC" id="P70004970270000000000000000466EC"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466ED" id="P70004970270000000000000000466ED">PH: internet packet header; FH1: frame header for LAN1; FH2: frame header for LAN2.</p></div>
<details class="pcalibre1 pcalibre2 pcalibre59" data-uri="chapter11.xhtml#P7000497027000000000000000026A56" id="P7000497027000000000000000026A56">
<summary class="pcalibre1 pcalibre2 pcalibre61 pcalibre60"><span class="pcalibre1 pcalibre2 pcalibre37">Description</span></summary>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466EE" id="P70004970270000000000000000466EE">A diagram shows a path form Host A client to Host B server, via the steps summarized below.</p>
<ol class="pcalibre75 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466EF" id="P70004970270000000000000000466EF">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466F0" id="P70004970270000000000000000466F0"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466F1" id="P70004970270000000000000000466F1">Data from client (Host A) to protocol software</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466F2" id="P70004970270000000000000000466F2"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466F3" id="P70004970270000000000000000466F3">LAN1 frame including Internet packet (Data and PH) and FH1 to LAN1 adapter</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466F4" id="P70004970270000000000000000466F4"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466F5" id="P70004970270000000000000000466F5">LAN1 frame to LAN1 adapter within router</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466F6" id="P70004970270000000000000000466F6"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466F7" id="P70004970270000000000000000466F7">LAN1 frame to protocol software in router</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466F8" id="P70004970270000000000000000466F8"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466F9" id="P70004970270000000000000000466F9">LAN2 frame (now with FH2 instead of FH1) to LAN2 adapter in router</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466FA" id="P70004970270000000000000000466FA"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466FB" id="P70004970270000000000000000466FB">LAN2 frame to LAN2 adapter under server (Host B)</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466FC" id="P70004970270000000000000000466FC"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466FD" id="P70004970270000000000000000466FD">LAN2 frame to protocol software</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000466FE" id="P70004970270000000000000000466FE"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000466FF" id="P70004970270000000000000000466FF">Data to server</p></li>
</ol>
</details>
</figcaption>
</figure></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046700" id="P7000497027000000000000000046700"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046701" id="P7000497027000000000000000046701">The LAN1 adapter copies the frame to the network.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046702" id="P7000497027000000000000000046702"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046703" id="P7000497027000000000000000046703">When the frame reaches the router, the router's LAN1 adapter reads it from the wire and passes it to the protocol software.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046704" id="P7000497027000000000000000046704"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046705" id="P7000497027000000000000000046705">The router fetches the destination internet address from the internet packet header and uses this as an index into a routing table to determine where to forward the packet, which in this case is LAN2. The router then strips off the old LAN1 frame header, prepends a new LAN2 frame header addressed to host B, and passes the resulting frame to the adapter.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046706" id="P7000497027000000000000000046706"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046707" id="P7000497027000000000000000046707">The router's LAN2 adapter copies the frame to the network.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046708" id="P7000497027000000000000000046708"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046709" id="P7000497027000000000000000046709">When the frame reaches host B, its adapter reads the frame from the wire and passes it to the protocol software.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004670A" id="P700049702700000000000000004670A"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004670B" id="P700049702700000000000000004670B">Finally, the protocol software on host B strips off the packet header and frame header. The protocol software will eventually copy the resulting data into the server's virtual address space when the server invokes a system call that reads the data.</p></li>
</ol>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004670C" id="P700049702700000000000000004670C">Of course, we are glossing over many difficult issues here. What if different networks have different maximum frame sizes? How do routers know where to forward frames? How are routers informed when the network topology changes? What if a packet gets lost? Nonetheless, our example captures the essence of the internet idea, and encapsulation is the key.</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007BF9" id="P7000497027000000000000000007BF9">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007BFA" epub:type="pagebreak" id="P7000497027000000000000000007BFA" title="924"></span>
<img alt="A diagram illustrates hardware and software organization of an Internet application." class="pcalibre1 pcalibre303 pcalibre2" data-uri="P700049702700000000000000000B7C1" id="P700049702700000000000000004670D" src="Images/chapter-10-image-08.png"/>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P700049702700000000000000004670E" id="P700049702700000000000000004670E"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P700049702700000000000000004670F" epub:type="title" id="P700049702700000000000000004670F"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.8 </span>Hardware and software organization of an Internet application.</h1></header>
<details class="pcalibre1 pcalibre2 pcalibre59" data-uri="chapter11.xhtml#P7000497027000000000000000026A79" id="P7000497027000000000000000026A79">
<summary class="pcalibre1 pcalibre2 pcalibre61 pcalibre60"><span class="pcalibre1 pcalibre2 pcalibre37">Description</span></summary>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046710" id="P7000497027000000000000000046710">A diagram shows an Internet client host and Internet server host each interacting with Global IP Internet via TCP/IP and Network adapter. The organization of the Internet client host is summarized below.</p>
<ul class="pcalibre1 pcalibre2 pcalibre62" data-uri="chapter11.xhtml#P7000497027000000000000000046711" id="P7000497027000000000000000046711">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046712" id="P7000497027000000000000000046712"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046713" id="P7000497027000000000000000046713">Client (user code)</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046714" id="P7000497027000000000000000046714"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046715" id="P7000497027000000000000000046715">Sockets interface (system calls)</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046716" id="P7000497027000000000000000046716"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046717" id="P7000497027000000000000000046717">TCP/IP (kernel code)</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046718" id="P7000497027000000000000000046718"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046719" id="P7000497027000000000000000046719">Hardware interface (interrupts)</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004671A" id="P700049702700000000000000004671A"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004671B" id="P700049702700000000000000004671B">Network adapter (hardware)</p></li>
</ul>
</details>
</figcaption>
</figure>
</section></body></html>
<?xml version='1.0' encoding='utf-8'?>
<html epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg">
<head>
<meta content="PXE Basic 1.0" name="dcterms.conformsTo"/>
<meta content="PXE Tools version 1.39.52" name="generator"/>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
<title>11.3 The Global IP Internet</title>
<link href="../css/theme/night.css" rel="alternate stylesheet" title="night" type="text/css"/>
<link href="../css/theme/sepia.css" rel="alternate stylesheet" title="sepia" type="text/css"/>
<script src="js/format_lg_obj.js"></script>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body class="pcalibre1 pcalibre2 pcalibre" epub:type="bodymatter">
<section class="pcalibre1 pcalibre2 pcalibre3" id="P7000497027000000000000000007BFE"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre2 pcalibre4" data-uri="chapter11.xhtml#P700049702700000000000000004671C" epub:type="title" id="P700049702700000000000000004671C"><span class="pcalibre1 pcalibre21 pcalibre2">11.3 </span>The Global IP Internet</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004671D" id="P700049702700000000000000004671D">The global IP Internet is the most famous and successful implementation of an internet. It has existed in one form or another since 1969. While the internal architecture of the Internet is complex and constantly changing, the organization of client-server applications has remained remarkably stable since the early 1980s. <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007BB0.xhtml#P7000497027000000000000000007BF9"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.8</span></a> shows the basic hardware and software organization of an Internet client-server application.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004671E" id="P700049702700000000000000004671E">Each Internet host runs software that implements the <i class="pcalibre17 pcalibre2 pcalibre1">TCP/IP</i> protocol (<i class="pcalibre17 pcalibre2 pcalibre1">Transmission Control Protocol/Internet Protocol</i>), which is supported by almost every modern computer system. Internet clients and servers communicate using a mix of <i class="pcalibre17 pcalibre2 pcalibre1">sockets interface</i> functions and Unix I/O functions. (We will describe the sockets interface in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007CC1.xhtml#P7000497027000000000000000007CC1"><span class="pcalibre1 pcalibre21 pcalibre2">Section </span><span class="pcalibre1 pcalibre21 pcalibre2">11.4</span></a>) The sockets functions are typically implemented as system calls that trap into the kernel and call various kernel-mode functions in TCP/IP.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004671F" id="P700049702700000000000000004671F">TCP/IP is actually a family of protocols, each of which contributes different capabilities. For example, IP provides the basic naming scheme and a delivery mechanism that can send packets, known as <i class="pcalibre17 pcalibre2 pcalibre1">datagrams</i>, from one Internet host to any other host. The IP mechanism is unreliable in the sense that it makes no effort to recover if datagrams are lost or duplicated in the network. UDP (Unreliable Datagram Protocol) extends IP slightly, so that datagrams can be transferred from process to process, rather than host to host. TCP is a complex protocol that builds on IP to provide reliable full duplex (bidirectional) <i class="pcalibre17 pcalibre2 pcalibre1">connections</i> between processes. To simplify our discussion, we will treat TCP/IP as a single monolithic protocol. We will not discuss its inner workings, and we will only discuss some of the basic capabilities that TCP and IP provide to application programs. We will not discuss UDP.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046720" id="P7000497027000000000000000046720">From a programmer's perspective, we can think of the Internet as a worldwide collection of hosts with the following properties:</p>
<ul class="pcalibre1 calibre9 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046721" id="P7000497027000000000000000046721">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046722" id="P7000497027000000000000000046722"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046723" id="P7000497027000000000000000046723">The set of hosts is mapped to a set of 32-bit <i class="pcalibre17 pcalibre2 pcalibre1">IP addresses.</i></p>
<aside class="pcalibre31 pcalibre32 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000007C07" id="P7000497027000000000000000007C07"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre33" data-uri="chapter11.xhtml#P7000497027000000000000000046724" epub:type="title" id="P7000497027000000000000000046724"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007C09" epub:type="pagebreak" id="P7000497027000000000000000007C09" title="925"></span><span class="pcalibre1 pcalibre2 pcalibre34">Aside </span>IPv4 and IPv6</h1></header>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046725" id="P7000497027000000000000000046725">The original Internet protocol, with its 32-bit addresses, is known as Internet Protocol Version 4 (IPv4). In 1996, the Internet Engineering Task Force (IETF) proposed a new version of IP, called Internet Protocol Version 6 (IPv6), that uses 128-bit addresses and that was intended as the successor to IPv4. However, as of 2015, almost 20 years later, the vast majority of Internet traffic is still carried by IPv4 networks. For example, only 4 percent of users access Google services using IPv6 <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="fileP700049702700000000000000000B39D.xhtml#P700049702700000000000000000B3F6">[42]</a>.</p>
<p class="pcalibre1 pcalibre2 pcalibre63" data-uri="chapter11.xhtml#P7000497027000000000000000046726" id="P7000497027000000000000000046726">Because of its low adoption rate, we will not discuss IPv6 in any detail in this book and will focus exclusively on the concepts behind IPv4. When we talk about the Internet, what we mean is the Internet based on IPv4. Nonetheless, the techniques for writing clients and servers that we will teach you later in this chapter are based on modern interfaces that are independent of any particular protocol.</p>
</aside></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046727" id="P7000497027000000000000000046727"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046728" id="P7000497027000000000000000046728">The set of IP addresses is mapped to a set of identifiers called <i class="pcalibre17 pcalibre2 pcalibre1">Internet domain names.</i></p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046729" id="P7000497027000000000000000046729"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004672A" id="P700049702700000000000000004672A">A process on one Internet host can communicate with a process on any other Internet host over a <i class="pcalibre17 pcalibre2 pcalibre1">connection</i>.</p></li>
</ul>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004672B" id="P700049702700000000000000004672B">The following sections discuss these fundamental Internet ideas in more detail.</p>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007C11" id="P7000497027000000000000000007C11"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004672C" epub:type="title" id="P700049702700000000000000004672C"><span class="pcalibre1 pcalibre21 pcalibre2">11.3.1 </span>IP Addresses</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004672D" id="P700049702700000000000000004672D">An IP address is an unsigned 32-bit integer. Network programs store IP addresses in the <i class="pcalibre17 pcalibre2 pcalibre1">IP address structure</i> shown in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007C16"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.9</span></a>.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004672E" id="P700049702700000000000000004672E">Storing a scalar address in a structure is an unfortunate artifact from the early implementations of the sockets interface. It would make more sense to define a scalar type for IP addresses, but it is too late to change now because of the enormous installed base of applications.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004672F" id="P700049702700000000000000004672F">Because Internet hosts can have different host byte orders, TCP/IP defines a uniform <i class="pcalibre17 pcalibre2 pcalibre1">network byte order</i> (big-endian byte order) for any integer data item, such as an IP address, that is carried across the network in a packet header. Addresses in IP address structures are always stored in (big-endian) network byte order, even if the host byte order is little-endian. Unix provides the following functions for converting between network and host byte order.</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007C16" id="P7000497027000000000000000007C16">
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046730" id="P7000497027000000000000000046730"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046731" id="P7000497027000000000000000046731">
/* IP address structure */
struct in_addr {
	uint32_t s_addr; /* Address in network byte order (big-endian) */
};
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046732" id="P7000497027000000000000000046732"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046733" epub:type="title" id="P7000497027000000000000000046733"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.9 </span>IP address structure.</h1></header>
</figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046734" id="P7000497027000000000000000046734"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007C1C" epub:type="pagebreak" id="P7000497027000000000000000007C1C" title="926"></span></p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046735" id="P7000497027000000000000000046735"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046736" id="P7000497027000000000000000046736">
#include &lt;arpa/inet.h&gt;
uint32_t htonl(uint32_t hostlong);
uint16_t htons(uint16_t hostshort);
					Returns: value in network byte order
uint32_t ntohl(uint32_t netlong);
uint16_t ntohs(unit16_t netshort);
					Returns: value in host byte order
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046737" id="P7000497027000000000000000046737">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046738" id="P7000497027000000000000000046738">htonl</code> function converts an unsigned 32-bit integer from host byte order to network byte order. The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046739" id="P7000497027000000000000000046739">ntohl</code> function converts an unsigned 32-bit integer from network byte order to host byte order. The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004673A" id="P700049702700000000000000004673A">htons</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004673B" id="P700049702700000000000000004673B">ntohs</code> functions perform corresponding conversions for unsigned 16-bit integers. Note that there are no equivalent functions for manipulating 64-bit values.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004673C" id="P700049702700000000000000004673C">IP addresses are typically presented to humans in a form known as <i class="pcalibre17 pcalibre2 pcalibre1">dotted-decimal notation</i>, where each byte is represented by its decimal value and separated from the other bytes by a period. For example, <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004673D" id="P700049702700000000000000004673D">128.2.194.242</code> is the dotted-decimal representation of the address <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004673E" id="P700049702700000000000000004673E">0x8002c2f2</code>. On Linux systems, you can use the <span class="pcalibre1 pcalibre29 pcalibre2">hostname </span>command to determine the dotted-decimal address of your own host:</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004673F" id="P700049702700000000000000004673F"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046740" id="P7000497027000000000000000046740">
linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">hostname -i</i>
128.2.210.175
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046741" id="P7000497027000000000000000046741">Application programs can convert back and forth between IP addresses and dotted-decimal strings using the functions <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046742" id="P7000497027000000000000000046742">inet_pton</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046743" id="P7000497027000000000000000046743">inet_ntop</code></p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046744" id="P7000497027000000000000000046744"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046745" id="P7000497027000000000000000046745">
#include &lt;arpa/inet.h&gt;
int inet_pton(AF_INET, const char *src, void *dst);
				Returns: 1 if OK, 0 if src is invalid dotted decimal, âˆ’1 on error
const char *inet_ntop(AF_INET, const void *src, char *dst, socklen_t size);
				Returns: pointer to a dotted-decimal string if OK, NULL on error
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046746" id="P7000497027000000000000000046746">In these function names, the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046747" id="P7000497027000000000000000046747">"n"</code> stands for <i class="pcalibre17 pcalibre2 pcalibre1">network</i> and the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046748" id="P7000497027000000000000000046748">"p"</code> stands for <i class="pcalibre17 pcalibre2 pcalibre1">presentation</i>. They can manipulate either 32-bit IPv4 addresses (<code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046749" id="P7000497027000000000000000046749">AF_INET</code>), as shown here, or 128-bit IPv6 addresses (<code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004674A" id="P700049702700000000000000004674A">AF_INET6</code>), which we do not cover.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004674B" id="P700049702700000000000000004674B">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004674C" id="P700049702700000000000000004674C">inet_pton</code> function converts a dotted-decimal string (<code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004674D" id="P700049702700000000000000004674D">src</code>) to a binary IP address in network byte order (<code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004674E" id="P700049702700000000000000004674E">dst</code>).If <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004674F" id="P700049702700000000000000004674F">src</code> does not point to a valid dotted-decimal string, then it returns 0. Any other error returns âˆ’1 and sets <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046750" id="P7000497027000000000000000046750">errno</code>. Similarly, the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046751" id="P7000497027000000000000000046751">inet_ntop</code> function converts a binary IP address in network byte order (<code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046752" id="P7000497027000000000000000046752">src</code>) to the corresponding dotted-decimal representation and copies at most <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046753" id="P7000497027000000000000000046753">size</code> bytes of the resulting null-terminated string to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046754" id="P7000497027000000000000000046754">dst</code>.</p>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007C3D" epub:type="practice" id="P7000497027000000000000000007C3D"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046755" epub:type="title" id="P7000497027000000000000000046755"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007C3F" epub:type="pagebreak" id="P7000497027000000000000000007C3F" title="927"></span><span class="pcalibre1 pcalibre21 pcalibre2">Practice Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">11.1 </span>(solution page <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" epub:type="pagebreak" href="fileP7000497027000000000000000007FF4.xhtml#P7000497027000000000000000008001">966</a>)</h1></header>
<ol class="pcalibre1 pcalibre2 pcalibre77" data-uri="chapter11.xhtml#P7000497027000000000000000046756" id="P7000497027000000000000000046756">
<li class="pcalibre1 pcalibre2 pcalibre78" data-uri="chapter11.xhtml#P7000497027000000000000000046757" id="P7000497027000000000000000046757">
<div class="pcalibre1 pcalibre2 pcalibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046758" id="P7000497027000000000000000046758"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046759" id="P7000497027000000000000000046759">Complete the following table:</p>
<table class="pcalibre1 pcalibre2 pcalibre43" data-uri="chapter11.xhtml#P700049702700000000000000004675A" id="P700049702700000000000000004675A">
<thead class="pcalibre44 pcalibre2 pcalibre1">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<th class="pcalibre1 pcalibre2 calibre5" data-uri="chapter11.xhtml#P700049702700000000000000004675B" id="P700049702700000000000000004675B">Hex address</th>
<th class="pcalibre1 pcalibre2 calibre5" data-uri="chapter11.xhtml#P700049702700000000000000004675C" id="P700049702700000000000000004675C">Dotted-decimal address</th>
</tr>
</thead>
<tbody class="pcalibre1 pcalibre2 calibre6">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P700049702700000000000000004675D" id="P700049702700000000000000004675D"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004675E" id="P700049702700000000000000004675E">0x0</code></td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P700049702700000000000000004675F" id="P700049702700000000000000004675F">_____</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046760" id="P7000497027000000000000000046760"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046761" id="P7000497027000000000000000046761">0xffffffff</code></td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046762" id="P7000497027000000000000000046762">_____</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046763" id="P7000497027000000000000000046763"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046764" id="P7000497027000000000000000046764">0x7f000001</code></td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046765" id="P7000497027000000000000000046765">_____</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046766" id="P7000497027000000000000000046766">_____</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046767" id="P7000497027000000000000000046767"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046768" id="P7000497027000000000000000046768">205.188.160.121</code></td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046769" id="P7000497027000000000000000046769">_____</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P700049702700000000000000004676A" id="P700049702700000000000000004676A"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004676B" id="P700049702700000000000000004676B">64.12.149.13</code></td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P700049702700000000000000004676C" id="P700049702700000000000000004676C">_____</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P700049702700000000000000004676D" id="P700049702700000000000000004676D"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004676E" id="P700049702700000000000000004676E">205.188.146.23</code></td>
</tr>
</tbody>
</table>
</div></li>
</ol>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007C59" epub:type="practice" id="P7000497027000000000000000007C59"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004676F" epub:type="title" id="P700049702700000000000000004676F"><span class="pcalibre1 pcalibre21 pcalibre2">Practice Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">11.2 </span>(solution page <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" epub:type="pagebreak" href="fileP7000497027000000000000000008021.xhtml#P700049702700000000000000000803A">967</a>)</h1></header>
<ol class="pcalibre1 pcalibre2 pcalibre77" data-uri="chapter11.xhtml#P7000497027000000000000000046770" id="P7000497027000000000000000046770">
<li class="pcalibre1 pcalibre2 pcalibre78" data-uri="chapter11.xhtml#P7000497027000000000000000046771" id="P7000497027000000000000000046771">
<div class="pcalibre1 pcalibre2 pcalibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046772" id="P7000497027000000000000000046772"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046773" id="P7000497027000000000000000046773">Write a program <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046774" id="P7000497027000000000000000046774">hex2dd.c</code> that converts its hex argument to a dotted-decimal string and prints the result. For example,</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046775" id="P7000497027000000000000000046775"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046776" id="P7000497027000000000000000046776">
linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">./hex2dd 0x8002c2f2</i>
128.2.194.242
</code></pre>
</div></li>
</ol>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007C62" epub:type="practice" id="P7000497027000000000000000007C62"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046777" epub:type="title" id="P7000497027000000000000000046777"><span class="pcalibre1 pcalibre21 pcalibre2">Practice Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">11.3 </span>(solution page <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" epub:type="pagebreak" href="fileP7000497027000000000000000008021.xhtml#P700049702700000000000000000803A">967</a>)</h1></header>
<ol class="pcalibre1 pcalibre2 pcalibre77" data-uri="chapter11.xhtml#P7000497027000000000000000046778" id="P7000497027000000000000000046778">
<li class="pcalibre1 pcalibre2 pcalibre78" data-uri="chapter11.xhtml#P7000497027000000000000000046779" id="P7000497027000000000000000046779">
<div class="pcalibre1 pcalibre2 pcalibre7" data-uri="chapter11.xhtml#P700049702700000000000000004677A" id="P700049702700000000000000004677A"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004677B" id="P700049702700000000000000004677B">Write a program <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004677C" id="P700049702700000000000000004677C">dd2hex.c</code> that converts its dotted-decimal argument to a hex number and prints the result. For example,</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004677D" id="P700049702700000000000000004677D"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004677E" id="P700049702700000000000000004677E">
linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">./dd2hex 128.2.194.242</i>
0x8002c2f2
</code></pre>
</div></li>
</ol>
</section>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007C6B" id="P7000497027000000000000000007C6B"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004677F" epub:type="title" id="P700049702700000000000000004677F"><span class="pcalibre1 pcalibre21 pcalibre2">11.3.2 </span>Internet Domain Names</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046780" id="P7000497027000000000000000046780">Internet clients and servers use IP addresses when they communicate with each other. However, large integers are difficult for people to remember, so the Internet also defines a separate set of more human-friendly <i class="pcalibre17 pcalibre2 pcalibre1">domain names</i>, as well as a mechanism that maps the set of domain names to the set of IP addresses. A domain name is a sequence of words (letters, numbers, and dashes) separated by periods, such as <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046781" id="P7000497027000000000000000046781">whaleshark.ics.cs.cmu.edu</code>.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046782" id="P7000497027000000000000000046782">The set of domain names forms a hierarchy, and each domain name encodes its position in the hierarchy. An example is the easiest way to understand this. <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007C73"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.10</span></a> shows a portion of the domain name hierarchy.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046783" id="P7000497027000000000000000046783">The hierarchy is represented as a tree. The nodes of the tree represent domain names that are formed by the path back to the root. Subtrees are referred to as <i class="pcalibre17 pcalibre2 pcalibre1">sub-domains</i>. The first level in the hierarchy is an unnamed root node. The next level is a collection of <i class="pcalibre17 pcalibre2 pcalibre1">first-level domain names</i> that are defined by a nonprofit organization called ICANN (Internet Corporation for Assigned Names and Numbers). Common first-level domains include <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046784" id="P7000497027000000000000000046784">com, edu, gov, org</code>, and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046785" id="P7000497027000000000000000046785">net</code>.</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007C73" id="P7000497027000000000000000007C73">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007C74" epub:type="pagebreak" id="P7000497027000000000000000007C74" title="928"></span>
<img alt="A diagram illustrates a subset of the Internet domain name hierarchy." class="pcalibre1 pcalibre2 pcalibre304" data-uri="P700049702700000000000000000B7C2" id="P7000497027000000000000000046786" src="Images/chapter-10-image-09.png"/>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046787" id="P7000497027000000000000000046787"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046788" epub:type="title" id="P7000497027000000000000000046788"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.10 </span>Subset of the Internet domain name hierarchy.</h1></header>
<details class="pcalibre1 pcalibre2 pcalibre59" data-uri="chapter11.xhtml#P7000497027000000000000000026AF3" id="P7000497027000000000000000026AF3">
<summary class="pcalibre1 pcalibre2 pcalibre61 pcalibre60"><span class="pcalibre1 pcalibre2 pcalibre37">Description</span></summary>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046789" id="P7000497027000000000000000046789">A diagram shows domain name hierarchy branching from unnamed root to first-level, second-level, and third level, domain names, one of each is further broken down, as organized in the following list.</p>
<ul class="pcalibre1 pcalibre2 pcalibre62" data-uri="chapter11.xhtml#P700049702700000000000000004678A" id="P700049702700000000000000004678A">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004678B" id="P700049702700000000000000004678B"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004678C" id="P700049702700000000000000004678C">Unnamed root</p>
<ul class="pcalibre1 pcalibre2 pcalibre69" data-uri="chapter11.xhtml#P700049702700000000000000004678D" id="P700049702700000000000000004678D">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004678E" id="P700049702700000000000000004678E"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004678F" id="P700049702700000000000000004678F">Mil</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046790" id="P7000497027000000000000000046790"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046791" id="P7000497027000000000000000046791">Edu</p>
<ul class="pcalibre146 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046792" id="P7000497027000000000000000046792">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046793" id="P7000497027000000000000000046793"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046794" id="P7000497027000000000000000046794">Mit</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046795" id="P7000497027000000000000000046795"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046796" id="P7000497027000000000000000046796">Cmu</p>
<ul class="pcalibre1 pcalibre2 pcalibre62" data-uri="chapter11.xhtml#P7000497027000000000000000046797" id="P7000497027000000000000000046797">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046798" id="P7000497027000000000000000046798"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046799" id="P7000497027000000000000000046799">Cs</p>
<ul class="pcalibre1 pcalibre2 pcalibre62" data-uri="chapter11.xhtml#P700049702700000000000000004679A" id="P700049702700000000000000004679A">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004679B" id="P700049702700000000000000004679B"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004679C" id="P700049702700000000000000004679C">Ics</p>
<ul class="pcalibre1 pcalibre2 pcalibre62" data-uri="chapter11.xhtml#P700049702700000000000000004679D" id="P700049702700000000000000004679D">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004679E" id="P700049702700000000000000004679E"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004679F" id="P700049702700000000000000004679F">Whaleshark 128.2.210.175</p></li>
</ul></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467A0" id="P70004970270000000000000000467A0"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467A1" id="P70004970270000000000000000467A1">Pdl</p>
<ul class="pcalibre1 pcalibre2 pcalibre62" data-uri="chapter11.xhtml#P70004970270000000000000000467A2" id="P70004970270000000000000000467A2">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467A3" id="P70004970270000000000000000467A3"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467A4" id="P70004970270000000000000000467A4">www 128.2.131.66</p>
<ul class="pcalibre1 pcalibre2 pcalibre62" data-uri="chapter11.xhtml#P70004970270000000000000000467A5" id="P70004970270000000000000000467A5">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467A6" id="P70004970270000000000000000467A6"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467A7" id="P70004970270000000000000000467A7">ece</p></li>
</ul></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467A8" id="P70004970270000000000000000467A8"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467A9" id="P70004970270000000000000000467A9">berkeley</p></li>
</ul></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467AA" id="P70004970270000000000000000467AA"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467AB" id="P70004970270000000000000000467AB">Gov</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467AC" id="P70004970270000000000000000467AC"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467AD" id="P70004970270000000000000000467AD">Com</p>
<ul class="pcalibre1 pcalibre2 pcalibre62" data-uri="chapter11.xhtml#P70004970270000000000000000467AE" id="P70004970270000000000000000467AE">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467AF" id="P70004970270000000000000000467AF"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467B0" id="P70004970270000000000000000467B0">Amazon</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467B1" id="P70004970270000000000000000467B1"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467B2" id="P70004970270000000000000000467B2">www 176.32.98.166</p></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li></ul></li></ul>
</details>
</figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467B3" id="P70004970270000000000000000467B3">At the next level are <i class="pcalibre17 pcalibre2 pcalibre1">second-level</i> domain names such as <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467B4" id="P70004970270000000000000000467B4">cmu.edu</code>, which are assigned on a first-come first-serve basis by various authorized agents of ICANN. Once an organization has received a second-level domain name, then it is free to create any other new domain name within its subdomain, such as <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467B5" id="P70004970270000000000000000467B5">cs.cmu.edu.</code></p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467B6" id="P70004970270000000000000000467B6">The Internet defines a mapping between the set of domain names and the set of IP addresses. Until 1988, this mapping was maintained manually in a single text file called <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467B7" id="P70004970270000000000000000467B7">HOSTS.TXT.</code> Since then, the mapping has been maintained in a distributed worldwide database known as <i class="pcalibre17 pcalibre2 pcalibre1">DNS (Domain Name System)</i>. Conceptually, the DNS database consists of millions of <i class="pcalibre17 pcalibre2 pcalibre1">host entries</i>, each of which defines the mapping between a set of domain names and a set of IP addresses. In a mathematical sense, think of each host entry as an equivalence class of domain names and IP addresses. We can explore some of the properties of the DNS mappings with the Linux <span class="pcalibre1 pcalibre29 pcalibre2">nslookup </span>program, which displays the IP addresses associated with a domain name.<a class="pcalibre1 pcalibre2 pcalibre56 pcalibre16 pcalibre14 pcalibre15" epub:type="noteref" href="#P7000497027000000000000000008056" id="r__P7000497027000000000000000008056">1</a></p><aside class="pcalibre2 pcalibre32 pcalibre57" data-uri="chapter11.xhtml#P7000497027000000000000000008056" epub:type="footnote" id="P7000497027000000000000000008056"><p class="pcalibre1 pcalibre2 pcalibre10"><span class="pcalibre1 pcalibre58 pcalibre2"><a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="#r__P7000497027000000000000000008056">1. </a></span>We've reformatted the output of <span class="pcalibre1 pcalibre29 pcalibre2">nslookup </span>to improve readability.</p></aside>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467B8" id="P70004970270000000000000000467B8">Each Internet host has the locally defined domain name <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467B9" id="P70004970270000000000000000467B9">localhost</code>, which always maps to the <i class="pcalibre17 pcalibre2 pcalibre1">loopback address</i> <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467BA" id="P70004970270000000000000000467BA">127.0.0.1</code>:</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467BB" id="P70004970270000000000000000467BB"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467BC" id="P70004970270000000000000000467BC">
linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">nslookup localhost</i>
Address: 127.0.0.1
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467BD" id="P70004970270000000000000000467BD">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467BE" id="P70004970270000000000000000467BE">localhost</code> name provides a convenient and portable way to reference clients and servers that are running on the same machine, which can be especially useful <span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007C84" epub:type="pagebreak" id="P7000497027000000000000000007C84" title="929"></span>for debugging. We can use <span class="pcalibre1 pcalibre29 pcalibre2">hostname </span>to determine the real domain name of our local host:</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467BF" id="P70004970270000000000000000467BF"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467C0" id="P70004970270000000000000000467C0">
linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">hostname</i>
whaleshark.ics.cs.cmu.edu
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467C1" id="P70004970270000000000000000467C1">In the simplest case, there is a one-to-one mapping between a domain name and an IP address:</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467C2" id="P70004970270000000000000000467C2"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467C3" id="P70004970270000000000000000467C3">
linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">nslookup whaleshark.ics.cs.cmu.edu</i>
Address: 128.2.210.175
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467C4" id="P70004970270000000000000000467C4">However, in some cases, multiple domain names are mapped to the same IP address:</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467C5" id="P70004970270000000000000000467C5"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467C6" id="P70004970270000000000000000467C6">
linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">nslookup cs.mit.edu</i>
Address: 18.62.1.6
linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">nslookup eecs.mit.edu</i>
Address: 18.62.1.6
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467C7" id="P70004970270000000000000000467C7">In the most general case, multiple domain names are mapped to the same set of multiple IP addresses:</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467C8" id="P70004970270000000000000000467C8"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467C9" id="P70004970270000000000000000467C9">
linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">nslookup www.twitter.com</i>
Address: 199.16.156.6
Address: 199.16.156.70
Address: 199.16.156.102
Address: 199.16.156.230
</code></pre>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467CA" id="P70004970270000000000000000467CA"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467CB" id="P70004970270000000000000000467CB">
linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">nslookup twitter.com</i>
Address: 199.16.156.102
Address: 199.16.156.230
Address: 199.16.156.6
Address: 199.16.156.70
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467CC" id="P70004970270000000000000000467CC">Finally, we notice that some valid domain names are not mapped to any IP address:</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467CD" id="P70004970270000000000000000467CD"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467CE" id="P70004970270000000000000000467CE">
linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">nslookup edu</i>
*** Can't find edu: No answer
linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">nslookup ics.cs.cmu.edu</i>
*** Can't find ics.cs.cmu.edu: No answer
</code></pre>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007C95" id="P7000497027000000000000000007C95"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467CF" epub:type="title" id="P70004970270000000000000000467CF"><span class="pcalibre1 pcalibre21 pcalibre2">11.3.3 </span>Internet Connections</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467D0" id="P70004970270000000000000000467D0">Internet clients and servers communicate by sending and receiving streams of bytes over <i class="pcalibre17 pcalibre2 pcalibre1">connections</i>. A connection is <i class="pcalibre17 pcalibre2 pcalibre1">point-to-point</i> in the sense that it connects a pair of processes. It is <i class="pcalibre17 pcalibre2 pcalibre1">full duplex</i> in the sense that data can flow in both directions</p>
<aside class="pcalibre31 pcalibre32 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000007C98" id="P7000497027000000000000000007C98"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre33" data-uri="chapter11.xhtml#P70004970270000000000000000467D1" epub:type="title" id="P70004970270000000000000000467D1"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007C9A" epub:type="pagebreak" id="P7000497027000000000000000007C9A" title="930"></span><span class="pcalibre1 pcalibre2 pcalibre34">Aside </span>How many Internet hosts are there?</h1></header>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467D2" id="P70004970270000000000000000467D2">Twice a year since 1987, the Internet Systems Consortium conducts the <i class="pcalibre17 pcalibre2 pcalibre1">Internet Domain Survey.</i> The survey, which estimates the number of Internet hosts by counting the number of IP addresses that have been assigned a domain name, reveals an amazing trend. Since 1987, when there were about 20,000 Internet hosts, the number of hosts has been increasing exponentially. By 2015, there were over 1,000,000,000 Internet hosts!</p>
</aside>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467D3" id="P70004970270000000000000000467D3">at the same time. And it is <i class="pcalibre17 pcalibre2 pcalibre1">reliable</i> in the sense thatâ€”barring some catastrophic failure such as a cable cut by the proverbial careless backhoe operatorâ€”the stream of bytes sent by the source process is eventually received by the destination process in the same order it was sent.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467D4" id="P70004970270000000000000000467D4">A <i class="pcalibre17 pcalibre2 pcalibre1">socket</i> is an end point of a connection. Each socket has a corresponding <i class="pcalibre17 pcalibre2 pcalibre1">socket address</i> that consists of an Internet address and a 16-bit integer <i class="pcalibre17 pcalibre2 pcalibre1">port</i><a class="pcalibre1 pcalibre2 pcalibre56 pcalibre16 pcalibre14 pcalibre15" epub:type="noteref" href="#P7000497027000000000000000008058" id="r__P7000497027000000000000000008058">2</a> and is denoted by the notation <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467D5" id="P70004970270000000000000000467D5">address:port.</code></p><aside class="pcalibre2 pcalibre32 pcalibre57" data-uri="chapter11.xhtml#P7000497027000000000000000008058" epub:type="footnote" id="P7000497027000000000000000008058"><p class="pcalibre1 pcalibre2 pcalibre10"><span class="pcalibre1 pcalibre58 pcalibre2"><a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="#r__P7000497027000000000000000008058">2. </a></span>These software ports have no relation to the hardware ports in network switches and routers.</p></aside>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467D6" id="P70004970270000000000000000467D6">The port in the client's socket address is assigned automatically by the kernel when the client makes a connection request and is known as an <i class="pcalibre17 pcalibre2 pcalibre1">ephemeral port.</i> However, the port in the server's socket address is typically some <i class="pcalibre17 pcalibre2 pcalibre1">well-known port</i> that is permanently associated with the service. For example, Web servers typically use port 80, and email servers use port 25. Associated with each service with a well-known port is a corresponding <i class="pcalibre17 pcalibre2 pcalibre1">well-known service name.</i> For example, the well-known name for the Web service is <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467D7" id="P70004970270000000000000000467D7">http</code>, and the well-known name for email is <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467D8" id="P70004970270000000000000000467D8">smtp</code>. The mapping between well-known names and well-known ports is contained in a file called <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467D9" id="P70004970270000000000000000467D9">/etc/services.</code></p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467DA" id="P70004970270000000000000000467DA">A connection is uniquely identified by the socket addresses of its two end points. This pair of socket addresses is known as a <i class="pcalibre17 pcalibre2 pcalibre1">socket pair</i> and is denoted by the tuple</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467DB" id="P70004970270000000000000000467DB"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467DC" id="P70004970270000000000000000467DC"><i class="pcalibre17 pcalibre2 pcalibre1">(cliaddr : cliport, servaddr</i> :<i class="pcalibre17 pcalibre2 pcalibre1">servport)</i></code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467DD" id="P70004970270000000000000000467DD">where <i class="pcalibre17 pcalibre2 pcalibre1">cliaddr</i> is the client's IP address, <i class="pcalibre17 pcalibre2 pcalibre1">cliport</i> is the client's port, <i class="pcalibre17 pcalibre2 pcalibre1">servaddr</i> is the server's IP address, and <i class="pcalibre17 pcalibre2 pcalibre1">servport</i> is the server's port. For example, <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007CB5"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.11</span></a> shows a connection between a Web client and a Web server.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467DE" id="P70004970270000000000000000467DE">In this example, the Web client's socket address is</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467DF" id="P70004970270000000000000000467DF"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467E0" id="P70004970270000000000000000467E0">128.2.194.242:51213</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467E1" id="P70004970270000000000000000467E1">where port <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467E2" id="P70004970270000000000000000467E2">51213</code> is an ephemeral port assigned by the kernel. The Web server's socket address is</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467E3" id="P70004970270000000000000000467E3"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467E4" id="P70004970270000000000000000467E4">208.216.181.15:80</code></pre>
<aside class="pcalibre31 pcalibre32 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000007CAE" id="P7000497027000000000000000007CAE"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre33" data-uri="chapter11.xhtml#P70004970270000000000000000467E5" epub:type="title" id="P70004970270000000000000000467E5"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007CB0" epub:type="pagebreak" id="P7000497027000000000000000007CB0" title="931"></span><span class="pcalibre1 pcalibre2 pcalibre34">Aside </span>Origins of the Internet</h1></header>
<p class="pcalibre1 pcalibre2 pcalibre40" data-uri="chapter11.xhtml#P70004970270000000000000000467E6" id="P70004970270000000000000000467E6">The Internet is one of the most successful examples of government, university, and industry partnership. Many factors contributed to its success, but we think two are particularly important: a sustained 30-year investment by the United States government and a commitment by passionate researchers to what Dave Clarke at MIT has dubbed "rough consensus and working code."</p>
<p class="pcalibre1 pcalibre2 pcalibre40" data-uri="chapter11.xhtml#P70004970270000000000000000467E7" id="P70004970270000000000000000467E7">The seeds of the Internet were sown in 1957, when, at the height of the Cold War, the Soviet Union shocked the world by launching Sputnik, the first artificial earth satellite. In response, the United States government created the Advanced Research Projects Agency (ARPA), whose charter was to reestablish the US lead in science and technology. In 1967, Lawrence Roberts at ARPA published plans for a new network called the ARPANET. The first ARPANET nodes were up and running by 1969. By 1971, there were 13 ARPANET nodes, and email had emerged as the first important network application.</p>
<p class="pcalibre1 pcalibre2 pcalibre40" data-uri="chapter11.xhtml#P70004970270000000000000000467E8" id="P70004970270000000000000000467E8">In 1972, Robert Kahn outlined the general principles of internetworking: a collection of interconnected networks, with communication between the networks handled independently on a "best-effort basis" by black boxes called "routers." In 1974, Kahn and Vinton Cerf published the first details of TCP/IP, which by 1982 had become the standard internetworking protocol for ARPANET. On January 1, 1983, every node on the ARPANET switched to TCP/IP, marking the birth of the global IP Internet.</p>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467E9" id="P70004970270000000000000000467E9">In 1985, Paul Mockapetris invented DNS, and there were over 1,000 Internet hosts. The next year, the National Science Foundation (NSF) built the NSFNET backbone connecting 13 sites with 56 Kb/s phone lines. It was upgraded to 1.5 Mb/s T1 links in 1988 and 45 Mb/s T3 links in 1991. By 1988, there were more than 50,000 hosts. In 1989, the original ARPANET was officially retired. In 1995, when there were almost 10,000,000 Internet hosts, NSF retired NSFNET and replaced it with the modern Internet architecture based on private commercial backbones connected by public network access points.</p>
</aside>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007CB5" id="P7000497027000000000000000007CB5">
<img alt="A diagram illustrates the anatomy of an Internet connection." class="pcalibre1 pcalibre2 pcalibre305" data-uri="P700049702700000000000000000B7C4" id="P70004970270000000000000000467EA" src="Images/chapter-10-image-10.png"/>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P70004970270000000000000000467EB" id="P70004970270000000000000000467EB"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P70004970270000000000000000467EC" epub:type="title" id="P70004970270000000000000000467EC"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.11 </span>Anatomy of an Internet connection.</h1></header>
<details class="pcalibre1 pcalibre2 pcalibre59" data-uri="chapter11.xhtml#P7000497027000000000000000026B58" id="P7000497027000000000000000026B58">
<summary class="pcalibre1 pcalibre2 pcalibre61 pcalibre60"><span class="pcalibre1 pcalibre2 pcalibre37">Description</span></summary>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467ED" id="P70004970270000000000000000467ED">A diagram illustrates a connection between client and server, with parts summarized below.</p>
<ul class="pcalibre1 pcalibre2 pcalibre62" data-uri="chapter11.xhtml#P70004970270000000000000000467EE" id="P70004970270000000000000000467EE">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467EF" id="P70004970270000000000000000467EF"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467F0" id="P70004970270000000000000000467F0">Client: Client host address 128.2.194.242</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467F1" id="P70004970270000000000000000467F1"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467F2" id="P70004970270000000000000000467F2">Client socket address (connection at client): 128.2.194.242:51213</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467F3" id="P70004970270000000000000000467F3"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467F4" id="P70004970270000000000000000467F4">Server (post 80): Server host address 208.216.181.15</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467F5" id="P70004970270000000000000000467F5"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467F6" id="P70004970270000000000000000467F6">Server socket address (connection at server): 208.216.181.15:80</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467F7" id="P70004970270000000000000000467F7"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467F8" id="P70004970270000000000000000467F8">Connection socket pair (between client and host): (128.2.194.242:51213, 208.216.181.15:80)</p></li>
</ul>
</details>
</figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467F9" id="P70004970270000000000000000467F9">where port <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467FA" id="P70004970270000000000000000467FA">80</code> is the well-known port associated with Web services. Given these client and server socket addresses, the connection between the client and server is uniquely identified by the socket pair</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000467FB" id="P70004970270000000000000000467FB"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000467FC" id="P70004970270000000000000000467FC">(128.2.194.242:51213, 208.216.181.15:80)</code></pre>
<aside class="pcalibre31 pcalibre32 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000007CBD" id="P7000497027000000000000000007CBD"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre33" data-uri="chapter11.xhtml#P70004970270000000000000000467FD" epub:type="title" id="P70004970270000000000000000467FD"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007CBF" epub:type="pagebreak" id="P7000497027000000000000000007CBF" title="932"></span><span class="pcalibre1 pcalibre2 pcalibre34">Aside </span>Origins of the sockets interface</h1></header>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000467FE" id="P70004970270000000000000000467FE">The original sockets interface was developed by researchers at University of California, Berkeley, in the early 1980s. For this reason, it is often referred to as <i class="pcalibre17 pcalibre2 pcalibre1">Berkeley sockets</i>. The Berkeley researchers developed the sockets interface to work with any underlying protocol. The first implementation was for TCP/IP, which they included in the Unix 4.2BSD kernel and distributed to numerous universities and labs. This was an important event in Internet history. Almost overnight, thousands of people had access to TCP/IP and its source codes. It generated tremendous excitement and sparked a flurry of new research in networking and internetworking.</p>
</aside>
</section>
</section></body></html>
<?xml version='1.0' encoding='utf-8'?>
<html epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg">
<head>
<meta content="PXE Basic 1.0" name="dcterms.conformsTo"/>
<meta content="PXE Tools version 1.39.52" name="generator"/>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
<title>11.4 The Sockets Interface</title>
<link href="../css/theme/night.css" rel="alternate stylesheet" title="night" type="text/css"/>
<link href="../css/theme/sepia.css" rel="alternate stylesheet" title="sepia" type="text/css"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body class="pcalibre1 pcalibre2 pcalibre" epub:type="bodymatter">
<section class="pcalibre1 pcalibre2 pcalibre3" id="P7000497027000000000000000007CC1"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre2 pcalibre4" data-uri="chapter11.xhtml#P70004970270000000000000000467FF" epub:type="title" id="P70004970270000000000000000467FF"><span class="pcalibre1 pcalibre21 pcalibre2">11.4 </span>The Sockets Interface</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046800" id="P7000497027000000000000000046800">The <i class="pcalibre17 pcalibre2 pcalibre1">sockets interface</i> is a set of functions that are used in conjunction with the Unix I/O functions to build network applications. It has been implemented on most modern systems, including all Unix variants as well as Windows and Macintosh systems. <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007CC4"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.12</span></a> gives an overview of the sockets interface in the context of a typical client-server transaction. You should use this picture as a road map when we discuss the individual functions.</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007CC4" id="P7000497027000000000000000007CC4">
<img alt="A diagram illustrates network applications based on the sockets interface." class="pcalibre1 pcalibre2 pcalibre306" data-uri="P700049702700000000000000000B7C5" id="P7000497027000000000000000046801" src="Images/chapter-10-image-11.png"/>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046802" id="P7000497027000000000000000046802"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046803" epub:type="title" id="P7000497027000000000000000046803"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.12 </span>Overview of network applications based on the sockets interface.</h1></header>
<details class="pcalibre1 pcalibre2 pcalibre59" data-uri="chapter11.xhtml#P7000497027000000000000000026B70" id="P7000497027000000000000000026B70">
<summary class="pcalibre1 pcalibre2 pcalibre61 pcalibre60"><span class="pcalibre1 pcalibre2 pcalibre37">Description</span></summary>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046804" id="P7000497027000000000000000046804">A diagram shows a flow of connections under client and server, with the components summarized below.</p>
<ul class="pcalibre1 pcalibre2 pcalibre62" data-uri="chapter11.xhtml#P7000497027000000000000000046805" id="P7000497027000000000000000046805">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046806" id="P7000497027000000000000000046806"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046807" id="P7000497027000000000000000046807">Client</p>
<ul class="pcalibre1 pcalibre2 pcalibre69" data-uri="chapter11.xhtml#P7000497027000000000000000046808" id="P7000497027000000000000000046808">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046809" id="P7000497027000000000000000046809"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004680A" id="P700049702700000000000000004680A">Open_clientfd, including:</p>
<ul class="pcalibre146 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004680B" id="P700049702700000000000000004680B">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004680C" id="P700049702700000000000000004680C"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004680D" id="P700049702700000000000000004680D">Getaddrinfo</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004680E" id="P700049702700000000000000004680E"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004680F" id="P700049702700000000000000004680F">Socket</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046810" id="P7000497027000000000000000046810"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046811" id="P7000497027000000000000000046811">Connect (connection request to accept under server)</p></li>
</ul></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046812" id="P7000497027000000000000000046812"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046813" id="P7000497027000000000000000046813">Rio_writen (to rio_readlineb under server)</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046814" id="P7000497027000000000000000046814"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046815" id="P7000497027000000000000000046815">Rio_readlineb (from rio_writen under server)</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046816" id="P7000497027000000000000000046816"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046817" id="P7000497027000000000000000046817">Close (EOF to rio_readlineb)</p></li>
</ul></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046818" id="P7000497027000000000000000046818"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046819" id="P7000497027000000000000000046819">Server:</p>
<ul class="pcalibre1 pcalibre2 pcalibre69" data-uri="chapter11.xhtml#P700049702700000000000000004681A" id="P700049702700000000000000004681A">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004681B" id="P700049702700000000000000004681B"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004681C" id="P700049702700000000000000004681C">Open_listenfd, including:</p>
<ul class="pcalibre146 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004681D" id="P700049702700000000000000004681D">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004681E" id="P700049702700000000000000004681E"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004681F" id="P700049702700000000000000004681F">Getaddrinfo</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046820" id="P7000497027000000000000000046820"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046821" id="P7000497027000000000000000046821">Socket</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046822" id="P7000497027000000000000000046822"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046823" id="P7000497027000000000000000046823">Bind</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046824" id="P7000497027000000000000000046824"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046825" id="P7000497027000000000000000046825">Listen</p></li>
</ul></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046826" id="P7000497027000000000000000046826"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046827" id="P7000497027000000000000000046827">Accept (connection request from connect under Client and await connection request from next client from close below)</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046828" id="P7000497027000000000000000046828"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046829" id="P7000497027000000000000000046829">Rio_readlineb (from rio_writen under client)</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004682A" id="P700049702700000000000000004682A"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004682B" id="P700049702700000000000000004682B">Rio_writen (to rio_readlineb under client)</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004682C" id="P700049702700000000000000004682C"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004682D" id="P700049702700000000000000004682D">Rio_readlineb (EOF from close under client)</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004682E" id="P700049702700000000000000004682E"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004682F" id="P700049702700000000000000004682F">Close (await connection request from next client to accept)</p></li>
</ul></li>
</ul>
</details>
</figcaption>
</figure>
<aside class="pcalibre31 pcalibre32 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000007CC8" id="P7000497027000000000000000007CC8"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre33" data-uri="chapter11.xhtml#P7000497027000000000000000046830" epub:type="title" id="P7000497027000000000000000046830"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007CCA" epub:type="pagebreak" id="P7000497027000000000000000007CCA" title="933"></span><span class="pcalibre1 pcalibre2 pcalibre34">Aside </span>What does the <code class="pcalibre1 pcalibre2 calibre16" data-uri="chapter11.xhtml#P7000497027000000000000000046831" id="P7000497027000000000000000046831">_in</code> suffix mean?</h1></header>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046832" id="P7000497027000000000000000046832">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046833" id="P7000497027000000000000000046833">_in</code> suffix is short for <i class="pcalibre17 pcalibre2 pcalibre1">internet</i>, not <i class="pcalibre17 pcalibre2 pcalibre1">input</i>.</p>
</aside>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007CCE" id="P7000497027000000000000000007CCE">
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046834" id="P7000497027000000000000000046834"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046835" id="P7000497027000000000000000046835">
/* IP socket address structure */
struct sockaddr_in {
  uint16_t	sin_family;	/* Protocol family (always AF_INET) */
  uint16_t	sin_port;	/* Port number in network byte order */
  struct in_addr	sin_addr;	/* IP address in network byte order */
  unsigned char	sin_zero[8];	/* Pad to sizeof(struct sockaddr) */
};
/* Generic socket address structure (for connect, bind, and accept) */ struct sockaddr {
  uint16_t	sa_family;	/* Protocol family */
  char		sa_data[14];	/* Address data */
};
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046836" id="P7000497027000000000000000046836"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046837" epub:type="title" id="P7000497027000000000000000046837"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.13 </span>Socket address structures.</h1></header>
</figcaption>
</figure>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007CD3" id="P7000497027000000000000000007CD3"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046838" epub:type="title" id="P7000497027000000000000000046838"><span class="pcalibre1 pcalibre21 pcalibre2">11.4.1 </span>Socket Address Structures</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046839" id="P7000497027000000000000000046839">From the perspective of the Linux kernel, a socket is an end point for communication. From the perspective of a Linux program, a socket is an open file with a corresponding descriptor.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004683A" id="P700049702700000000000000004683A">Internet socket addresses are stored in 16-byte structures having the type <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004683B" id="P700049702700000000000000004683B">sockaddr_in</code>, shown in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007CCE"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.13</span></a>. For Internet applications, the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004683C" id="P700049702700000000000000004683C">sin_family</code> field is AF_INET, the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004683D" id="P700049702700000000000000004683D">sin_port</code> field is a 16-bit port number, and the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004683E" id="P700049702700000000000000004683E">sin_addr</code> field contains a 32-bit IP address. The IP address and port number are always stored in network (big-endian) byte order.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004683F" id="P700049702700000000000000004683F">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046840" id="P7000497027000000000000000046840">connect, bind</code>, and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046841" id="P7000497027000000000000000046841">accept</code> functions require a pointer to a protocol-specific socket address structure. The problem faced by the designers of the sockets interface was how to define these functions to accept any kind of socket address structure. Today, we would use the generic <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046842" id="P7000497027000000000000000046842">void</code> * pointer, which did not exist in C at that time. Their solution was to define sockets functions to expect a pointer to a generic <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046843" id="P7000497027000000000000000046843">sockaddr</code> structure (<a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007CCE"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.13</span></a>) and then require applications to cast any pointers to protocol-specific structures to this generic structure. To simplify our code examples, we follow Stevens's lead and define the following type:</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046844" id="P7000497027000000000000000046844"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046845" id="P7000497027000000000000000046845">typedef struct sockaddr SA;</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046846" id="P7000497027000000000000000046846"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007CE3" epub:type="pagebreak" id="P7000497027000000000000000007CE3" title="934"></span>We then use this type whenever we need to cast a <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046847" id="P7000497027000000000000000046847">sockaddr_in</code> structure to a generic <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046848" id="P7000497027000000000000000046848">sockaddr</code> structure.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007CE6" id="P7000497027000000000000000007CE6"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046849" epub:type="title" id="P7000497027000000000000000046849"><span class="pcalibre1 pcalibre21 pcalibre2">11.4.2 </span>The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004684A" id="P700049702700000000000000004684A">socket</code> Function</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004684B" id="P700049702700000000000000004684B">Clients and servers use the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004684C" id="P700049702700000000000000004684C">socket</code> function to create a <i class="pcalibre17 pcalibre2 pcalibre1">socket descriptor</i>.</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004684D" id="P700049702700000000000000004684D"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004684E" id="P700049702700000000000000004684E">
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
int socket(int domain, int type, int protocol);
				Returns: nonnegative descriptor if OK, âˆ’1 on error
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004684F" id="P700049702700000000000000004684F">If we wanted the socket to be the end point for a connection, then we could call socket with the following hardcoded arguments:</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046850" id="P7000497027000000000000000046850"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046851" id="P7000497027000000000000000046851">clientfd = Socket(AF_INET, SOCK_STREAM, 0);</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046852" id="P7000497027000000000000000046852">where AF_INET indicates that we are using 32-bit IP addresses and SOCK_STREAM indicates that the socket will be an end point for a connection. However, the best practice is to use the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046853" id="P7000497027000000000000000046853">getaddrinfo</code> function (<a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007D50"><span class="pcalibre1 pcalibre21 pcalibre2">Section </span><span class="pcalibre1 pcalibre21 pcalibre2">11.4.7</span></a>) to generate these parameters automatically, so that the code is protocol-independent. We will show you how to use <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046854" id="P7000497027000000000000000046854">getaddrinfo</code> with the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046855" id="P7000497027000000000000000046855">socket</code> function in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007E0B"><span class="pcalibre1 pcalibre21 pcalibre2">Section </span><span class="pcalibre1 pcalibre21 pcalibre2">11.4.8</span></a>.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046856" id="P7000497027000000000000000046856">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046857" id="P7000497027000000000000000046857">clientfd</code> descriptor returned by <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046858" id="P7000497027000000000000000046858">socket</code> is only partially opened and cannot yet be used for reading and writing. How we finish opening the socket depends on whether we are a client or a server. The next section describes how we finish opening the socket if we are a client.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007CF7" id="P7000497027000000000000000007CF7"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046859" epub:type="title" id="P7000497027000000000000000046859"><span class="pcalibre1 pcalibre21 pcalibre2">11.4.3 </span>The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004685A" id="P700049702700000000000000004685A">connect</code> Function</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004685B" id="P700049702700000000000000004685B">A client establishes a connection with a server by calling the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004685C" id="P700049702700000000000000004685C">connect</code> function.</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004685D" id="P700049702700000000000000004685D"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004685E" id="P700049702700000000000000004685E">
#include &lt;sys/socket.h&gt;
int connect(int clientfd, const struct sockaddr *addr,
			socklen_t addrlen);
							Returns: 0 if OK, âˆ’1 on error
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004685F" id="P700049702700000000000000004685F">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046860" id="P7000497027000000000000000046860">connect</code> function attempts to establish an Internet connection with the server at socket address <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046861" id="P7000497027000000000000000046861">addr</code>, where <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046862" id="P7000497027000000000000000046862">addrlen</code> is <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046863" id="P7000497027000000000000000046863">sizeof(sockaddr_in)</code>. The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046864" id="P7000497027000000000000000046864">connect</code> function blocks until either the connection is successfully established or an error occurs. If successful, the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046865" id="P7000497027000000000000000046865">clientfd</code> descriptor is now ready for reading and writing, and the resulting connection is characterized by the socket pair</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046866" id="P7000497027000000000000000046866"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046867" id="P7000497027000000000000000046867">(x:y, addr.sin_addr:addr.sin_port)</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046868" id="P7000497027000000000000000046868"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007D08" epub:type="pagebreak" id="P7000497027000000000000000007D08" title="935"></span>where <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046869" id="P7000497027000000000000000046869">x</code> is the client's IP address and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004686A" id="P700049702700000000000000004686A">y</code> is the ephemeral port that uniquely identifies the client process on the client host. As with <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004686B" id="P700049702700000000000000004686B">socket</code>, the best practice is to use <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004686C" id="P700049702700000000000000004686C">getaddrinfo</code> to supply the arguments to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004686D" id="P700049702700000000000000004686D">connect</code> (see <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007E0B"><span class="pcalibre1 pcalibre21 pcalibre2">Section </span><span class="pcalibre1 pcalibre21 pcalibre2">11.4.8</span></a>).</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007D0E" id="P7000497027000000000000000007D0E"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004686E" epub:type="title" id="P700049702700000000000000004686E"><span class="pcalibre1 pcalibre21 pcalibre2">11.4.4 </span>The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004686F" id="P700049702700000000000000004686F">bind</code> Function</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046870" id="P7000497027000000000000000046870">The remaining sockets functionsâ€”<code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046871" id="P7000497027000000000000000046871">bind, listen</code>, and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046872" id="P7000497027000000000000000046872">accept</code>â€”are used by servers to establish connections with clients.</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046873" id="P7000497027000000000000000046873"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046874" id="P7000497027000000000000000046874">
#include &lt;sys/socket.h&gt;
int bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen);
				Returns: 0 if OK, âˆ’1 on error
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046875" id="P7000497027000000000000000046875">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046876" id="P7000497027000000000000000046876">bind</code> function asks the kernel to associate the server's socket address in <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046877" id="P7000497027000000000000000046877">addr</code> with the socket descriptor <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046878" id="P7000497027000000000000000046878">sockfd</code>. The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046879" id="P7000497027000000000000000046879">addrlen</code> argument is <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004687A" id="P700049702700000000000000004687A">sizeof(sockaddr_in)</code>. As with <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004687B" id="P700049702700000000000000004687B">socket</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004687C" id="P700049702700000000000000004687C">connect</code>, the best practice is to use <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004687D" id="P700049702700000000000000004687D">getaddrinfo</code> to supply the arguments to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004687E" id="P700049702700000000000000004687E">bind</code> (see <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007E0B"><span class="pcalibre1 pcalibre21 pcalibre2">Section </span><span class="pcalibre1 pcalibre21 pcalibre2">11.4.8</span></a>).</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007D20" id="P7000497027000000000000000007D20"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004687F" epub:type="title" id="P700049702700000000000000004687F"><span class="pcalibre1 pcalibre21 pcalibre2">11.4.5 </span>The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046880" id="P7000497027000000000000000046880">listen</code> Function</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046881" id="P7000497027000000000000000046881">Clients are active entities that initiate connection requests. Servers are passive entities that wait for connection requests from clients. By default, the kernel assumes that a descriptor created by the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046882" id="P7000497027000000000000000046882">socket</code> function corresponds to an <i class="pcalibre17 pcalibre2 pcalibre1">active socket</i> that will live on the client end of a connection. A server calls the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046883" id="P7000497027000000000000000046883">listen</code> function to tell the kernel that the descriptor will be used by a server instead of a client.</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046884" id="P7000497027000000000000000046884"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046885" id="P7000497027000000000000000046885">
#include &lt;sys/socket.h&gt;
int listen(int sockfd, int backlog);
				Returns: 0 if OK, âˆ’1 on error
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046886" id="P7000497027000000000000000046886">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046887" id="P7000497027000000000000000046887">listen</code> function converts <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046888" id="P7000497027000000000000000046888">sockfd</code> from an active socket to a <i class="pcalibre17 pcalibre2 pcalibre1">listening socket</i> that can accept connection requests from clients. The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046889" id="P7000497027000000000000000046889">backlog</code> argument is a hint about the number of outstanding connection requests that the kernel should queue up before it starts to refuse requests. The exact meaning of the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004688A" id="P700049702700000000000000004688A">backlog</code> argument requires an understanding of TCP/IP that is beyond our scope. We will typically set it to a large value, such as 1,024.</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007D2D" id="P7000497027000000000000000007D2D">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007D2E" epub:type="pagebreak" id="P7000497027000000000000000007D2E" title="936"></span>
<img alt="A diagram illustrates three roles of the listening and connected descriptors." class="pcalibre1 pcalibre2 calibre85" data-uri="P700049702700000000000000000B7C6" id="P700049702700000000000000004688B" src="Images/chapter-10-image-12.png"/>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P700049702700000000000000004688C" id="P700049702700000000000000004688C"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P700049702700000000000000004688D" epub:type="title" id="P700049702700000000000000004688D"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.14 </span>The roles of the listening and connected descriptors.</h1></header>
<details class="pcalibre1 pcalibre2 pcalibre59" data-uri="chapter11.xhtml#P7000497027000000000000000026BFB" id="P7000497027000000000000000026BFB">
<summary class="pcalibre1 pcalibre2 pcalibre61 pcalibre60"><span class="pcalibre1 pcalibre2 pcalibre37">Description</span></summary>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004688E" id="P700049702700000000000000004688E">The three steps are summarized below.</p>
<ol class="pcalibre75 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004688F" id="P700049702700000000000000004688F">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046890" id="P7000497027000000000000000046890"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046891" id="P7000497027000000000000000046891">Server blocks in accept, waiting for connection request on listening descriptor listenfd (Client shown with clientfd and server with listenfd(3))</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046892" id="P7000497027000000000000000046892"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046893" id="P7000497027000000000000000046893">Client makes connection request by calling and blocking in connect. (Connection request from client to listen(3) on server)</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046894" id="P7000497027000000000000000046894"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046895" id="P7000497027000000000000000046895">Server returns connfd from accept. Client returns from connect. Connection is now established between clientfd and connfd. (Connection between clientfd and connfd(4) on server)</p></li>
</ol>
</details>
</figcaption>
</figure>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007D32" id="P7000497027000000000000000007D32"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046896" epub:type="title" id="P7000497027000000000000000046896"><span class="pcalibre1 pcalibre21 pcalibre2">11.4.6 </span>The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046897" id="P7000497027000000000000000046897">accept</code> Function</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046898" id="P7000497027000000000000000046898">Servers wait for connection requests from clients by calling the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046899" id="P7000497027000000000000000046899">accept</code> function.</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004689A" id="P700049702700000000000000004689A"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004689B" id="P700049702700000000000000004689B">
#include &lt;sys/socket.h&gt;
int accept(int listenfd, struct sockaddr *addr, int *addrlen);
				Returns: nonnegative connected descriptor if OK, âˆ’1 on error
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004689C" id="P700049702700000000000000004689C">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004689D" id="P700049702700000000000000004689D">accept</code> function waits for a connection request from a client to arrive on the listening descriptor <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004689E" id="P700049702700000000000000004689E">listenfd</code>, then fills in the client's socket address in <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004689F" id="P700049702700000000000000004689F">addr</code>, and returns a <i class="pcalibre17 pcalibre2 pcalibre1">connected descriptor</i> that can be used to communicate with the client using Unix I/O functions.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468A0" id="P70004970270000000000000000468A0">The distinction between a listening descriptor and a connected descriptor confuses many students. The listening descriptor serves as an end point for client connection requests. It is typically created once and exists for the lifetime of the server. The connected descriptor is the end point of the connection that is established between the client and the server. It is created each time the server accepts a connection request and exists only as long as it takes the server to service a client.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468A1" id="P70004970270000000000000000468A1"><a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007D2D"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.14</span></a> outlines the roles of the listening and connected descriptors. In step 1, the server calls <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468A2" id="P70004970270000000000000000468A2">accept</code>, which waits for a connection request to arrive on the listening descriptor, which for concreteness we will assume is descriptor 3. Recall that descriptors 0âˆ’2 are reserved for the standard files.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468A3" id="P70004970270000000000000000468A3">In step 2, the client calls the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468A4" id="P70004970270000000000000000468A4">connect</code> function, which sends a connection request to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468A5" id="P70004970270000000000000000468A5">listenfd</code>. In step 3, the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468A6" id="P70004970270000000000000000468A6">accept</code> function opens a new connected descriptor <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468A7" id="P70004970270000000000000000468A7">connfd</code> (which we will assume is descriptor 4), establishes the connection between <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468A8" id="P70004970270000000000000000468A8">clientfd</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468A9" id="P70004970270000000000000000468A9">connfd</code>, and then returns <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468AA" id="P70004970270000000000000000468AA">connfd</code> to the application. The</p>
<aside class="pcalibre31 pcalibre32 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000007D48" id="P7000497027000000000000000007D48"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre33" data-uri="chapter11.xhtml#P70004970270000000000000000468AB" epub:type="title" id="P70004970270000000000000000468AB"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007D4A" epub:type="pagebreak" id="P7000497027000000000000000007D4A" title="937"></span><span class="pcalibre1 pcalibre2 pcalibre34">Aside </span>Why the distinction between listening and connected descriptors?</h1></header>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000468AC" id="P70004970270000000000000000468AC">You might wonder why the sockets interface makes a distinction between listening and connected descriptors. At first glance, it appears to be an unnecessary complication. However, distinguishing between the two turns out to be quite useful, because it allows us to build concurrent servers that can process many client connections simultaneously. For example, each time a connection request arrives on the listening descriptor, we might fork a new process that communicates with the client over its connected descriptor. You'll learn more about concurrent servers in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000008060.xhtml#P7000497027000000000000000008060"><span class="pcalibre1 pcalibre21 pcalibre2">Chapter </span><span class="pcalibre1 pcalibre21 pcalibre2">12</span></a>.</p>
</aside>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468AD" id="P70004970270000000000000000468AD">client also returns from the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468AE" id="P70004970270000000000000000468AE">connect</code>, and from this point, the client and server can pass data back and forth by reading and writing <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468AF" id="P70004970270000000000000000468AF">clientfd</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468B0" id="P70004970270000000000000000468B0">connfd</code>, respectively.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007D50" id="P7000497027000000000000000007D50"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468B1" epub:type="title" id="P70004970270000000000000000468B1"><span class="pcalibre1 pcalibre21 pcalibre2">11.4.7 </span>Host and Service Conversion</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468B2" id="P70004970270000000000000000468B2">Linux provides some powerful functions, called <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468B3" id="P70004970270000000000000000468B3">getaddrinfo</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468B4" id="P70004970270000000000000000468B4">getnameinfo</code>, for converting back and forth between binary socket address structures and the string representations of hostnames, host addresses, service names, and port numbers. When used in conjunction with the sockets interface, they allow us to write network programs that are independent of any particular version of the IP protocol.</p>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007D55" id="P7000497027000000000000000007D55"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468B5" epub:type="title" id="P70004970270000000000000000468B5">The <code class="pcalibre1 pcalibre2 calibre16" data-uri="chapter11.xhtml#P70004970270000000000000000468B6" id="P70004970270000000000000000468B6">getaddrinfo</code> Function</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468B7" id="P70004970270000000000000000468B7">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468B8" id="P70004970270000000000000000468B8">getaddrinfo</code> function converts string representations of hostnames, host addresses, service names, and port numbers into socket address structures. It is the modern replacement for the obsolete <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468B9" id="P70004970270000000000000000468B9">gethostbyname</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468BA" id="P70004970270000000000000000468BA">getservbyname</code> functions. Unlike these functions, it is reentrant (see <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000008577.xhtml#P70004970270000000000000000085BA"><span class="pcalibre1 pcalibre21 pcalibre2">Section </span><span class="pcalibre1 pcalibre21 pcalibre2">12.7.2</span></a>) and works with any protocol.</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000468BB" id="P70004970270000000000000000468BB"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468BC" id="P70004970270000000000000000468BC">
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netdb.h&gt;
int getaddrinfo(const char *host, const char *service,
			const struct addrinfo *hints,
			struct addrinfo **result);
					Returns: 0 if OK, nonzero error code on error
void freeaddrinfo(struct addrinfo *result);
				Returns: nothing
const char *gai_strerror(int errcode);
				Returns: error message
</code></pre>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007D5E" id="P7000497027000000000000000007D5E">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007D5F" epub:type="pagebreak" id="P7000497027000000000000000007D5F" title="938"></span>
<img alt="A diagram shows lists of data structure returned by getaddrinfo." class="pcalibre1 pcalibre2 calibre86" data-uri="P700049702700000000000000000B7C7" id="P70004970270000000000000000468BD" src="Images/chapter-10-image-13.png"/>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P70004970270000000000000000468BE" id="P70004970270000000000000000468BE"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P70004970270000000000000000468BF" epub:type="title" id="P70004970270000000000000000468BF"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.15 </span>Data structure returned by <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468C0" id="P70004970270000000000000000468C0">getaddrinfo</code>.</h1></header>
<details class="pcalibre1 pcalibre2 pcalibre59" data-uri="chapter11.xhtml#P7000497027000000000000000026C2F" id="P7000497027000000000000000026C2F">
<summary class="pcalibre1 pcalibre2 pcalibre61 pcalibre60"><span class="pcalibre1 pcalibre2 pcalibre37">Description</span></summary>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468C1" id="P70004970270000000000000000468C1">A diagram shows a result leading to a list of addrinfo structs, leading to others as follows:</p>
<ul class="pcalibre1 pcalibre2 pcalibre62" data-uri="chapter11.xhtml#P70004970270000000000000000468C2" id="P70004970270000000000000000468C2">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000468C3" id="P70004970270000000000000000468C3"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000468C4" id="P70004970270000000000000000468C4">Ai_canonname, to cell under result</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000468C5" id="P70004970270000000000000000468C5"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000468C6" id="P70004970270000000000000000468C6">Ai_addr, to socket address struct</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000468C7" id="P70004970270000000000000000468C7"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000468C8" id="P70004970270000000000000000468C8">Ai_next, to next list:</p>
<ul class="pcalibre1 pcalibre2 pcalibre69" data-uri="chapter11.xhtml#P70004970270000000000000000468C9" id="P70004970270000000000000000468C9">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000468CA" id="P70004970270000000000000000468CA"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000468CB" id="P70004970270000000000000000468CB">NULL</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000468CC" id="P70004970270000000000000000468CC"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000468CD" id="P70004970270000000000000000468CD">Ai_addr, to socket address struct</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000468CE" id="P70004970270000000000000000468CE"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000468CF" id="P70004970270000000000000000468CF">Ai_next, to next list:</p>
<ul class="pcalibre146 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000468D0" id="P70004970270000000000000000468D0">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000468D1" id="P70004970270000000000000000468D1"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000468D2" id="P70004970270000000000000000468D2">NULL</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000468D3" id="P70004970270000000000000000468D3"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000468D4" id="P70004970270000000000000000468D4">Ai_addr, to socket address struct</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000468D5" id="P70004970270000000000000000468D5"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000468D6" id="P70004970270000000000000000468D6">NULL</p></li>
</ul>
</li></ul>
</li></ul>
</details>
</figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468D7" id="P70004970270000000000000000468D7">Given <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468D8" id="P70004970270000000000000000468D8">host</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468D9" id="P70004970270000000000000000468D9">service</code> (the two components of a socket address), <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468DA" id="P70004970270000000000000000468DA">getaddrinfo</code> returns a <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468DB" id="P70004970270000000000000000468DB">result</code> that points to a linked list of <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468DC" id="P70004970270000000000000000468DC">addrinfo</code> structures, each of which points to a socket address structure that corresponds to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468DD" id="P70004970270000000000000000468DD">host</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468DE" id="P70004970270000000000000000468DE">service</code> (<a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007D5E"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.15</span></a>).</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468DF" id="P70004970270000000000000000468DF">After a client calls <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468E0" id="P70004970270000000000000000468E0">getaddrinfo</code>, it walks this list, trying each socket address in turn until the calls to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468E1" id="P70004970270000000000000000468E1">socket</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468E2" id="P70004970270000000000000000468E2">connect</code> succeed and the connection is established. Similarly, a server tries each socket address on the list until the calls to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468E3" id="P70004970270000000000000000468E3">socket</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468E4" id="P70004970270000000000000000468E4">bind</code> succeed and the descriptor is bound to a valid socket address. To avoid memory leaks, the application must eventually free the list by calling <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468E5" id="P70004970270000000000000000468E5">freeaddrinfo</code>. If <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468E6" id="P70004970270000000000000000468E6">getaddrinfo</code> returns a nonzero error code, the application can call <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468E7" id="P70004970270000000000000000468E7">gai_strerror</code> to convert the code to a message string.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468E8" id="P70004970270000000000000000468E8">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468E9" id="P70004970270000000000000000468E9">host</code> argument to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468EA" id="P70004970270000000000000000468EA">getaddrinfo</code> can be either a domain name or a numeric address (e.g., a dotted-decimal IP address). The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468EB" id="P70004970270000000000000000468EB">service</code> argument can be either a service name <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468EC" id="P70004970270000000000000000468EC">(e.g., http)</code> or a decimal port number. If we are not interested in converting the hostname to an address, we can set <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468ED" id="P70004970270000000000000000468ED">host</code> to NULL. The same holds for <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468EE" id="P70004970270000000000000000468EE">service</code>. However, at least one of them must be specified.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468EF" id="P70004970270000000000000000468EF">The optional <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468F0" id="P70004970270000000000000000468F0">hints</code> argument is an <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468F1" id="P70004970270000000000000000468F1">addrinfo</code> structure (<a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007D88"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.16</span></a>) that provides finer control over the list of socket addresses that <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468F2" id="P70004970270000000000000000468F2">getaddrinfo</code> returns. When passed as a hints argument, only the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468F3" id="P70004970270000000000000000468F3">ai_family, ai_socktype, ai_protocol</code>, and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468F4" id="P70004970270000000000000000468F4">ai_flags</code> fields can be set. The other fields must be set to zero (or NULL). In practice, we use <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468F5" id="P70004970270000000000000000468F5">memset</code> to zero the entire structure and then set a few selected fields:</p>
<ul class="pcalibre1 calibre9 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468F6" id="P70004970270000000000000000468F6">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000468F7" id="P70004970270000000000000000468F7"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000468F8" id="P70004970270000000000000000468F8">By default, <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468F9" id="P70004970270000000000000000468F9">getaddrinfo</code> can return both IPv4 and IPv6 socket addresses. Setting <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468FA" id="P70004970270000000000000000468FA">ai_family</code> to AF_INET restricts the list to IPv4 addresses. Setting it to AF_INET6 restricts the list to IPv6 addresses.</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007D88" id="P7000497027000000000000000007D88">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007D89" epub:type="pagebreak" id="P7000497027000000000000000007D89" title="939"></span>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000468FB" id="P70004970270000000000000000468FB"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468FC" id="P70004970270000000000000000468FC">
struct addrinfo {
	int		ai_flags;	/* Hints argument flags */
	int		ai_family;	/* First arg to socket function */
	int		ai_socktype;	/* Second arg to socket function */
	int		ai_protocol;	/* Third arg to socket function */
	char		*ai_canonname;	/* Canonical hostname */
	size_t		ai_addrlen;	/* Size of ai_addr struct */
	struct sockaddr	*ai_addr;	/* Ptr to socket address structure */
struct addrinfo		*ai_next;	/* Ptr to next item in linked list */
};
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P70004970270000000000000000468FD" id="P70004970270000000000000000468FD"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P70004970270000000000000000468FE" epub:type="title" id="P70004970270000000000000000468FE"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.16 </span>The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000468FF" id="P70004970270000000000000000468FF">addrinfo</code> structure used by <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046900" id="P7000497027000000000000000046900">getaddrinfo</code>.</h1></header>
</figcaption>
</figure></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046901" id="P7000497027000000000000000046901"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046902" id="P7000497027000000000000000046902">By default, for each unique address associated with host, the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046903" id="P7000497027000000000000000046903">getaddrinfo</code> function can return up to three <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046904" id="P7000497027000000000000000046904">addrinfo</code> structures, each with a different <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046905" id="P7000497027000000000000000046905">ai_socktype</code> field: one for connections, one for datagrams (not covered), and one for raw sockets (not covered). Setting <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046906" id="P7000497027000000000000000046906">ai_socktype</code> to SOCK_STREAM restricts the list to at most one <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046907" id="P7000497027000000000000000046907">addrinfo</code> structure for each unique address, one whose socket address can be used as the end point of a connection. This is the desired behavior for all of our example programs.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046908" id="P7000497027000000000000000046908"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046909" id="P7000497027000000000000000046909">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004690A" id="P700049702700000000000000004690A">ai_flags</code> field is a bit mask that further modifies the default behavior. You create it by <span class="pcalibre1 pcalibre29 pcalibre2">or</span>ing combinations of various values. Here are some that we find useful:</p>
<ul class="pcalibre1 pcalibre2 pcalibre126" data-uri="chapter11.xhtml#P700049702700000000000000004690B" id="P700049702700000000000000004690B">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004690C" id="P700049702700000000000000004690C"><p class="pcalibre1 pcalibre2 pcalibre40" data-uri="chapter11.xhtml#P700049702700000000000000004690D" id="P700049702700000000000000004690D">AI_ADDRCONFIG. This flag is recommended if you are using connections <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="fileP700049702700000000000000000B39D.xhtml#P700049702700000000000000000B3E5">[34]</a>. It asks <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004690E" id="P700049702700000000000000004690E">getaddrinfo</code> to return IPv4 addresses only if the local host is configured for IPv4. Similarly for IPv6.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004690F" id="P700049702700000000000000004690F"><p class="pcalibre1 pcalibre2 pcalibre40" data-uri="chapter11.xhtml#P7000497027000000000000000046910" id="P7000497027000000000000000046910">AI_CANONNAME. By default, the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046911" id="P7000497027000000000000000046911">ai_canonname</code> field is NULL. If this flag is set, it instructs <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046912" id="P7000497027000000000000000046912">getaddrinfo</code> to point the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046913" id="P7000497027000000000000000046913">ai_canonname</code> field in the first <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046914" id="P7000497027000000000000000046914">addrinfo</code> structure in the list to the canonical (official) name of <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046915" id="P7000497027000000000000000046915">host</code> (see <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007D5E"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.15</span></a>).</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046916" id="P7000497027000000000000000046916"><p class="pcalibre1 pcalibre2 pcalibre40" data-uri="chapter11.xhtml#P7000497027000000000000000046917" id="P7000497027000000000000000046917">AI_NUMERICSERV. By default, the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046918" id="P7000497027000000000000000046918">service</code> argument can be a service name or a port number. This flag forces the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046919" id="P7000497027000000000000000046919">service</code> argument to be a port number.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004691A" id="P700049702700000000000000004691A"><p class="pcalibre1 pcalibre2 pcalibre40" data-uri="chapter11.xhtml#P700049702700000000000000004691B" id="P700049702700000000000000004691B">AI_PASSIVE. By default, <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004691C" id="P700049702700000000000000004691C">getaddrinfo</code> returns socket addresses that can be used by clients as active sockets in calls to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004691D" id="P700049702700000000000000004691D">connect</code>. This flag instructs it to return socket addresses that can be used by servers as listening sockets. In this case, the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004691E" id="P700049702700000000000000004691E">host</code> argument should be NULL. The address field in the resulting socket address structure(s) will be the <i class="pcalibre17 pcalibre2 pcalibre1">wildcard address</i>, which tells the kernel that this server will accept requests to any of the IP addresses for this host. This is the desired behavior for all of our example servers.</p></li>
</ul></li>
</ul>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004691F" id="P700049702700000000000000004691F"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007DAF" epub:type="pagebreak" id="P7000497027000000000000000007DAF" title="940"></span>When <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046920" id="P7000497027000000000000000046920">getaddrinfo</code> creates an <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046921" id="P7000497027000000000000000046921">addrinfo</code> structure in the output list, it fills in each field except for <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046922" id="P7000497027000000000000000046922">ai_flags</code>. The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046923" id="P7000497027000000000000000046923">ai_addr</code> field points to a socket address structure, the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046924" id="P7000497027000000000000000046924">ai_addrlen</code> field gives the size of this socket address structure, and the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046925" id="P7000497027000000000000000046925">ai_next</code> field points to the next <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046926" id="P7000497027000000000000000046926">addrinfo</code> structure in the list. The other fields describe various attributes of the socket address.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046927" id="P7000497027000000000000000046927">One of the elegant aspects of <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046928" id="P7000497027000000000000000046928">getaddrinfo</code> is that the fields in an <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046929" id="P7000497027000000000000000046929">addrinfo</code> structure are opaque, in the sense that they can be passed directly to the functions in the sockets interface without any further manipulation by the application code. For example, <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004692A" id="P700049702700000000000000004692A">ai_family, ai_socktype</code>, and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004692B" id="P700049702700000000000000004692B">ai_protocol</code> can be passed directly to socket. Similarly, <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004692C" id="P700049702700000000000000004692C">ai_addr</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004692D" id="P700049702700000000000000004692D">ai_addrlen</code> can be passed directly to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004692E" id="P700049702700000000000000004692E">connect</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004692F" id="P700049702700000000000000004692F">bind</code>. This powerful property allows us to write clients and servers that are independent of any particular version of the IP protocol.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007DC0" id="P7000497027000000000000000007DC0"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046930" epub:type="title" id="P7000497027000000000000000046930">The <code class="pcalibre1 pcalibre2 calibre16" data-uri="chapter11.xhtml#P7000497027000000000000000046931" id="P7000497027000000000000000046931">getnameinfo</code> Function</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046932" id="P7000497027000000000000000046932">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046933" id="P7000497027000000000000000046933">getnameinfo</code> function is the inverse of <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046934" id="P7000497027000000000000000046934">getaddrinfo</code>. It converts a socket address structure to the corresponding host and service name strings. It is the modern replacement for the obsolete <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046935" id="P7000497027000000000000000046935">gethostbyaddr</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046936" id="P7000497027000000000000000046936">getservbyport</code> functions, and unlike those functions, it is reentrant and protocol-independent.</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046937" id="P7000497027000000000000000046937"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046938" id="P7000497027000000000000000046938">
#include &lt;sys/socket.h&gt;
#include &lt;netdb.h&gt;
int getnameinfo(const struct sockaddr *sa, socklen_t salen,
				char *host, size_t hostlen,
				char *service, size_t servlen, int flags);
									Returns: 0 if OK, nonzero error code on error
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046939" id="P7000497027000000000000000046939">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004693A" id="P700049702700000000000000004693A">sa</code> argument points to a socket address structure of size <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004693B" id="P700049702700000000000000004693B">salen</code> bytes, <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004693C" id="P700049702700000000000000004693C">host</code> to a buffer of size <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004693D" id="P700049702700000000000000004693D">hostlen</code> bytes, and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004693E" id="P700049702700000000000000004693E">service</code> to a buffer of size <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004693F" id="P700049702700000000000000004693F">servlen</code> bytes. The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046940" id="P7000497027000000000000000046940">getnameinfo</code> function converts the socket address structure <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046941" id="P7000497027000000000000000046941">sa</code> to the corresponding <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046942" id="P7000497027000000000000000046942">host</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046943" id="P7000497027000000000000000046943">service</code> name strings and copies them to the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046944" id="P7000497027000000000000000046944">host</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046945" id="P7000497027000000000000000046945">service</code> buffers. If <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046946" id="P7000497027000000000000000046946">getnameinfo</code> returns a nonzero error code, the application can convert it to a string by calling <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046947" id="P7000497027000000000000000046947">gai_strerror</code>.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046948" id="P7000497027000000000000000046948">If we don't want the hostname, we can <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046949" id="P7000497027000000000000000046949">set host</code> to NULL and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004694A" id="P700049702700000000000000004694A">hostlen</code> to zero. The same holds for the service fields. However, one or the other must be set.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004694B" id="P700049702700000000000000004694B">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004694C" id="P700049702700000000000000004694C">flags</code> argument is a bit mask that modifies the default behavior. You create it by <span class="pcalibre1 pcalibre29 pcalibre2">or</span>ing combinations of various values. Here are a couple of useful ones:</p>
<ul class="pcalibre38 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004694D" id="P700049702700000000000000004694D">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004694E" id="P700049702700000000000000004694E"><p class="pcalibre1 pcalibre2 pcalibre40" data-uri="chapter11.xhtml#P700049702700000000000000004694F" id="P700049702700000000000000004694F">NI_NUMERICHOST. By default, <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046950" id="P7000497027000000000000000046950">getnameinfo</code> tries to return a domain name in <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046951" id="P7000497027000000000000000046951">host</code>. Setting this flag will cause it to return a numeric address string instead.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046952" id="P7000497027000000000000000046952"><p class="pcalibre1 pcalibre2 pcalibre40" data-uri="chapter11.xhtml#P7000497027000000000000000046953" id="P7000497027000000000000000046953">NI_NUMERICSERV. By default, <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046954" id="P7000497027000000000000000046954">getnameinfo</code> will look in <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046955" id="P7000497027000000000000000046955">/etc/services</code> and if possible, return a service name instead of a port number. Setting this flag forces it to skip the lookup and simply return the port number.</p></li>
</ul>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007DE7" id="P7000497027000000000000000007DE7">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007DE8" epub:type="pagebreak" id="P7000497027000000000000000007DE8" title="941"></span>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046956" id="P7000497027000000000000000046956"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046957" id="P7000497027000000000000000046957">
1	#include "csapp.h"
2	
3	int main(int argc, char **argv)
4	{
5		struct addrinfo *p, *listp, hints;
6		char buf[MAXLINE];
7		int rc, flags;
8	
9		if (argc != 2) {
10			fprintf(stderr, "usage: %s &lt;domain name&gt;\n", argv[0]);
11			exit(0);
12		}
13	
14		/* Get a list of addrinfo records */
15		memset(&amp;hints, 0, sizeof(struct addrinfo));
16		hints.ai_family = AF_INET; /* IPv4 only */
17		hints.ai_socktype = SOCK_STREAM; /* Connections only */
18		if ((rc = getaddrinfo(argv[1], NULL, &amp;hints, &amp;listp)) != 0) {
19			fprintf(stderr, "getaddrinfo error: %s\n", gai_strerror(rc));
20			exit(1);
21	}
22	
23		/* Walk the list and display each IP address */
24		flags = NI_NUMERICHOST; /* Display address string instead of domain name */
25		for (p = listp; p; p = p-&gt;ai_next) {
26			Getnameinfo(p-&gt;ai_addr, p-&gt;ai_addrlen, buf, MAXLINE, NULL, 0, flags);
27			printf("%s\n", buf);
28		}
29	
30		/* Clean up */
31		Freeaddrinfo(listp);
32	
33		exit(0);
34	}
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046958" id="P7000497027000000000000000046958"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046959" epub:type="title" id="P7000497027000000000000000046959"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.17 </span>H<span class="pcalibre1 pcalibre2 pcalibre84">ostinfo</span> displays the mapping of a domain name to its associated IP addresses.</h1></header>
</figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004695A" id="P700049702700000000000000004695A"><a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007DE7"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.17</span></a> shows a simple program, called <span class="pcalibre1 pcalibre29 pcalibre2">hostinfo</span>, that uses <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004695B" id="P700049702700000000000000004695B">getaddrinfo</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004695C" id="P700049702700000000000000004695C">getnameinfo</code> to display the mapping of a domain name to its associated IP addresses. It is similar to the <span class="pcalibre1 pcalibre29 pcalibre2">nslookup </span>program from <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007BFE.xhtml#P7000497027000000000000000007C6B"><span class="pcalibre1 pcalibre21 pcalibre2">Section </span><span class="pcalibre1 pcalibre21 pcalibre2">11.3.2</span></a>.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004695D" id="P700049702700000000000000004695D">First, we initialize the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004695E" id="P700049702700000000000000004695E">hints</code> structure so that <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004695F" id="P700049702700000000000000004695F">getaddrinfo</code> returns the addresses we want. In this case, we are looking for 32-bit IP addresses (line 16) <span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007DF3" epub:type="pagebreak" id="P7000497027000000000000000007DF3" title="942"></span>that can be used as end points of connections (line 17). Since we are only asking <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046960" id="P7000497027000000000000000046960">getaddrinfo</code> to convert domain names, we call it with a NULL <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046961" id="P7000497027000000000000000046961">service</code> argument.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046962" id="P7000497027000000000000000046962">After the call to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046963" id="P7000497027000000000000000046963">getaddrinfo</code>, we walk the list of <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046964" id="P7000497027000000000000000046964">addrinfo</code> structures, using <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046965" id="P7000497027000000000000000046965">getnameinfo</code> to convert each socket address to a dotted-decimal address string. After walking the list, we are careful to free it by calling <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046966" id="P7000497027000000000000000046966">freeaddrinfo</code> (although for this simple program it is not strictly necessary).</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046967" id="P7000497027000000000000000046967">When we run <span class="pcalibre1 pcalibre29 pcalibre2">hostinfo</span>, we see that <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046968" id="P7000497027000000000000000046968"><a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="http://twitter.com">twitter.com</a></code> maps to four IP addresses, which is what we saw using <span class="pcalibre1 pcalibre29 pcalibre2">nslookup </span>in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007BFE.xhtml#P7000497027000000000000000007C6B"><span class="pcalibre1 pcalibre21 pcalibre2">Section </span><span class="pcalibre1 pcalibre21 pcalibre2">11.3.2</span></a>.</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046969" id="P7000497027000000000000000046969"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004696A" id="P700049702700000000000000004696A">
linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">./hostinfo twitter.com</i>
199.16.156.102
199.16.156.230
199.16.156.6
199.16.156.70
</code></pre>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007DFF" epub:type="practice" id="P7000497027000000000000000007DFF"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre127 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004696B" epub:type="title" id="P700049702700000000000000004696B"><span class="pcalibre1 pcalibre21 pcalibre2">Practice Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">11.4 </span>(solution page <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" epub:type="pagebreak" href="fileP7000497027000000000000000008021.xhtml#P7000497027000000000000000008049">968</a>)</h1></header>
<ol class="pcalibre1 pcalibre2 pcalibre77" data-uri="chapter11.xhtml#P700049702700000000000000004696C" id="P700049702700000000000000004696C">
<li class="pcalibre1 pcalibre2 pcalibre78" data-uri="chapter11.xhtml#P700049702700000000000000004696D" id="P700049702700000000000000004696D">
<div class="pcalibre1 pcalibre2 pcalibre7" data-uri="chapter11.xhtml#P700049702700000000000000004696E" id="P700049702700000000000000004696E"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004696F" id="P700049702700000000000000004696F">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046970" id="P7000497027000000000000000046970">getaddrinfo</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046971" id="P7000497027000000000000000046971">getnameinfo</code> functions subsume the functionality of <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046972" id="P7000497027000000000000000046972">inet_pton</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046973" id="P7000497027000000000000000046973">inet_ntop</code>, respectively, and they provide a higher-level of abstraction that is independent of any particular address format. To convince yourself how handy this is, write a version of <span class="pcalibre1 pcalibre29 pcalibre2">hostinfo </span>(<a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007DE7"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.17</span></a>) that uses <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046974" id="P7000497027000000000000000046974">inet_ntop</code> instead of <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046975" id="P7000497027000000000000000046975">getnameinfo</code> to convert each socket address to a dotted-decimal address string.</p></div></li>
</ol>
</section>
</section>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007E0B" id="P7000497027000000000000000007E0B"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046976" epub:type="title" id="P7000497027000000000000000046976"><span class="pcalibre1 pcalibre21 pcalibre2">11.4.8 </span>Helper Functions for the Sockets Interface</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046977" id="P7000497027000000000000000046977">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046978" id="P7000497027000000000000000046978">getaddrinfo</code> function and the sockets interface can seem somewhat daunting when you first learn about them. We find it convenient to wrap them with higher-level helper functions, called <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046979" id="P7000497027000000000000000046979">open_clientfd</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004697A" id="P700049702700000000000000004697A">open_listenfd</code>, that clients and servers can use when they want to communicate with each other.</p>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007E11" id="P7000497027000000000000000007E11"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004697B" epub:type="title" id="P700049702700000000000000004697B">The <code class="pcalibre1 pcalibre2 calibre16" data-uri="chapter11.xhtml#P700049702700000000000000004697C" id="P700049702700000000000000004697C">open_clientfd</code> Function</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004697D" id="P700049702700000000000000004697D">A client establishes a connection with a server by calling <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004697E" id="P700049702700000000000000004697E">open_clientfd</code>.</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004697F" id="P700049702700000000000000004697F"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046980" id="P7000497027000000000000000046980">
#include "csapp.h"
int open_clientfd(char *hostname, char *port);
Returns: descriptor if OK, âˆ’1 on error
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046981" id="P7000497027000000000000000046981">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046982" id="P7000497027000000000000000046982">open_clientfd</code> function establishes a connection with a server running on host <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046983" id="P7000497027000000000000000046983">hostname</code> and listening for connection requests on port number port. It returns an open socket descriptor that is ready for input and output using the Unix I/O functions. <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007E1F"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.18</span></a> shows the code for <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046984" id="P7000497027000000000000000046984">open_clientfd.</code></p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046985" id="P7000497027000000000000000046985">We call <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046986" id="P7000497027000000000000000046986">getaddrinfo</code>, which returns a list of <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046987" id="P7000497027000000000000000046987">addrinfo</code> structures, each of which points to a socket address structure that is suitable for establishing a connection</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007E1F" id="P7000497027000000000000000007E1F">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007E20" epub:type="pagebreak" id="P7000497027000000000000000007E20" title="943"></span>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046988" id="P7000497027000000000000000046988"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046989" id="P7000497027000000000000000046989">
1	int open_clientfd(char *hostname, char *port) {
2		int clientfd;
3		struct addrinfo hints, *listp, *p;
4	
5		/* Get a list of potential server addresses */
6		memset(&amp;hints, 0, sizeof(struct addrinfo));
7		hints.ai_socktype = SOCK_STREAM; /* Open a connection */
8		hints.ai_flags = AI_NUMERICSERV; /* ... using a numeric port arg. */
9		hints.ai_flags |= AI_ADDRCONFIG; /* Recommended for connections */
10		Getaddrinfo(hostname, port, &amp;hints, &amp;listp);
11	
12		/* Walk the list for one that we can successfully connect to */
13		for (p = listp; p; p = p-&gt;ai_next) {
14			/* Create a socket descriptor */
15			if ((clientfd = socket(p-&gt;ai_family, p-&gt;ai_socktype, p-&gt;ai_protocol)) &lt; 0)
16				continue; /* Socket failed, try the next */
17	
18			/* Connect to the server */
19			if (connect(clientfd, p-&gt;ai_addr, p-&gt;ai_addrlen) != âˆ’1)
20				break; /* Success */
21			Close(clientfd); /* Connect failed, try another */
22		}
23	
24		/* Clean up */
25		Freeaddrinfo(listp);
26		if (!p) /* All connects failed */
27			return âˆ’1;
28		else	/* The last connect succeeded */
29		return clientfd;
30	}
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P700049702700000000000000004698A" id="P700049702700000000000000004698A"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P700049702700000000000000004698B" epub:type="title" id="P700049702700000000000000004698B"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.18 </span><code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004698C" id="P700049702700000000000000004698C">open_clientfd</code>: Helper function that establishes a connection with a server.</h1></header>
<div class="pcalibre1 caption pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004698D" id="P700049702700000000000000004698D"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P700049702700000000000000004698E" id="P700049702700000000000000004698E">It is reentrant and protocol-independent.</p></div></figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004698F" id="P700049702700000000000000004698F">with a server running on <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046990" id="P7000497027000000000000000046990">hostname</code> and listening on <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046991" id="P7000497027000000000000000046991">port</code>. We then walk the list, trying each list entry in turn, until the calls to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046992" id="P7000497027000000000000000046992">socket</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046993" id="P7000497027000000000000000046993">connect</code> succeed. If the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046994" id="P7000497027000000000000000046994">connect</code> fails, we are careful to close the socket descriptor before trying the next entry. If the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046995" id="P7000497027000000000000000046995">connect</code> succeeds, we free the list memory and return the socket descriptor to the client, which can immediately begin using Unix I/O to communicate with the server.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046996" id="P7000497027000000000000000046996">Notice how there is no dependence on any particular version of IP anywhere in the code. The arguments to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046997" id="P7000497027000000000000000046997">socket</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046998" id="P7000497027000000000000000046998">connect</code> are generated for us automatically by <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046999" id="P7000497027000000000000000046999">getaddrinfo</code>, which allows our code to be clean and portable.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007E33" id="P7000497027000000000000000007E33"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004699A" epub:type="title" id="P700049702700000000000000004699A"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007E35" epub:type="pagebreak" id="P7000497027000000000000000007E35" title="944"></span>The <code class="pcalibre1 pcalibre2 calibre16" data-uri="chapter11.xhtml#P700049702700000000000000004699B" id="P700049702700000000000000004699B">open_listenfd</code> Function</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004699C" id="P700049702700000000000000004699C">A server creates a listening descriptor that is ready to receive connection requests by calling the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004699D" id="P700049702700000000000000004699D">open_listenfd</code> function.</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P700049702700000000000000004699E" id="P700049702700000000000000004699E"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P700049702700000000000000004699F" id="P700049702700000000000000004699F">
#include "csapp.h"
int open_listenfd(char *port);
Returns: descriptor if OK, âˆ’1 on error
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469A0" id="P70004970270000000000000000469A0">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469A1" id="P70004970270000000000000000469A1">open_listenfd</code> function returns a listening descriptor that is ready to receive connection requests on port <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469A2" id="P70004970270000000000000000469A2">port</code>. <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007E55"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.19</span></a> shows the code for <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469A3" id="P70004970270000000000000000469A3">open_listenfd</code>.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469A4" id="P70004970270000000000000000469A4">The style is similar to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469A5" id="P70004970270000000000000000469A5">open_clientfd</code>. We call <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469A6" id="P70004970270000000000000000469A6">getaddrinfo</code> and then walk the resulting list until the calls to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469A7" id="P70004970270000000000000000469A7">socket</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469A8" id="P70004970270000000000000000469A8">bind</code> succeed. Note that in line 20 we use the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469A9" id="P70004970270000000000000000469A9">setsockopt</code> function (not described here) to configure the server so that it can be terminated, be restarted, and begin accepting connection requests immediately. By default, a restarted server will deny connection requests from clients for approximately 30 seconds, which seriously hinders debugging.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469AA" id="P70004970270000000000000000469AA">Since we have called <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469AB" id="P70004970270000000000000000469AB">getaddrinfo</code> with the AI_PASSIVE flag and a NULL <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469AC" id="P70004970270000000000000000469AC">host</code> argument, the address field in each socket address structure is set to the wildcard address, which tells the kernel that this server will accept requests to any of the IP addresses for this host.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469AD" id="P70004970270000000000000000469AD">Finally, we call the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469AE" id="P70004970270000000000000000469AE">listen</code> function to convert <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469AF" id="P70004970270000000000000000469AF">listenfd</code> to a listening descriptor and return it to the caller. If the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469B0" id="P70004970270000000000000000469B0">listen</code> fails, we are careful to avoid a memory leak by closing the descriptor before returning.</p>
</section>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007E4C" id="P7000497027000000000000000007E4C"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469B1" epub:type="title" id="P70004970270000000000000000469B1"><span class="pcalibre1 pcalibre21 pcalibre2">11.4.9 </span>Example Echo Client and Server</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469B2" id="P70004970270000000000000000469B2">The best way to learn the sockets interface is to study example code. <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007E5E"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.20</span></a> shows the code for an echo client. After establishing a connection with the server, the client enters a loop that repeatedly reads a text line from standard input, sends the text line to the server, reads the echo line from the server, and prints the result to standard output. The loop terminates when <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469B3" id="P70004970270000000000000000469B3">fgets</code> encounters EOF on standard input, either because the user typed Ctrl+D at the keyboard or because it has exhausted the text lines in a redirected input file.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469B4" id="P70004970270000000000000000469B4">After the loop terminates, the client closes the descriptor. This results in an EOF notification being sent to the server, which it detects when it receives a return code of zero from its <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469B5" id="P70004970270000000000000000469B5">rio_readlineb</code> function. After closing its descriptor, the client terminates. Since the client's kernel automatically closes all open descriptors when a process terminates, the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469B6" id="P70004970270000000000000000469B6">close</code> in line 24 is not necessary. However, it is good programming practice to explicitly close any descriptors that you have opened.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469B7" id="P70004970270000000000000000469B7"><a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007E72"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.21</span></a> shows the main routine for the echo server. After opening the listening descriptor, it enters an infinite loop. Each iteration waits for a connection request from a client, prints the domain name and port of the connected client, and then calls the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469B8" id="P70004970270000000000000000469B8">echo</code> function that services the client. After the echo routine returns,</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007E55" id="P7000497027000000000000000007E55">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007E56" epub:type="pagebreak" id="P7000497027000000000000000007E56" title="945"></span>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000469B9" id="P70004970270000000000000000469B9"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469BA" id="P70004970270000000000000000469BA">
1	int open_listenfd(char *port)
2	{
3		struct addrinfo hints, *listp, *p;
4		int listenfd, optval=1;
5	
6		/* Get a list of potential server addresses */
7		memset(&amp;hints, 0, sizeof(struct addrinfo));
8		hints.ai_socktype = SOCK_STREAM;				/* Accept connections */
9		hints.ai_flags = AI_PASSIVE	|		AI_ADDRCONFIG;	/* ... on any IP address */
10		hints.ai_flags |= AI_NUMERICSERV;				/* ... using port number */
11		Getaddrinfo(NULL, port, &amp;hints, &amp;listp);
12	
13		/* Walk the list for one that we can bind to */
14		for (p = listp; p; p = p-&gt;ai_next) {
15			/* Create a socket descriptor */
16			if ((listenfd = socket(p-&gt;ai_family, p-&gt;ai_socktype, p-&gt;ai_protocol)) &lt; 0)
17				continue; /* Socket failed, try the next */
18	
19			/* Eliminates "Address already in use" error from bind */
20			Setsockopt(listenfd, SOL_SOCKET, SO_REUSEADDR,
21					(const void *)&amp;optval , sizeof(int));
22	
23			/* Bind the descriptor to the address */
24			if (bind(listenfd, p-&gt;ai_addr, p-&gt;ai_addrlen) == 0)
25				break; /* Success */
26			Close(listenfd); /* Bind failed, try the next */
27		}
28	
29		/* Clean up */
30		Freeaddrinfo(listp);
31		if (!p) /* No address worked */
32			return -1;
33	
34		/* Make it a listening socket ready to accept connection requests */
35		if (listen(listenfd, LISTENQ) &lt; 0) {
36			Close(listenfd);
37			return âˆ’1;
38		}
39		return listenfd;
40	}
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P70004970270000000000000000469BB" id="P70004970270000000000000000469BB"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P70004970270000000000000000469BC" epub:type="title" id="P70004970270000000000000000469BC"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.19 </span><code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469BD" id="P70004970270000000000000000469BD">open_listenfd</code>: Helper function that opens and returns a listening descriptor.</h1></header>
<div class="pcalibre1 caption pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469BE" id="P70004970270000000000000000469BE"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000469BF" id="P70004970270000000000000000469BF">It is reentrant and protocol-independent.</p></div></figcaption>
</figure>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007E5E" id="P7000497027000000000000000007E5E">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007E5F" epub:type="pagebreak" id="P7000497027000000000000000007E5F" title="946"></span>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000469C0" id="P70004970270000000000000000469C0"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469C1" id="P70004970270000000000000000469C1">
1	#include "csapp.h"
2	
3	int main(int argc, char **argv)
4	{
5		int clientfd;
6		char *host, *port, buf[MAXLINE];
7		rio_t rio;
8
9		if (argc != 3) {
10			fprintf(stderr, "usage: %s &lt;host&gt; &lt;port&gt;\n", argv[0]);
11			exit(0);
12		}
13		host = argv[1];
14		port = argv[2];
15	
16		clientfd = Open_clientfd(host, port);
17		Rio_readinitb(,&amp;rio, clientfd);
18	
19		while (Fgets(buf, MAXLINE, stdin) != NULL) {
20			Rio_writen(clientfd, buf, strlen(buf));
21			Rio_readlineb(&amp;rio, buf, MAXLINE);
22			Fputs(buf, stdout);
23		}
24		Close(clientfd);
25		exit(0);
26	}
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P70004970270000000000000000469C2" id="P70004970270000000000000000469C2"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P70004970270000000000000000469C3" epub:type="title" id="P70004970270000000000000000469C3"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.20 </span>Echo client main routine.</h1></header>
</figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469C4" id="P70004970270000000000000000469C4">the main routine closes the connected descriptor. Once the client and server have closed their respective descriptors, the connection is terminated.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469C5" id="P70004970270000000000000000469C5">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469C6" id="P70004970270000000000000000469C6">clientaddr</code> variable in line 9 is a socket address structure that is passed to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469C7" id="P70004970270000000000000000469C7">accept</code>. Before <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469C8" id="P70004970270000000000000000469C8">accept</code> returns, it fills in <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469C9" id="P70004970270000000000000000469C9">clientaddr</code> with the socket address of the client on the other end of the connection. Notice how we declare <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469CA" id="P70004970270000000000000000469CA">clientaddr</code> as type struct <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469CB" id="P70004970270000000000000000469CB">sockaddr_storage</code> rather than struct <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469CC" id="P70004970270000000000000000469CC">sockaddr_in</code>. By definition, the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469CD" id="P70004970270000000000000000469CD">sockaddr_storage</code> structure is large enough to hold any type of socket address, which keeps the code protocol-independent.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469CE" id="P70004970270000000000000000469CE">Notice that our simple echo server can only handle one client at a time. A server of this type that iterates through clients, one at a time, is called an <i class="pcalibre17 pcalibre2 pcalibre1">iterative server</i>. In <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000008060.xhtml#P7000497027000000000000000008060"><span class="pcalibre1 pcalibre21 pcalibre2">Chapter </span><span class="pcalibre1 pcalibre21 pcalibre2">12</span></a>, we will learn how to build more sophisticated <i class="pcalibre17 pcalibre2 pcalibre1">concurrent servers</i> that can handle multiple clients simultaneously.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469CF" id="P70004970270000000000000000469CF">Finally, <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007E78"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.22</span></a> shows the code for the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469D0" id="P70004970270000000000000000469D0">echo</code> routine, which repeatedly reads and writes lines of text until the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469D1" id="P70004970270000000000000000469D1">rio_readlineb</code> function encounters EOF in line 10.</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007E72" id="P7000497027000000000000000007E72">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007E73" epub:type="pagebreak" id="P7000497027000000000000000007E73" title="947"></span>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000469D2" id="P70004970270000000000000000469D2"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469D3" id="P70004970270000000000000000469D3">
1	#include "csapp.h"
2	
3	void echo(int connfd);
4	
5	int main(int argc, char **argv)
6	{
7		int listenfd, connfd;
8		socklen_t clientlen;
9		struct sockaddr_storage clientaddr; /* Enough space for any address */
10		char client_hostname[MAXLINE], client_port[MAXLINE];
11	
12		if (argc != 2) {
13			fprintf(stderr, "usage: %s &lt;port&gt;\n", argv[0]);
14			exit(0);
15		}
16	
17		listenfd = Open_listenfd(argv[1]);
18		while (1) {
19			clientlen = sizeof(struct sockaddr_storage);
20			connfd = Accept(listenfd, (SA *)&amp;clientaddr, &amp;clientlen);
21			Getnameinfo((SA *) &amp;clientaddr, clientlen, client_hostname, MAXLINE,
22				client_port, MAXLINE, 0);
23			printf("Connected to (%s, %s)\n", client_hostname, client_port);
24			echo(connfd);
25			Close(connfd);
26		}
27		exit(0);
28	}
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P70004970270000000000000000469D4" id="P70004970270000000000000000469D4"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P70004970270000000000000000469D5" epub:type="title" id="P70004970270000000000000000469D5"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.21 </span>Iterative echo server main routine.</h1></header>
</figcaption>
</figure>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007E78" id="P7000497027000000000000000007E78">
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000469D6" id="P70004970270000000000000000469D6"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469D7" id="P70004970270000000000000000469D7">
1	#include "csapp.h"
2	
3	void echo(int connfd)
4	{
5		size_t n;
6		char buf[MAXLINE];
7		rio_t rio; 8
9		Rio_readinitb(&amp;rio, connfd);
10		while((n = Rio_readlineb(&amp;rio, buf, MAXLINE)) != 0) {
11			printf("server received %d bytes\n", (int)n);
12			Rio_writen(connfd, buf, n);
13		}
14	}
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P70004970270000000000000000469D8" id="P70004970270000000000000000469D8"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P70004970270000000000000000469D9" epub:type="title" id="P70004970270000000000000000469D9"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.22 </span><code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469DA" id="P70004970270000000000000000469DA">echo</code> function that reads and echoes text lines.</h1></header>
</figcaption>
</figure>
<aside class="pcalibre31 pcalibre32 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000007E7E" id="P7000497027000000000000000007E7E"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre33" data-uri="chapter11.xhtml#P70004970270000000000000000469DB" epub:type="title" id="P70004970270000000000000000469DB"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007E80" epub:type="pagebreak" id="P7000497027000000000000000007E80" title="948"></span><span class="pcalibre1 pcalibre2 pcalibre34">Aside </span>What does EOF on a connection mean?</h1></header>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P70004970270000000000000000469DC" id="P70004970270000000000000000469DC">The idea of EOF is often confusing to students, especially in the context of Internet connections. First, we need to understand that there is no such thing as an EOF character. Rather, EOF is a condition that is detected by the kernel. An application finds out about the EOF condition when it receives a zero return code from the read function. For disk files, EOF occurs when the current file position exceeds the file length. For Internet connections, EOF occurs when a process closes its end of the connection. The process at the other end of the connection detects the EOF when it attempts to read past the last byte in the stream.</p>
</aside>
</section>
</section></body></html>
<?xml version='1.0' encoding='utf-8'?>
<html epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg">
<head>
<meta content="PXE Basic 1.0" name="dcterms.conformsTo"/>
<meta content="PXE Tools version 1.39.52" name="generator"/>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
<title>11.5 Web Servers</title>
<link href="../css/theme/night.css" rel="alternate stylesheet" title="night" type="text/css"/>
<link href="../css/theme/sepia.css" rel="alternate stylesheet" title="sepia" type="text/css"/>
<script src="js/format_lg_obj.js"></script>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body class="pcalibre1 pcalibre2 pcalibre" epub:type="bodymatter">
<section class="pcalibre1 pcalibre2 pcalibre3" id="P7000497027000000000000000007E82"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre2 pcalibre4" data-uri="chapter11.xhtml#P70004970270000000000000000469DD" epub:type="title" id="P70004970270000000000000000469DD"><span class="pcalibre1 pcalibre21 pcalibre2">11.5 </span>Web Servers</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469DE" id="P70004970270000000000000000469DE">So far we have discussed network programming in the context of a simple echo server. In this section, we will show you how to use the basic ideas of network programming to build your own small, but quite functional, Web server.</p>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007E85" id="P7000497027000000000000000007E85"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469DF" epub:type="title" id="P70004970270000000000000000469DF"><span class="pcalibre1 pcalibre21 pcalibre2">11.5.1 </span>Web Basics</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469E0" id="P70004970270000000000000000469E0">Web clients and servers interact using a text-based application-level protocol known as <i class="pcalibre17 pcalibre2 pcalibre1">HTTP (hypertext transfer protocol).</i> HTTP is a simple protocol. A Web client (known as a <i class="pcalibre17 pcalibre2 pcalibre1">browser)</i> opens an Internet connection to a server and requests some <i class="pcalibre17 pcalibre2 pcalibre1">content.</i> The server responds with the requested content and then closes the connection. The browser reads the content and displays it on the screen.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469E1" id="P70004970270000000000000000469E1">What distinguishes Web services from conventional file retrieval services such as FTP? The main difference is that Web content can be written in a language known as <i class="pcalibre17 pcalibre2 pcalibre1">HTML (hypertext markup language).</i> An HTML program (page) contains instructions (tags) that tell the browser how to display various text and graphical objects in the page. For example, the code</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000469E2" id="P70004970270000000000000000469E2"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469E3" id="P70004970270000000000000000469E3"><b class="pcalibre1 pcalibre2 pcalibre12"> Make me bold! </b></code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469E4" id="P70004970270000000000000000469E4">tells the browser to print the text between the <b class="pcalibre1 pcalibre2 pcalibre12"> and </b> tags in boldface type. However, the real power of HTML is that a page can contain pointers (hyperlinks) to content stored on any Internet host. For example, an HTML line of the form</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P70004970270000000000000000469E5" id="P70004970270000000000000000469E5"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469E6" id="P70004970270000000000000000469E6">Carnegie Mellon</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469E7" id="P70004970270000000000000000469E7">tells the browser to highlight the text object <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469E8" id="P70004970270000000000000000469E8">Carnegie Mellon</code> and to create a hyperlink to an HTML file called <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469E9" id="P70004970270000000000000000469E9">index.html</code> that is stored on the CMU Web server. If the user clicks on the highlighted text object, the browser requests the corresponding HTML file from the CMU server and displays it.</p>
<aside class="pcalibre31 pcalibre32 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000007E91" id="P7000497027000000000000000007E91"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre33" data-uri="chapter11.xhtml#P70004970270000000000000000469EA" epub:type="title" id="P70004970270000000000000000469EA"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007E93" epub:type="pagebreak" id="P7000497027000000000000000007E93" title="949"></span><span class="pcalibre1 pcalibre2 pcalibre34">Aside </span>Origins of the World Wide Web</h1></header>
<p class="pcalibre1 pcalibre2 pcalibre40" data-uri="chapter11.xhtml#P70004970270000000000000000469EB" id="P70004970270000000000000000469EB">The World Wide Web was invented by Tim Berners-Lee, a software engineer working at CERN, a Swiss physics lab. In 1989, Berners-Lee wrote an internal memo proposing a distributed hypertext system that would connect a "web of notes with links." The intent of the proposed system was to help CERN scientists share and manage information. Over the next two years, after Berners-Lee implemented the first Web server and Web browser, the Web developed a small following within CERN and a few other sites. A pivotal event occurred in 1993, when Marc Andreesen (who later founded Netscape and Andreessen Horowitz) and his colleagues at NCSA released a graphical browser called <span class="pcalibre1 pcalibre29 pcalibre2">mosaic </span>for all three major platforms: Linux, Windows, and Macintosh. After the release of <span class="pcalibre1 pcalibre29 pcalibre2">mosaic</span>, interest in the Web exploded, with the number of Web sites increasing at an exponential rate. By 2015, there were over 975,000,000 sites worldwide.</p>
<div class="pcalibre1 pcalibre2 pcalibre307" data-uri="chapter11.xhtml#P70004970270000000000000000469EC" id="P70004970270000000000000000469EC"><p class="pcalibre1 pcalibre2 calibre15" data-uri="chapter11.xhtml#P70004970270000000000000000469ED" id="P70004970270000000000000000469ED">(<span class="pcalibre1 pcalibre21 pcalibre2">Source:</span> Netcraft Web Survey)</p></div>
</aside>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007E97" id="P7000497027000000000000000007E97">
<table class="pcalibre1 pcalibre2 pcalibre43" data-uri="chapter11.xhtml#P70004970270000000000000000469EE" id="P70004970270000000000000000469EE">
<thead class="pcalibre44 pcalibre2 pcalibre1">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<th class="pcalibre1 pcalibre2 calibre5" data-uri="chapter11.xhtml#P70004970270000000000000000469EF" id="P70004970270000000000000000469EF">MIME type</th>
<th class="pcalibre1 pcalibre2 calibre5" data-uri="chapter11.xhtml#P70004970270000000000000000469F0" id="P70004970270000000000000000469F0">Description</th>
</tr>
</thead>
<tbody class="pcalibre1 pcalibre2 calibre6">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P70004970270000000000000000469F1" id="P70004970270000000000000000469F1"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469F2" id="P70004970270000000000000000469F2">text/html</code></td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P70004970270000000000000000469F3" id="P70004970270000000000000000469F3">HTML page</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P70004970270000000000000000469F4" id="P70004970270000000000000000469F4"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469F5" id="P70004970270000000000000000469F5">text/plain</code></td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P70004970270000000000000000469F6" id="P70004970270000000000000000469F6">Unformatted text</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P70004970270000000000000000469F7" id="P70004970270000000000000000469F7"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469F8" id="P70004970270000000000000000469F8">application/postscript</code></td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P70004970270000000000000000469F9" id="P70004970270000000000000000469F9">Postscript document</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P70004970270000000000000000469FA" id="P70004970270000000000000000469FA"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469FB" id="P70004970270000000000000000469FB">image/gif</code></td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P70004970270000000000000000469FC" id="P70004970270000000000000000469FC">Binary image encoded in GIF format</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P70004970270000000000000000469FD" id="P70004970270000000000000000469FD"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P70004970270000000000000000469FE" id="P70004970270000000000000000469FE">image/png</code></td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P70004970270000000000000000469FF" id="P70004970270000000000000000469FF">Binary image encoded in PNG format</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A00" id="P7000497027000000000000000046A00"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A01" id="P7000497027000000000000000046A01">image/jpeg</code></td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A02" id="P7000497027000000000000000046A02">Binary image encoded in JPEG format</td>
</tr>
</tbody>
</table>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046A03" id="P7000497027000000000000000046A03"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046A04" epub:type="title" id="P7000497027000000000000000046A04"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.23 </span>Example MIME types.</h1></header>
</figcaption>
</figure>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007EAF" id="P7000497027000000000000000007EAF"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A05" epub:type="title" id="P7000497027000000000000000046A05"><span class="pcalibre1 pcalibre21 pcalibre2">11.5.2 </span>Web Content</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A06" id="P7000497027000000000000000046A06">To Web clients and servers, <i class="pcalibre17 pcalibre2 pcalibre1">content</i> is a sequence of bytes with an associated <i class="pcalibre17 pcalibre2 pcalibre1">MIME (multipurpose internet mail extensions)</i> type. <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007E97"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.23</span></a> shows some common MIME types.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A07" id="P7000497027000000000000000046A07">Web servers provide content to clients in two different ways:</p>
<ul class="pcalibre1 calibre9 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A08" id="P7000497027000000000000000046A08">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046A09" id="P7000497027000000000000000046A09"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046A0A" id="P7000497027000000000000000046A0A">Fetch a disk file and return its contents to the client. The disk file is known as <i class="pcalibre17 pcalibre2 pcalibre1">static content</i> and the process of returning the file to the client is known as <i class="pcalibre17 pcalibre2 pcalibre1">serving static content</i>.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046A0B" id="P7000497027000000000000000046A0B"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046A0C" id="P7000497027000000000000000046A0C">Run an executable file and return its output to the client. The output produced by the executable at run time is known as <i class="pcalibre17 pcalibre2 pcalibre1">dynamic content</i>, and the process of running the program and returning its output to the client is known as <i class="pcalibre17 pcalibre2 pcalibre1">serving dynamic content</i>.</p></li>
</ul>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A0D" id="P7000497027000000000000000046A0D">Every piece of content returned by a Web server is associated with some file that it manages. Each of these files has a unique name known as a <i class="pcalibre17 pcalibre2 pcalibre1">URL (universal resource locator)</i>. For example, the URL</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A0E" id="P7000497027000000000000000046A0E"><code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A0F" id="P7000497027000000000000000046A0F"><a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="http://www.google.com:80/index.html">http:/<wbr class="pcalibre1 pcalibre2"/>/<wbr class="pcalibre1 pcalibre2"/>www.google.com:80/<wbr class="pcalibre1 pcalibre2"/>index.html</a></code></p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A10" id="P7000497027000000000000000046A10"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007EBC" epub:type="pagebreak" id="P7000497027000000000000000007EBC" title="950"></span>identifies an HTML file called <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A11" id="P7000497027000000000000000046A11">/index.html</code> on Internet host <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A12" id="P7000497027000000000000000046A12"><a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="http://www.google.com">www.google.com</a></code> that is managed by a Web server listening on port 80. The port number is optional and defaults to the well-known HTTP port 80. URLs for executable files can include program arguments after the filename. A `?' character separates the filename from the arguments, and each argument is separated by an `&amp;' character. For example, the URL</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046A13" id="P7000497027000000000000000046A13"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A14" id="P7000497027000000000000000046A14">
<span class="pcalibre308 pcalibre2 pcalibre1">http://bluefish.ics.cs.cmu.edu:8000/cgi-bin/adder?15000&amp;213</span>
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A15" id="P7000497027000000000000000046A15">identifies an executable called <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A16" id="P7000497027000000000000000046A16">/cgi-bin/adder</code> that will be called with two argument strings: 15000 and 213. Clients and servers use different parts of the URL during a transaction. For instance, a client uses the prefix</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A17" id="P7000497027000000000000000046A17"><a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="http://www.google.com">http:/<wbr class="pcalibre1 pcalibre2"/>/<wbr class="pcalibre1 pcalibre2"/>www.google.com:80</a></p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A18" id="P7000497027000000000000000046A18">to determine what kind of server to contact, where the server is, and what port it is listening on. The server uses the suffix</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046A19" id="P7000497027000000000000000046A19"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A1A" id="P7000497027000000000000000046A1A">/index.html</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A1B" id="P7000497027000000000000000046A1B">to find the file on its filesystem and to determine whether the request is for static or dynamic content.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A1C" id="P7000497027000000000000000046A1C">There are several points to understand about how servers interpret the suffix of a URL:</p>
<ul class="pcalibre1 calibre9 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A1D" id="P7000497027000000000000000046A1D">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046A1E" id="P7000497027000000000000000046A1E"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046A1F" id="P7000497027000000000000000046A1F">There are no standard rules for determining whether a URL refers to static or dynamic content. Each server has its own rules for the files it manages. A classic (old-fashioned) approach is to identify a set of directories, such as <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A20" id="P7000497027000000000000000046A20">cgi-bin</code>, where all executables must reside.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046A21" id="P7000497027000000000000000046A21"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046A22" id="P7000497027000000000000000046A22">The initial `/' in the suffix does <i class="pcalibre17 pcalibre2 pcalibre1">not</i> denote the Linux root directory. Rather, it denotes the home directory for whatever kind of content is being requested. For example, a server might be configured so that all static content is stored in directory <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A23" id="P7000497027000000000000000046A23">/usr/httpd/html</code> and all dynamic content is stored in directory <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A24" id="P7000497027000000000000000046A24">/usr/httpd/cgi-bin</code>.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046A25" id="P7000497027000000000000000046A25"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046A26" id="P7000497027000000000000000046A26">The minimal URL suffix is the `/' character, which all servers expand to some default home page such as <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A27" id="P7000497027000000000000000046A27">/index.html</code>. This explains why it is possible to fetch the home page of a site by simply typing a domain name to the browser. The browser appends the missing `/' to the URL and passes it to the server, which expands the `/' to some default filename.</p></li>
</ul>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007ED4" id="P7000497027000000000000000007ED4"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A28" epub:type="title" id="P7000497027000000000000000046A28"><span class="pcalibre1 pcalibre21 pcalibre2">11.5.3 </span>HTTP Transactions</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A29" id="P7000497027000000000000000046A29">Since HTTP is based on text lines transmitted over Internet connections, we can use the Linux <span class="pcalibre1 pcalibre29 pcalibre2">telnet </span>program to conduct transactions with any Web server on the Internet. The <span class="pcalibre1 pcalibre29 pcalibre2">telnet </span>program has been largely supplanted by <span class="pcalibre1 pcalibre29 pcalibre2">ssh </span>as a remote login tool, but it is very handy for debugging servers that talk to clients with text lines over connections. For example, <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007ED7"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.24</span></a> uses <span class="pcalibre1 pcalibre29 pcalibre2">telnet </span>to request the home page from the AOL Web server.</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007ED7" id="P7000497027000000000000000007ED7">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007ED8" epub:type="pagebreak" id="P7000497027000000000000000007ED8" title="951"></span>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046A2A" id="P7000497027000000000000000046A2A"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A2B" id="P7000497027000000000000000046A2B">
1	linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">telnet www.aol.com 80</i>		<b class="pcalibre1 pcalibre2 pcalibre12"><i class="pcalibre17 pcalibre2 pcalibre1">Client: open connection to server</i></b>
2	Trying 205.188.146.23...		<b class="pcalibre1 pcalibre2 pcalibre12"><i class="pcalibre17 pcalibre2 pcalibre1">Telnet prints 3 lines to the terminal</i></b>
3	Connected to aol.com.	
4	Escape character is `â]'. 
5	<i class="pcalibre17 pcalibre2 pcalibre1">GET / HTTP/1.1</i>				<b class="pcalibre1 pcalibre2 pcalibre12"><i class="pcalibre17 pcalibre2 pcalibre1">Client: request line</i></b>
6	<i class="pcalibre17 pcalibre2 pcalibre1">Host: www.aol.com</i>			<b class="pcalibre1 pcalibre2 pcalibre12"><i class="pcalibre17 pcalibre2 pcalibre1">Client: required HTTP/1.1 header</i></b>
7						<b class="pcalibre1 pcalibre2 pcalibre12"><i class="pcalibre17 pcalibre2 pcalibre1">Client: empty line terminates headers</i></b>
8	HTTP/1.0 200 OK				<b class="pcalibre1 pcalibre2 pcalibre12"><i class="pcalibre17 pcalibre2 pcalibre1">Server: response line</i></b>
9	MIME-Version: 1.0			<b class="pcalibre1 pcalibre2 pcalibre12"><i class="pcalibre17 pcalibre2 pcalibre1">Server: followed by five response headers</i></b>
10	Date: Mon, 8 Jan 2010 4:59:42 GMT	
11	Server: Apache-Coyote/1.1	
12	Content-Type: text/html			<b class="pcalibre1 pcalibre2 pcalibre12"><i class="pcalibre17 pcalibre2 pcalibre1">Server: expect HTML in the response body</i></b>
13	Content-Length: 42092			<b class="pcalibre1 pcalibre2 pcalibre12"><i class="pcalibre17 pcalibre2 pcalibre1">Server: expect 42,092 bytes in the response body</i></b>
14						<b class="pcalibre1 pcalibre2 pcalibre12"><i class="pcalibre17 pcalibre2 pcalibre1">Server: empty line terminates response headers</i></b>
15	&lt;html&gt;					<b class="pcalibre1 pcalibre2 pcalibre12"><i class="pcalibre17 pcalibre2 pcalibre1">Server: first HTML line in response body</i></b>
16	â€¦					<b class="pcalibre1 pcalibre2 pcalibre12"><i class="pcalibre17 pcalibre2 pcalibre1">Server: 766 lines of HTML not shown</i></b>
17	&lt;/html&gt;					<b class="pcalibre1 pcalibre2 pcalibre12"><i class="pcalibre17 pcalibre2 pcalibre1">Server: last HTML line in response body</i></b>
18	Connection closed by foreign host.	<b class="pcalibre1 pcalibre2 pcalibre12"><i class="pcalibre17 pcalibre2 pcalibre1">Server: closes connection</i></b>
19	linux&gt;					<b class="pcalibre1 pcalibre2 pcalibre12"><i class="pcalibre17 pcalibre2 pcalibre1">Client: closes connection and terminates</i></b>
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046A2C" id="P7000497027000000000000000046A2C"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046A2D" epub:type="title" id="P7000497027000000000000000046A2D"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.24 </span>Example of an HTTP transaction that serves static content.</h1></header>
</figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A2E" id="P7000497027000000000000000046A2E">In line 1, we run <span class="pcalibre1 pcalibre29 pcalibre2">telnet </span>from a Linux shell and ask it to open a connection to the AOL Web server. <span class="pcalibre1 pcalibre29 pcalibre2">telnet </span>prints three lines of output to the terminal, opens the connection, and then waits for us to enter text (line 5). Each time we enter a text line and hit the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A2F" id="P7000497027000000000000000046A2F">enter</code> key, <span class="pcalibre1 pcalibre29 pcalibre2">telnet </span>reads the line, appends carriage return and line feed characters (<code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A30" id="P7000497027000000000000000046A30">'\r\n'</code> in C notation), and sends the line to the server. This is consistent with the HTTP standard, which requires every text line to be terminated by a carriage return and line feed pair. To initiate the transaction, we enter an HTTP request (lines 5âˆ’7). The server replies with an HTTP response (lines 8âˆ’17) and then closes the connection (line 18).</p>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007EE0" id="P7000497027000000000000000007EE0"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A31" epub:type="title" id="P7000497027000000000000000046A31">HTTP Requests</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A32" id="P7000497027000000000000000046A32">An <i class="pcalibre17 pcalibre2 pcalibre1">HTTP request</i> consists of a <i class="pcalibre17 pcalibre2 pcalibre1">request line</i> (line 5), followed by zero or more <i class="pcalibre17 pcalibre2 pcalibre1">request headers</i> (line 6), followed by an empty text line that terminates the list of headers (line 7). A request line has the form</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A33" id="P7000497027000000000000000046A33"><i class="pcalibre17 pcalibre2 pcalibre1">method URI version</i></p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A34" id="P7000497027000000000000000046A34">HTTP supports a number of different <i class="pcalibre17 pcalibre2 pcalibre1">methods</i>, including GET, POST, OPTIONS, HEAD, PUT, DELETE, and TRACE. We will only discuss the workhorse GET method, which accounts for a majority of HTTP requests. The GET method instructs the server to generate and return the content identified by the <i class="pcalibre17 pcalibre2 pcalibre1">URI</i> <span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007EE5" epub:type="pagebreak" id="P7000497027000000000000000007EE5" title="952"></span><i class="pcalibre17 pcalibre2 pcalibre1">(uniform resource identifier)</i>. The URI is the suffix of the corresponding URL that includes the filename and optional arguments.<a class="pcalibre1 pcalibre2 pcalibre56 pcalibre16 pcalibre14 pcalibre15" epub:type="noteref" href="#P700049702700000000000000000805A" id="r__P700049702700000000000000000805A">3</a></p><aside class="pcalibre2 pcalibre32 pcalibre57" data-uri="chapter11.xhtml#P700049702700000000000000000805A" epub:type="footnote" id="P700049702700000000000000000805A"><p class="pcalibre1 pcalibre2 pcalibre10"><span class="pcalibre1 pcalibre58 pcalibre2"><a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="#r__P700049702700000000000000000805A">3. </a></span>Actually, this is only true when a browser requests content. If a proxy server requests content, then the URI must be the complete URL.</p></aside>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A35" id="P7000497027000000000000000046A35">The <i class="pcalibre17 pcalibre2 pcalibre1">version</i> field in the request line indicates the HTTP version to which the request conforms. The most recent HTTP version is HTTP/1.1 <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="fileP700049702700000000000000000B39D.xhtml#P700049702700000000000000000B3EB">[37]</a>. HTTP/1.0 is an earlier, much simpler version from 1996 <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="fileP700049702700000000000000000B39D.xhtml#P700049702700000000000000000B3AC">[6]</a>. HTTP/1.1 defines additional headers that provide support for advanced features such as caching and security, as well as a mechanism that allows a client and server to perform multiple transactions over the same <i class="pcalibre17 pcalibre2 pcalibre1">persistent connection</i>. In practice, the two versions are compatible because HTTP/1.0 clients and servers simply ignore unknown HTTP/1.1 headers.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A36" id="P7000497027000000000000000046A36">To summarize, the request line in line 5 asks the server to fetch and return the HTML file <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A37" id="P7000497027000000000000000046A37">/index.html</code>. It also informs the server that the remainder of the request will be in HTTP/1.1 format.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A38" id="P7000497027000000000000000046A38">Request headers provide additional information to the server, such as the brand name of the browser or the MIME types that the browser understands. Request headers have the form</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A39" id="P7000497027000000000000000046A39"><i class="pcalibre17 pcalibre2 pcalibre1">header-name</i>: <i class="pcalibre17 pcalibre2 pcalibre1">header-data</i></p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A3A" id="P7000497027000000000000000046A3A">For our purposes, the only header to be concerned with is the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A3B" id="P7000497027000000000000000046A3B">Host</code> header (line 6), which is required in HTTP/1.1 requests, but not in HTTP/1.0 requests. The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A3C" id="P7000497027000000000000000046A3C">Host</code> header is used by <i class="pcalibre17 pcalibre2 pcalibre1">proxy caches</i>, which sometimes serve as intermediaries between a browser and the <i class="pcalibre17 pcalibre2 pcalibre1">origin server</i> that manages the requested file. Multiple proxies can exist between a client and an origin server in a so-called proxy chain. The data in the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A3D" id="P7000497027000000000000000046A3D">Host</code> header, which identifies the domain name of the origin server, allow a proxy in the middle of a proxy chain to determine if it might have a locally cached copy of the requested content.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A3E" id="P7000497027000000000000000046A3E">Continuing with our example in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007ED7"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.24</span></a>, the empty text line in line 7 (generated by hitting <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A3F" id="P7000497027000000000000000046A3F">enter</code> on our keyboard) terminates the headers and instructs the server to send the requested HTML file.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007EF1" id="P7000497027000000000000000007EF1"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A40" epub:type="title" id="P7000497027000000000000000046A40">HTTP Responses</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A41" id="P7000497027000000000000000046A41">HTTP responses are similar to HTTP requests. An <i class="pcalibre17 pcalibre2 pcalibre1">HTTP response</i> consists of a <i class="pcalibre17 pcalibre2 pcalibre1">response line</i> (line 8), followed by zero or more <i class="pcalibre17 pcalibre2 pcalibre1">response headers</i> (lines 9âˆ’13), followed by an empty line that terminates the headers (line 14), followed by the <i class="pcalibre17 pcalibre2 pcalibre1">response body</i> (lines 15âˆ’17). A response line has the form</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A42" id="P7000497027000000000000000046A42"><i class="pcalibre17 pcalibre2 pcalibre1">version status-code status-message</i></p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A43" id="P7000497027000000000000000046A43">The <i class="pcalibre17 pcalibre2 pcalibre1">version</i> field describes the HTTP version that the response conforms to. The <i class="pcalibre17 pcalibre2 pcalibre1">status-code</i> is a three-digit positive integer that indicates the disposition of the request. The <i class="pcalibre17 pcalibre2 pcalibre1">status-message</i> gives the English equivalent of the error code. <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007EFA"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.25</span></a> lists some common status codes and their corresponding messages.</p>
<aside class="pcalibre31 pcalibre32 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000007EF6" id="P7000497027000000000000000007EF6"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre33" data-uri="chapter11.xhtml#P7000497027000000000000000046A44" epub:type="title" id="P7000497027000000000000000046A44"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007EF8" epub:type="pagebreak" id="P7000497027000000000000000007EF8" title="953"></span><span class="pcalibre1 pcalibre2 pcalibre34">Aside </span>Passing arguments in HTTP POST requests</h1></header>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046A45" id="P7000497027000000000000000046A45">Arguments for HTTP POST requests are passed in the request body rather than in the URI.</p>
</aside>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007EFA" id="P7000497027000000000000000007EFA">
<table class="pcalibre1 pcalibre2 pcalibre43" data-uri="chapter11.xhtml#P7000497027000000000000000046A46" id="P7000497027000000000000000046A46">
<thead class="pcalibre44 pcalibre2 pcalibre1">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<th class="pcalibre1 pcalibre2 calibre5" data-uri="chapter11.xhtml#P7000497027000000000000000046A47" id="P7000497027000000000000000046A47">Status code</th>
<th class="pcalibre1 pcalibre2 calibre5" data-uri="chapter11.xhtml#P7000497027000000000000000046A48" id="P7000497027000000000000000046A48">Status message</th>
<th class="pcalibre1 pcalibre2 calibre5" data-uri="chapter11.xhtml#P7000497027000000000000000046A49" id="P7000497027000000000000000046A49">Description</th>
</tr>
</thead>
<tbody class="pcalibre1 pcalibre2 calibre6">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A4A" id="P7000497027000000000000000046A4A">200</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A4B" id="P7000497027000000000000000046A4B">OK</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A4C" id="P7000497027000000000000000046A4C">Request was handled without error.</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A4D" id="P7000497027000000000000000046A4D">301</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A4E" id="P7000497027000000000000000046A4E">Moved permanently</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A4F" id="P7000497027000000000000000046A4F">Content has moved to the hostname in the Location header.</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A50" id="P7000497027000000000000000046A50">400</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A51" id="P7000497027000000000000000046A51">Bad request</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A52" id="P7000497027000000000000000046A52">Request could not be understood by the server.</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A53" id="P7000497027000000000000000046A53">403</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A54" id="P7000497027000000000000000046A54">Forbidden</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A55" id="P7000497027000000000000000046A55">Server lacks permission to access the requested file.</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A56" id="P7000497027000000000000000046A56">404</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A57" id="P7000497027000000000000000046A57">Not found</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A58" id="P7000497027000000000000000046A58">Server could not find the requested file.</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A59" id="P7000497027000000000000000046A59">501</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A5A" id="P7000497027000000000000000046A5A">Not implemented</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A5B" id="P7000497027000000000000000046A5B">Server does not support the request method.</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A5C" id="P7000497027000000000000000046A5C">505</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A5D" id="P7000497027000000000000000046A5D">HTTP version not supported</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A5E" id="P7000497027000000000000000046A5E">Server does not support version in request.</td>
</tr>
</tbody>
</table>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046A5F" id="P7000497027000000000000000046A5F"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046A60" epub:type="title" id="P7000497027000000000000000046A60"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.25 </span>Some HTTP status codes.</h1></header>
</figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A61" id="P7000497027000000000000000046A61">The response headers in lines 9âˆ’13 provide additional information about the response. For our purposes, the two most important headers are <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A62" id="P7000497027000000000000000046A62">Content-Type</code> (line 12), which tells the client the MIME type of the content in the response body, and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A63" id="P7000497027000000000000000046A63">Content-Length</code> (line 13), which indicates its size in bytes.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A64" id="P7000497027000000000000000046A64">The empty text line in line 14 that terminates the response headers is followed by the response body, which contains the requested content.</p>
</section>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007F1A" id="P7000497027000000000000000007F1A"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A65" epub:type="title" id="P7000497027000000000000000046A65"><span class="pcalibre1 pcalibre21 pcalibre2">11.5.4 </span>Serving Dynamic Content</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A66" id="P7000497027000000000000000046A66">If we stop to think for a moment how a server might provide dynamic content to a client, certain questions arise. For example, how does the client pass any program arguments to the server? How does the server pass these arguments to the child process that it creates? How does the server pass other information to the child that it might need to generate the content? Where does the child send its output? These questions are addressed by a de facto standard called <i class="pcalibre17 pcalibre2 pcalibre1">CGI (common gateway interface)</i>.</p>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007F1D" id="P7000497027000000000000000007F1D"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A67" epub:type="title" id="P7000497027000000000000000046A67">How Does the Client Pass Program Arguments to the Server?</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A68" id="P7000497027000000000000000046A68">Arguments for GET requests are passed in the URI. As we have seen, a `?' character separates the filename from the arguments, and each argument is separated by an `&amp;' character. Spaces are not allowed in arguments and must be represented with the %20 string. Similar encodings exist for other special characters.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007F20" id="P7000497027000000000000000007F20"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A69" epub:type="title" id="P7000497027000000000000000046A69">How Does the Server Pass Arguments to the Child?</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A6A" id="P7000497027000000000000000046A6A">After a server receives a request such as</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046A6B" id="P7000497027000000000000000046A6B"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A6C" id="P7000497027000000000000000046A6C">GET /cgi-bin/adder?15000&amp;213 HTTP/1.1</code></pre>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007F25" id="P7000497027000000000000000007F25">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007F26" epub:type="pagebreak" id="P7000497027000000000000000007F26" title="954"></span>
<table class="pcalibre1 pcalibre2 pcalibre43" data-uri="chapter11.xhtml#P7000497027000000000000000046A6D" id="P7000497027000000000000000046A6D">
<thead class="pcalibre44 pcalibre2 pcalibre1">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<th class="pcalibre1 pcalibre2 calibre5" data-uri="chapter11.xhtml#P7000497027000000000000000046A6E" id="P7000497027000000000000000046A6E">Environment variable</th>
<th class="pcalibre1 pcalibre2 calibre5" data-uri="chapter11.xhtml#P7000497027000000000000000046A6F" id="P7000497027000000000000000046A6F">Description</th>
</tr>
</thead>
<tbody class="pcalibre1 pcalibre2 calibre6">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A70" id="P7000497027000000000000000046A70">QUERY_STRING</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A71" id="P7000497027000000000000000046A71">Program arguments</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A72" id="P7000497027000000000000000046A72">SERVER_PORT</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A73" id="P7000497027000000000000000046A73">Port that the parent is listening on</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A74" id="P7000497027000000000000000046A74">REQUEST_METHOD</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A75" id="P7000497027000000000000000046A75">GET or POST</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A76" id="P7000497027000000000000000046A76">REMOTE_HOST</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A77" id="P7000497027000000000000000046A77">Domain name of client</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A78" id="P7000497027000000000000000046A78">REMOTE_ADDR</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A79" id="P7000497027000000000000000046A79">Dotted-decimal IP address of client</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A7A" id="P7000497027000000000000000046A7A">CONTENT_TYPE</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A7B" id="P7000497027000000000000000046A7B">POST only: MIME type of the request body</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A7C" id="P7000497027000000000000000046A7C">CONTENT_LENGTH</td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A7D" id="P7000497027000000000000000046A7D">POST only: Size in bytes of the request body</td>
</tr>
</tbody>
</table>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046A7E" id="P7000497027000000000000000046A7E"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046A7F" epub:type="title" id="P7000497027000000000000000046A7F"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.26 </span>Examples of CGI environment variables.</h1></header>
</figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A80" id="P7000497027000000000000000046A80">it calls <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A81" id="P7000497027000000000000000046A81">fork</code> to create a child process and calls <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A82" id="P7000497027000000000000000046A82">execve</code> to run the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A83" id="P7000497027000000000000000046A83">/cgi-bin/adder</code> program in the context of the child. Programs like the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A84" id="P7000497027000000000000000046A84">adder</code> program are often referred to as <i class="pcalibre17 pcalibre2 pcalibre1">CGI programs</i> because they obey the rules of the CGI standard. Before the call to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A85" id="P7000497027000000000000000046A85">execve</code>, the child process sets the CGI environment variable QUERY_STRING to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A86" id="P7000497027000000000000000046A86">15000&amp;213</code>, which the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A87" id="P7000497027000000000000000046A87">adder</code> program can reference at run time using the Linux <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A88" id="P7000497027000000000000000046A88">getenv</code> function.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007F43" id="P7000497027000000000000000007F43"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A89" epub:type="title" id="P7000497027000000000000000046A89">How Does the Server Pass Other Information to the Child?</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A8A" id="P7000497027000000000000000046A8A">CGI defines a number of other environment variables that a CGI program can expect to be set when it runs. <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007F25"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.26</span></a> shows a subset.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007F46" id="P7000497027000000000000000007F46"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A8B" epub:type="title" id="P7000497027000000000000000046A8B">Where Does the Child Send Its Output?</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A8C" id="P7000497027000000000000000046A8C">A CGI program sends its dynamic content to the standard output. Before the child process loads and runs the CGI program, it uses the Linux <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A8D" id="P7000497027000000000000000046A8D">dup2</code> function to redirect standard output to the connected descriptor that is associated with the client. Thus, anything that the CGI program writes to standard output goes directly to the client.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A8E" id="P7000497027000000000000000046A8E">Notice that since the parent does not know the type or size of the content that the child generates, the child is responsible for generating the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A8F" id="P7000497027000000000000000046A8F">Content-type</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A90" id="P7000497027000000000000000046A90">Content-length</code> response headers, as well as the empty line that terminates the headers.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A91" id="P7000497027000000000000000046A91"><a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007F59"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.27</span></a> shows a simple CGI program that sums its two arguments and returns an HTML file with the result to the client. <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007F5E"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.28</span></a> shows an HTTP transaction that serves dynamic content from the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A92" id="P7000497027000000000000000046A92">adder</code> program.</p>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007F4F" epub:type="practice" id="P7000497027000000000000000007F4F"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre127 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A93" epub:type="title" id="P7000497027000000000000000046A93"><span class="pcalibre1 pcalibre21 pcalibre2">Practice Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">11.5 </span>(solution page <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" epub:type="pagebreak" href="fileP7000497027000000000000000008021.xhtml#P7000497027000000000000000008051">969</a>)</h1></header>
<ol class="pcalibre1 pcalibre2 pcalibre77" data-uri="chapter11.xhtml#P7000497027000000000000000046A94" id="P7000497027000000000000000046A94">
<li class="pcalibre1 pcalibre2 pcalibre78" data-uri="chapter11.xhtml#P7000497027000000000000000046A95" id="P7000497027000000000000000046A95">
<div class="pcalibre1 pcalibre2 pcalibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046A96" id="P7000497027000000000000000046A96"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046A97" id="P7000497027000000000000000046A97">In <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007AE3.xhtml#P7000497027000000000000000007AE3"><span class="pcalibre1 pcalibre21 pcalibre2">Section </span><span class="pcalibre1 pcalibre21 pcalibre2">10.11</span></a>, we warned you about the dangers of using the C standard I/O functions in network applications. Yet the CGI program in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007F59"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.27</span></a> is able to use standard I/O without any problems. Why?</p></div></li>
</ol>
</section>
<aside class="pcalibre31 pcalibre32 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000007F55" id="P7000497027000000000000000007F55"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre33" data-uri="chapter11.xhtml#P7000497027000000000000000046A98" epub:type="title" id="P7000497027000000000000000046A98"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007F57" epub:type="pagebreak" id="P7000497027000000000000000007F57" title="955"></span><span class="pcalibre1 pcalibre2 pcalibre34">Aside </span>Passing arguments in HTTP POST requests to CGI programs</h1></header>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046A99" id="P7000497027000000000000000046A99">For POST requests, the child would also need to redirect standard input to the connected descriptor. The CGI program would then read the arguments in the request body from standard input.</p>
</aside>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007F59" id="P7000497027000000000000000007F59">
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046A9A" id="P7000497027000000000000000046A9A"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A9B" id="P7000497027000000000000000046A9B">
1	#include "csapp.h"
2	
3	int main(void) {
4		char *buf, *p;
5		char arg1[MAXLINE], arg2[MAXLINE], content[MAXLINE];
6		int n1=0, n2=0;
7	
8		/* Extract the two arguments */
9		if ((buf = getenv("QUERY_STRING")) != NULL) {
10			p = strchr(buf, `&amp;');
11			*p = `\0';
12			strcpy(arg1, buf);
13			strcpy(arg2, p+1);
14			n1 = atoi(arg1);
15			n2 = atoi(arg2);
16		}
17	
18		/* Make the response body */
19		sprintf(content, "QUERY_STRING=%s", buf);
20		sprintf(content, "Welcome to add.com: ");
21		sprintf(content, "%sTHE Internet addition portal.\r\n&lt;p&gt;", content);
22		sprintf(content, "%sThe answer is: %d + %d = %d\r\n&lt;p&gt;",
23			content, n1, n2, n1 + n2);
24		sprintf(content, "%sThanks for visiting!\r\n", content);
25	
26		/* Generate the HTTP response */
27		printf("Connection: close\r\n");
28		printf("Content-length: %d\r\n", (int)strlen(content));
29		printf("Content-type: text/html\r\n\r\n");
30		printf("%s", content);
31		fflush(stdout);
32	
33		exit(0);
34	}
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046A9C" id="P7000497027000000000000000046A9C"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046A9D" epub:type="title" id="P7000497027000000000000000046A9D"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.27 </span>CGI program that sums two integers.</h1></header>
</figcaption>
</figure>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007F5E" id="P7000497027000000000000000007F5E">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007F5F" epub:type="pagebreak" id="P7000497027000000000000000007F5F" title="956"></span>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046A9E" id="P7000497027000000000000000046A9E"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046A9F" id="P7000497027000000000000000046A9F">
1	linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">telnet kittyhawk.cmcl.cs.cmu.edu 8000</i>	<i class="pcalibre17 pcalibre2 pcalibre1">Client: open connection</i>
2	Trying 128.2.194.242...
3	Connected to kittyhawk.cmcl.cs.cmu.edu.
4	Escape character is `â]'.
5	<i class="pcalibre17 pcalibre2 pcalibre1">GET /cgi-bin/adder?15000&amp;213 HTTP/1.0</i>			<i class="pcalibre17 pcalibre2 pcalibre1">Client: request line</i>
6								<i class="pcalibre17 pcalibre2 pcalibre1">Client: empty line terminates headers</i>
7	HTTP/1.0 200 OK						<i class="pcalibre17 pcalibre2 pcalibre1">Server: response line</i>
8	Server: Tiny Web Server					<i class="pcalibre17 pcalibre2 pcalibre1">Server: identify server</i>
9	Content-length: 115					<i class="pcalibre17 pcalibre2 pcalibre1">Adder: expect 115 bytes in response body</i>
10	Content-type: text/html					<i class="pcalibre17 pcalibre2 pcalibre1">Adder: expect HTML in response body</i>
11								<i class="pcalibre17 pcalibre2 pcalibre1">Adder: empty line terminates headers</i>
12	Welcome to add.com: THE Internet addition portal.	<i class="pcalibre17 pcalibre2 pcalibre1">Adder: first HTML line</i>
13	&lt;p&gt;The answer is: 15000 + 213 = 15213			<i class="pcalibre17 pcalibre2 pcalibre1">Adder: second HTML line in response body</i>
14	&lt;p&gt;Thanks for visiting!					<i class="pcalibre17 pcalibre2 pcalibre1">Adder: third HTML line in response body</i>
15	Connection closed by foreign host.			<i class="pcalibre17 pcalibre2 pcalibre1">Server: closes connection</i>
16	linux&gt;							<i class="pcalibre17 pcalibre2 pcalibre1">Client: closes connection and terminates</i>
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046AA0" id="P7000497027000000000000000046AA0"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046AA1" epub:type="title" id="P7000497027000000000000000046AA1"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">11.28 </span>An HTTP transaction that serves dynamic HTML content.</h1></header>
</figcaption>
</figure>
</section>
</section>
</section></body></html>
<?xml version='1.0' encoding='utf-8'?>
<html epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg">
<head>
<meta content="PXE Basic 1.0" name="dcterms.conformsTo"/>
<meta content="PXE Tools version 1.39.52" name="generator"/>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
<title>11.6 Putting It Together: The Tiny Web Server</title>
<link href="../css/theme/night.css" rel="alternate stylesheet" title="night" type="text/css"/>
<link href="../css/theme/sepia.css" rel="alternate stylesheet" title="sepia" type="text/css"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body class="pcalibre1 pcalibre2 pcalibre" epub:type="bodymatter">
<section class="pcalibre1 pcalibre2 pcalibre3" id="P7000497027000000000000000007F64"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre2 pcalibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046AA2" epub:type="title" id="P7000497027000000000000000046AA2"><span class="pcalibre1 pcalibre21 pcalibre2">11.6 </span>Putting It Together: The T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>Web Server</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AA3" id="P7000497027000000000000000046AA3">We conclude our discussion of network programming by developing a small but functioning Web server called T<span class="pcalibre1 pcalibre29 pcalibre2">iny</span>. T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>is an interesting program. It combines many of the ideas that we have learned about, such as process control, Unix I/O, the sockets interface, and HTTP, in only 250 lines of code. While it lacks the functionality, robustness, and security of a real server, it is powerful enough to serve both static and dynamic content to real Web browsers. We encourage you to study it and implement it yourself. It is quite exciting (even for the authors!) to point a real browser at your own server and watch it display a complicated Web page with text and graphics.</p>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007F67" id="P7000497027000000000000000007F67">
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007F68" id="P7000497027000000000000000007F68"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AA4" epub:type="title" id="P7000497027000000000000000046AA4">The T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span><code class="pcalibre1 pcalibre2 calibre16" data-uri="chapter11.xhtml#P7000497027000000000000000046AA5" id="P7000497027000000000000000046AA5">main</code> Routine</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AA6" id="P7000497027000000000000000046AA6"><a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007F74"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.29</span></a> shows T<span class="pcalibre1 pcalibre29 pcalibre2">iny's </span>main routine. T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>is an iterative server that listens for connection requests on the port that is passed in the command line. After opening a listening socket by calling the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AA7" id="P7000497027000000000000000046AA7">open_listenfd</code> function, T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>executes the typical infinite server loop, repeatedly accepting a connection request (line 32), performing a transaction (line 36), and closing its end of the connection (line 37).</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007F6D" id="P7000497027000000000000000007F6D"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AA8" epub:type="title" id="P7000497027000000000000000046AA8">The <code class="pcalibre1 pcalibre2 calibre16" data-uri="chapter11.xhtml#P7000497027000000000000000046AA9" id="P7000497027000000000000000046AA9">doit</code> Function</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AAA" id="P7000497027000000000000000046AAA">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AAB" id="P7000497027000000000000000046AAB">doit</code> function in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007F7A"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.30</span></a> handles one HTTP transaction. First, we read and parse the request line (lines 11âˆ’14). Notice that we are using the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AAC" id="P7000497027000000000000000046AAC">rio_readlineb</code> function from Figure <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007975.xhtml#P70004970270000000000000000079F7"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">10.8</span></a> to read the request line.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AAD" id="P7000497027000000000000000046AAD">T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>supports only the GET method. If the client requests another method (such as POST), we send it an error message and return to the main routine</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007F74" id="P7000497027000000000000000007F74">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007F75" epub:type="pagebreak" id="P7000497027000000000000000007F75" title="957"></span>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046AAE" id="P7000497027000000000000000046AAE"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AAF" id="P7000497027000000000000000046AAF">
1	/*
2	* tiny.c - A simple, iterative HTTP/1.0 Web server that uses the
3	* GET method to serve static and dynamic content
4	*/
5	#include "csapp.h"
6	
7	void doit(int fd);
8	void read_requesthdrs(rio_t *rp);
9	int parse_uri(char *uri, char *filename, char *cgiargs);
10	void serve_static(int fd, char *filename, int filesize);
11	void get_filetype(char *filename, char *filetype);
12	void serve_dynamic(int fd, char *filename, char *cgiargs);
13	void clienterror(int fd, char *cause, char *errnum,
14	char *shortmsg, char *longmsg);
15	
16	int main(int argc, char **argv)
17	{
18	int listenfd, connfd;
19	char hostname[MAXLINE], port[MAXLINE];
20	socklen_t clientlen;
21	struct sockaddr_storage clientaddr;
22	
23	/* Check command-line args */
24	if (argc != 2) {
25	fprintf(stderr, "usage: %s &lt;port&gt;\n", argv[0]);
26	exit(1);
27	}
28	
29	listenfd = Open_listenfd(argv[1]);
30	while (1) {
31	clientlen = sizeof(clientaddr);
32	connfd = Accept(listenfd, (SA *)&amp;clientaddr, &amp;clientlen);
33	Getnameinfo((SA *) &amp;clientaddr, clientlen, hostname, MAXLINE,
34	port, MAXLINE, 0);
35	printf("Accepted connection from (%s, %s)\n", hostname, port);
36	doit(connfd);
37	Close(connfd);
38	}
39	}
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046AB0" id="P7000497027000000000000000046AB0"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046AB1" epub:type="title" id="P7000497027000000000000000046AB1"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.29 </span>The T<span class="pcalibre1 pcalibre2 pcalibre84">iny </span>Web server.</h1></header>
</figcaption>
</figure>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007F7A" id="P7000497027000000000000000007F7A">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007F7B" epub:type="pagebreak" id="P7000497027000000000000000007F7B" title="958"></span>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046AB2" id="P7000497027000000000000000046AB2"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AB3" id="P7000497027000000000000000046AB3">
1	void doit(int fd)
2	{
3	int is_static;
4	struct stat sbuf;
5	char buf[MAXLINE], method[MAXLINE], uri[MAXLINE], version[MAXLINE];
6	char filename[MAXLINE], cgiargs[MAXLINE];
7	rio_t rio;
8
9	/* Read request line and headers */
10	Rio_readinitb(&amp;rio, fd);
11	Rio_readlineb(&amp;rio, buf, MAXLINE);
12	printf("Request headers:\n");
13	printf("%s", buf);
14	sscanf(buf, "%s %s %s", method, uri, version);
15	if (strcasecmp(method, "GET")) {
16	clienterror(fd, method, "501", "Not implemented",
17	"Tiny does not implement this method");
18	return;
19	}
20	read_requesthdrs(&amp;rio);
21	
22	/* Parse URI from GET request */
23	is_static = parse_uri(uri, filename, cgiargs);
24	if (stat(filename, &amp;sbuf) &lt; 0) {
25	clienterror(fd, filename, "404", "Not found",
26	"Tiny couldn't find this file");
27	return;
28	}
29	
30	if (is_static) { /* Serve static content */
31	if (!(S_ISREG(sbuf.st_mode))	|	| !(S_IRUSR &amp; sbuf.st_mode)) {
32	clienterror(fd, filename, "403", "Forbidden",
33	"Tiny couldn't read the file");
34	return;
35	}
36	serve_static(fd, filename, sbuf.st_size);
37	}
38	else { /* Serve dynamic content */
39	if (!(S_ISREG(sbuf.st_mode))	|	| !(S_IXUSR &amp; sbuf.st_mode)) {
40	clienterror(fd, filename, "403", "Forbidden",
41	"Tiny couldn't run the CGI program");
42	return;
43	}
44	serve_dynamic(fd, filename, cgiargs);
45	}
46	}
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046AB4" id="P7000497027000000000000000046AB4"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046AB5" epub:type="title" id="P7000497027000000000000000046AB5"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.30 </span><code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AB6" id="P7000497027000000000000000046AB6">T<span class="pcalibre1 pcalibre2 pcalibre84">iny </span>doit</code> handles one HTTP transaction.</h1></header>
</figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AB7" id="P7000497027000000000000000046AB7"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007F82" epub:type="pagebreak" id="P7000497027000000000000000007F82" title="959"></span>(lines 15âˆ’19), which then closes the connection and awaits the next connection request. Otherwise, we read and (as we shall see) ignore any request headers (line 20).</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AB8" id="P7000497027000000000000000046AB8">Next, we parse the URI into a filename and a possibly empty CGI argument string, and we set a flag that indicates whether the request is for static or dynamic content (line 23). If the file does not exist on disk, we immediately send an error message to the client and return.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AB9" id="P7000497027000000000000000046AB9">Finally, if the request is for static content, we verify that the file is a regular file and that we have read permission (line 31). If so, we serve the static content (line 36) to the client. Similarly, if the request is for dynamic content, we verify that the file is executable (line 39), and, if so, we go ahead and serve the dynamic content (line 44).</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007F85" id="P7000497027000000000000000007F85"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046ABA" epub:type="title" id="P7000497027000000000000000046ABA">The <code class="pcalibre1 pcalibre2 calibre16" data-uri="chapter11.xhtml#P7000497027000000000000000046ABB" id="P7000497027000000000000000046ABB">clienterror</code> Function</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046ABC" id="P7000497027000000000000000046ABC">T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>lacks many of the error-handling features of a real server. However, it does check for some obvious errors and reports them to the client. The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046ABD" id="P7000497027000000000000000046ABD">clienterror</code> function in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007F8A"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.31</span></a> sends an HTTP response to the client with the appropriate</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007F8A" id="P7000497027000000000000000007F8A">
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046ABE" id="P7000497027000000000000000046ABE"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046ABF" id="P7000497027000000000000000046ABF">
1	void clienterror(int fd, char *cause, char *errnum,
2			char *shortmsg, char *longmsg)
3	{
4		char buf[MAXLINE], body[MAXBUF];
5	
6		/* Build the HTTP response body */
7		sprintf(body, "&lt;html&gt;&lt;title&gt;Tiny Error&lt;/title&gt;");
8		sprintf(body, "%s&lt;body bgcolor=""ffffff""&gt;\r\n", body);
9		sprintf(body, "%s%s: %s\r\n", body, errnum, shortmsg);
10		sprintf(body, "%s&lt;p&gt;%s: %s\r\n", body, longmsg, cause);
11		sprintf(body, "%s&lt;hr&gt;&lt;em&gt;The Tiny Web server&lt;/em&gt;\r\n", body);
12	
13		/* Print the HTTP response */
14		sprintf(buf, "HTTP/1.0 %s %s\r\n", errnum, shortmsg);
15		Rio_writen(fd, buf, strlen(buf));
16		sprintf(buf, "Content-type: text/html\r\n");
17		Rio_writen(fd, buf, strlen(buf));
18		sprintf(buf, "Content-length: %d\r\n\r\n", (int)strlen(body));
19		Rio_writen(fd, buf, strlen(buf));
20		Rio_writen(fd, body, strlen(body));
21	}
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046AC0" id="P7000497027000000000000000046AC0"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046AC1" epub:type="title" id="P7000497027000000000000000046AC1"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.31 </span><code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AC2" id="P7000497027000000000000000046AC2">T<span class="pcalibre1 pcalibre2 pcalibre84">iny </span>clienterror</code> sends an error message to the client.</h1></header>
</figcaption>
</figure>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007F90" id="P7000497027000000000000000007F90">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007F91" epub:type="pagebreak" id="P7000497027000000000000000007F91" title="960"></span>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046AC3" id="P7000497027000000000000000046AC3"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AC4" id="P7000497027000000000000000046AC4">
1	void read_requesthdrs(rio_t *rp)
2	{
3		char buf[MAXLINE];
4
5		Rio_readlineb(rp, buf, MAXLINE);
6		while(strcmp(buf, "\r\n")) {
7			Rio_readlineb(rp, buf, MAXLINE);
8			printf("%s", buf);
9		}
10		return;
11	}
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046AC5" id="P7000497027000000000000000046AC5"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046AC6" epub:type="title" id="P7000497027000000000000000046AC6"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.32 </span><code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AC7" id="P7000497027000000000000000046AC7">T<span class="pcalibre1 pcalibre2 pcalibre84">iny </span>read_requesthdrs</code> reads and ignores request headers.</h1></header>
<div class="pcalibre1 caption pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AC8" id="P7000497027000000000000000046AC8"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046AC9" id="P7000497027000000000000000046AC9"></p></div></figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046ACA" id="P7000497027000000000000000046ACA">status code and status message in the response line, along with an HTML file in the response body that explains the error to the browser's user.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046ACB" id="P7000497027000000000000000046ACB">Recall that an HTML response should indicate the size and type of the content in the body. Thus, we have opted to build the HTML content as a single string so that we can easily determine its size. Also, notice that we are using the robust <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046ACC" id="P7000497027000000000000000046ACC">rio_writen</code> function from <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007975.xhtml#P70004970270000000000000000079BE"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">10.4</span></a> for all output.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007F9C" id="P7000497027000000000000000007F9C"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046ACD" epub:type="title" id="P7000497027000000000000000046ACD">The <code class="pcalibre1 pcalibre2 calibre16" data-uri="chapter11.xhtml#P7000497027000000000000000046ACE" id="P7000497027000000000000000046ACE">read_requesthdrs</code> Function</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046ACF" id="P7000497027000000000000000046ACF">T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>does not use any of the information in the request headers. It simply reads and ignores them by calling the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AD0" id="P7000497027000000000000000046AD0">read_requesthdrs</code> function in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007F90"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.32</span></a>. Notice that the empty text line that terminates the request headers consists of a carriage return and line feed pair, which we check for in line 6.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007FA1" id="P7000497027000000000000000007FA1"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AD1" epub:type="title" id="P7000497027000000000000000046AD1">The <code class="pcalibre1 pcalibre2 calibre16" data-uri="chapter11.xhtml#P7000497027000000000000000046AD2" id="P7000497027000000000000000046AD2">parse_uri</code> Function</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AD3" id="P7000497027000000000000000046AD3">T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>assumes that the home directory for static content is its current directory and that the home directory for executables is <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AD4" id="P7000497027000000000000000046AD4">./cgi-bin</code>. Any URI that contains the string <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AD5" id="P7000497027000000000000000046AD5">cgi-bin</code> is assumed to denote a request for dynamic content. The default filename is <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AD6" id="P7000497027000000000000000046AD6">./home.html</code>.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AD7" id="P7000497027000000000000000046AD7">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AD8" id="P7000497027000000000000000046AD8">parse_uri</code> function in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007FAB"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.33</span></a> implements these policies. It parses the URI into a filename and an optional CGI argument string. If the request is for static content (line 5), we clear the CGI argument string (line 6) and then convert the URI into a relative Linux pathname such as <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AD9" id="P7000497027000000000000000046AD9">./index.html</code> (lines 7âˆ’8). If the URI ends with a `/' character (line 9), then we append the default filename (line 10). On the other hand, if the request is for dynamic content (line 13), we extract any CGI arguments (lines 14âˆ’20) and convert the remaining portion of the URI to a relative Linux filename (lines 21âˆ’22).</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007FAB" id="P7000497027000000000000000007FAB">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007FAC" epub:type="pagebreak" id="P7000497027000000000000000007FAC" title="961"></span>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046ADA" id="P7000497027000000000000000046ADA"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046ADB" id="P7000497027000000000000000046ADB">
1	int parse_uri(char *uri, char *filename, char *cgiargs)
2	{
3		char *ptr;
4	
5		if (!strstr(uri, "cgi-bin")) { /* Static content */
6			strcpy(cgiargs, "");
7			strcpy(filename, ".");
8			strcat(filename, uri);
9			if (uri[strlen(uri)-1] == `/')
10				strcat(filename, "home.html");
11			return 1;
12		}
13		else { /* Dynamic content */
14			ptr = index(uri, `?');
15			if (ptr) {
16				strcpy(cgiargs, ptr+1);
17				*ptr = `\0';
18			}
19			else
20				strcpy(cgiargs, "");
21			strcpy(filename, ".");
22			strcat(filename, uri);
23			return 0;
24		}
25	}
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046ADC" id="P7000497027000000000000000046ADC"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046ADD" epub:type="title" id="P7000497027000000000000000046ADD"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.33 </span>T<span class="pcalibre1 pcalibre2 pcalibre84">iny </span>parse_uri parses an HTTP URI.</h1></header>
</figcaption>
</figure>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007FB1" id="P7000497027000000000000000007FB1"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046ADE" epub:type="title" id="P7000497027000000000000000046ADE">The <code class="pcalibre1 pcalibre2 calibre16" data-uri="chapter11.xhtml#P7000497027000000000000000046ADF" id="P7000497027000000000000000046ADF">serve_static</code> Function</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AE0" id="P7000497027000000000000000046AE0">T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>serves five common types of static content: HTML files, unformatted text files, and images encoded in GIF, PNG, and JPEG formats.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AE1" id="P7000497027000000000000000046AE1">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AE2" id="P7000497027000000000000000046AE2">serve_static</code> function in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007FBD"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.34</span></a> sends an HTTP response whose body contains the contents of a local file. First, we determine the file type by inspecting the suffix in the filename (line 7) and then send the response line and response headers to the client (lines 8âˆ’13). Notice that a blank line terminates the headers.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AE3" id="P7000497027000000000000000046AE3">Next, we send the response body by copying the contents of the requested file to the connected descriptor <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AE4" id="P7000497027000000000000000046AE4">fd</code>. The code here is somewhat subtle and needs to be studied carefully. Line 18 opens <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AE5" id="P7000497027000000000000000046AE5">filename</code> for reading and gets its descriptor. In line 19, the Linux <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AE6" id="P7000497027000000000000000046AE6">mmap</code> function maps the requested file to a virtual memory area. Recall from our discussion of <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AE7" id="P7000497027000000000000000046AE7">mmap</code> in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP70004970270000000000000000072B5.xhtml#P70004970270000000000000000072B5"><span class="pcalibre1 pcalibre21 pcalibre2">Section </span><span class="pcalibre1 pcalibre21 pcalibre2">9.8</span></a> that the call to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AE8" id="P7000497027000000000000000046AE8">mmap</code> maps the</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007FBD" id="P7000497027000000000000000007FBD">
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007FBE" epub:type="pagebreak" id="P7000497027000000000000000007FBE" title="962"></span>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046AE9" id="P7000497027000000000000000046AE9"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AEA" id="P7000497027000000000000000046AEA">
1	void serve_static(int fd, char *filename, int filesize)
2	{
3		int srcfd;
4		char *srcp, filetype[MAXLINE], buf[MAXBUF];
5	
6		/* Send response headers to client */
7		get_filetype(filename, filetype);
8		sprintf(buf, "HTTP/1.0 200 OK\r\n");
9		sprintf(buf, "%sServer: Tiny Web Server\r\n", buf);
10		sprintf(buf, "%sConnection: close\r\n", buf);
11		sprintf(buf, "%sContent-length: %d\r\n", buf, filesize);
12		sprintf(buf, "%sContent-type: %s\r\n\r\n", buf, filetype);
13		Rio_writen(fd, buf, strlen(buf));
14		printf("Response headers:\n");
15		printf("%s", buf);
16	
17		/* Send response body to client */
18		srcfd = Open(filename, O_RDONLY, 0);
19		srcp = Mmap(0, filesize, PROT_READ, MAP_PRIVATE, srcfd, 0);
20		Close(srcfd);
21		Rio_writen(fd, srcp, filesize);
22		Munmap(srcp, filesize);
23	}
24	
25	/*
26	* get_filetype - Derive file type from filename
27	*/
28	void get_filetype(char *filename, char *filetype)
29	{
30		if (strstr(filename, ".html"))
31			strcpy(filetype, "text/html");
32		else if (strstr(filename, ".gif"))
33			strcpy(filetype, "image/gif");
34		else if (strstr(filename, ".png"))
35			strcpy(filetype, "image/png");
36		else if (strstr(filename, ".jpg"))
37			strcpy(filetype, "image/jpeg");
38		else
39			strcpy(filetype, "text/plain");
40	}
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046AEB" id="P7000497027000000000000000046AEB"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046AEC" epub:type="title" id="P7000497027000000000000000046AEC"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.34 </span>T<span class="pcalibre1 pcalibre2 pcalibre84">iny </span>serve_static serves static content to a client.</h1></header>
</figcaption>
</figure>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AED" id="P7000497027000000000000000046AED"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007FC4" epub:type="pagebreak" id="P7000497027000000000000000007FC4" title="963"></span>first <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AEE" id="P7000497027000000000000000046AEE">filesize</code> bytes of file <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AEF" id="P7000497027000000000000000046AEF">srcfd</code> to a private read-only area of virtual memory that starts at address <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AF0" id="P7000497027000000000000000046AF0">srcp</code>.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AF1" id="P7000497027000000000000000046AF1">Once we have mapped the file to memory, we no longer need its descriptor, so we close the file (line 20). Failing to do this would introduce a potentially fatal memory leak. Line 21 performs the actual transfer of the file to the client. The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AF2" id="P7000497027000000000000000046AF2">rio_writen</code> function copies the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AF3" id="P7000497027000000000000000046AF3">filesize</code> bytes starting at location <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AF4" id="P7000497027000000000000000046AF4">srcp</code> (which of course is mapped to the requested file) to the client's connected descriptor. Finally, line 22 frees the mapped virtual memory area. This is important to avoid a potentially fatal memory leak.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007FCC" id="P7000497027000000000000000007FCC"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre65 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AF5" epub:type="title" id="P7000497027000000000000000046AF5">The <code class="pcalibre1 pcalibre2 calibre16" data-uri="chapter11.xhtml#P7000497027000000000000000046AF6" id="P7000497027000000000000000046AF6">serve_dynamic</code> Function</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AF7" id="P7000497027000000000000000046AF7">T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>serves any type of dynamic content by forking a child process and then running a CGI program in the context of the child.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AF8" id="P7000497027000000000000000046AF8">The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AF9" id="P7000497027000000000000000046AF9">serve_dynamic</code> function in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007FD4"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.35</span></a> begins by sending a response line indicating success to the client, along with an informational <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AFA" id="P7000497027000000000000000046AFA">Server</code> header. The CGI program is responsible for sending the rest of the response. Notice that this is not as robust as we might wish, since it doesn't allow for the possibility that the CGI program might encounter some error.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AFB" id="P7000497027000000000000000046AFB">After sending the first part of the response, we fork a new child process (line 11). The child initializes the QUERY_STRING environment variable with the CGI arguments from the request URI (line 13). Notice that a real server would</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" data-uri="chapter11.xhtml#P7000497027000000000000000007FD4" id="P7000497027000000000000000007FD4">
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046AFC" id="P7000497027000000000000000046AFC"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046AFD" id="P7000497027000000000000000046AFD">
1	void serve_dynamic(int fd, char *filename, char *cgiargs)
2	{
3		char buf[MAXLINE], *emptylist[] = { NULL };
4	
5		/* Return first part of HTTP response */
6		sprintf(buf, "HTTP/1.0 200 OK\r\n");
7		Rio_writen(fd, buf, strlen(buf));
8		sprintf(buf, "Server: Tiny Web Server\r\n");
9		Rio_writen(fd, buf, strlen(buf));
10	
11		if (Fork() == 0) { /* Child */
12			/* Real server would set all CGI vars here */
13			setenv("QUERY_STRING", cgiargs, 1);
14			Dup2(fd, STDOUT_FILENO); /* Redirect stdout to client */
15			Execve(filename, emptylist, environ); /* Run CGI program */
16		}
17		Wait(NULL); /* Parent waits for and reaps child */
18	}
</code></pre>
<figcaption class="pcalibre1 pcalibre2 calibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046AFE" id="P7000497027000000000000000046AFE"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" data-uri="chapter11.xhtml#P7000497027000000000000000046AFF" epub:type="title" id="P7000497027000000000000000046AFF"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.35 </span>T<span class="pcalibre1 pcalibre2 pcalibre84">iny </span>serve_dynamic serves dynamic content to a client.</h1></header>
</figcaption>
</figure>
<aside class="pcalibre31 pcalibre32 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000007FD9" id="P7000497027000000000000000007FD9"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre33" data-uri="chapter11.xhtml#P7000497027000000000000000046B00" epub:type="title" id="P7000497027000000000000000046B00"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007FDB" epub:type="pagebreak" id="P7000497027000000000000000007FDB" title="964"></span><span class="pcalibre1 pcalibre2 pcalibre34">Aside </span>Dealing with prematurely closed connections</h1></header>
<p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046B01" id="P7000497027000000000000000046B01">Although the basic functions of a Web server are quite simple, we don't want to give you the false impression that writing a real Web server is easy. Building a robust Web server that runs for extended periods without crashing is a difficult task that requires a deeper understanding of Linux systems programming than we've learned here. For example, if a server writes to a connection that has already been closed by the client (say, because you clicked the "Stop" button on your browser), then the first such write returns normally, but the second write causes the delivery of a SIGPIPE signal whose default behavior is to terminate the process. If the SIGPIPE signal is caught or ignored, then the second write operation returns âˆ’1 with <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B02" id="P7000497027000000000000000046B02">errno</code> set to EPIPE. The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B03" id="P7000497027000000000000000046B03">strerr</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B04" id="P7000497027000000000000000046B04">perror</code> functions report the EPIPE error as a "Broken pipe," a nonintuitive message that has confused generations of students. The bottom line is that a robust server must catch these SIGPIPE signals and check <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B05" id="P7000497027000000000000000046B05">write</code> function calls for EPIPE errors.</p>
</aside>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B06" id="P7000497027000000000000000046B06">set the other CGI environment variables here as well. For brevity, we have omitted this step.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B07" id="P7000497027000000000000000046B07">Next, the child redirects the child's standard output to the connected file descriptor (line 14) and then loads and runs the CGI program (line 15). Since the CGI program runs in the context of the child, it has access to the same open files and environment variables that existed before the call to the <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B08" id="P7000497027000000000000000046B08">execve</code> function. Thus, everything that the CGI program writes to standard output goes directly to the client process, without any intervention from the parent process. Meanwhile, the parent blocks in a call to <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B09" id="P7000497027000000000000000046B09">wait</code>, waiting to reap the child when it terminates (line 17).</p>
</section>
</section>
</section></body></html>
<?xml version='1.0' encoding='utf-8'?>
<html epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg">
<head>
<meta content="PXE Basic 1.0" name="dcterms.conformsTo"/>
<meta content="PXE Tools version 1.39.52" name="generator"/>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
<title>11.7 Summary </title>
<link href="../css/theme/night.css" rel="alternate stylesheet" title="night" type="text/css"/>
<link href="../css/theme/sepia.css" rel="alternate stylesheet" title="sepia" type="text/css"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body class="pcalibre1 pcalibre2 pcalibre" epub:type="bodymatter">
<section class="pcalibre1 pcalibre2 pcalibre3" id="P7000497027000000000000000007FE5"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre2 pcalibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046B0A" epub:type="title" id="P7000497027000000000000000046B0A"><span class="pcalibre1 pcalibre21 pcalibre2">11.7 </span><span class="pcalibre1 pcalibre21 pcalibre2">Summary </span></h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B0B" id="P7000497027000000000000000046B0B">Every network application is based on the client-server model. With this model, an application consists of a server and one or more clients. The server manages resources, providing a service for its clients by manipulating the resources in some way. The basic operation in the client-server model is a client-server transaction, which consists of a request from a client, followed by a response from the server.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B0C" id="P7000497027000000000000000046B0C">Clients and servers communicate over a global network known as the Internet. From a programmer's point of view, we can think of the Internet as a worldwide collection of hosts with the following properties: (1) Each Internet host has a unique 32-bit name called its IP address. (2) The set of IP addresses is mapped to a set of Internet domain names. (3) Processes on different Internet hosts can communicate with each other over connections.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B0D" id="P7000497027000000000000000046B0D">Clients and servers establish connections by using the sockets interface. A socket is an end point of a connection that is presented to applications in the form of a file descriptor. The sockets interface provides functions for opening and closing socket descriptors. Clients and servers communicate with each other by reading and writing these descriptors.</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B0E" id="P7000497027000000000000000046B0E"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000007FEB" epub:type="pagebreak" id="P7000497027000000000000000007FEB" title="965"></span>Web servers and their clients (such as browsers) communicate with each other using the HTTP protocol. A browser requests either static or dynamic content from the server. A request for static content is served by fetching a file from the server's disk and returning it to the client. A request for dynamic content is served by running a program in the context of a child process on the server and returning its output to the client. The CGI standard provides a set of rules that govern how the client passes program arguments to the server, how the server passes these arguments and other information to the child process, and how the child sends its output back to the client. A simple but functioning Web server that serves both static and dynamic content can be implemented in a few hundred lines of C code.</p>
</section></body></html>
<?xml version='1.0' encoding='utf-8'?>
<html epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg">
<head>
<meta content="PXE Basic 1.0" name="dcterms.conformsTo"/>
<meta content="PXE Tools version 1.39.52" name="generator"/>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
<title>Bibliographic Notes </title>
<link href="../css/theme/night.css" rel="alternate stylesheet" title="night" type="text/css"/>
<link href="../css/theme/sepia.css" rel="alternate stylesheet" title="sepia" type="text/css"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body class="pcalibre1 pcalibre2 pcalibre" epub:type="bodymatter">
<section class="pcalibre1 pcalibre83 pcalibre2" epub:type="bibliography" id="P7000497027000000000000000007FEC"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre2 title" data-uri="chapter11.xhtml#P7000497027000000000000000046B0F" epub:type="title" id="P7000497027000000000000000046B0F"><span class="pcalibre1 pcalibre21 pcalibre2">Bibliographic Notes </span></h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B10" id="P7000497027000000000000000046B10">The official source of information for the Internet is contained in a set of freely available numbered documents known as <i class="pcalibre17 pcalibre2 pcalibre1">RFCs (requests for comments)</i>. A searchable index of RFCs is available on the Web at</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046B11" id="P7000497027000000000000000046B11"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B12" id="P7000497027000000000000000046B12"><a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="http://rfc-editor.org">http:/<wbr class="pcalibre1 pcalibre2"/>/<wbr class="pcalibre1 pcalibre2"/>rfc-editor.org</a></code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B13" id="P7000497027000000000000000046B13">RFCs are typically written for developers of Internet infrastructure, and thus they are usually too detailed for the casual reader. However, for authoritative information, there is no better source. The HTTP/1.1 protocol is documented in RFC 2616. The authoritative list of MIME types is maintained at</p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B14" id="P7000497027000000000000000046B14"><a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="http://www.iana.org/assignments/media-types">http:/<wbr class="pcalibre1 pcalibre2"/>/<wbr class="pcalibre1 pcalibre2"/>www.iana.org/<wbr class="pcalibre1 pcalibre2"/>assignments/<wbr class="pcalibre1 pcalibre2"/>media-types</a></p>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B15" id="P7000497027000000000000000046B15">Kerrisk is the bible for all aspects of Linux programming and provides a detailed discussion of modern network programming <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="fileP700049702700000000000000000B39D.xhtml#P700049702700000000000000000B41E">[62]</a>. There are a number of good general texts on computer networking <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="fileP700049702700000000000000000B39D.xhtml#P700049702700000000000000000B425">[65</a>, <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="fileP700049702700000000000000000B39D.xhtml#P700049702700000000000000000B44B">84</a>, <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="fileP700049702700000000000000000B39D.xhtml#P700049702700000000000000000B489">114]</a>. The great technical writer W. Richard Stevens developed a series of classic texts on such topics as advanced Unix programming <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="fileP700049702700000000000000000B39D.xhtml#P700049702700000000000000000B482">[111]</a>, the Internet protocols <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="fileP700049702700000000000000000B39D.xhtml#P700049702700000000000000000B47E">[109</a>, <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="fileP700049702700000000000000000B39D.xhtml#P700049702700000000000000000B495">120</a>, <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="fileP700049702700000000000000000B39D.xhtml#P700049702700000000000000000B47A">107]</a>, and Unix network programming <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="fileP700049702700000000000000000B39D.xhtml#P700049702700000000000000000B47C">[108</a>, <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="fileP700049702700000000000000000B39D.xhtml#P700049702700000000000000000B480">110]</a>. Serious students of Unix systems programming will want to study all of them. Tragically, Stevens died on September 1, 1999. His contributions are greatly missed.</p>
</section></body></html>
<?xml version='1.0' encoding='utf-8'?>
<html epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg">
<head>
<meta content="PXE Basic 1.0" name="dcterms.conformsTo"/>
<meta content="PXE Tools version 1.39.52" name="generator"/>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
<title>Homework Problems </title>
<link href="../css/theme/night.css" rel="alternate stylesheet" title="night" type="text/css"/>
<link href="../css/theme/sepia.css" rel="alternate stylesheet" title="sepia" type="text/css"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body class="pcalibre1 pcalibre2 pcalibre" epub:type="bodymatter">
<section class="pcalibre1 pcalibre2 pcalibre3" epub:type="practice" id="P7000497027000000000000000007FF4"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre2 pcalibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046B16" epub:type="title" id="P7000497027000000000000000046B16"><span class="pcalibre1 pcalibre21 pcalibre2">Homework Problems </span></h1></header>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000007FF6" id="P7000497027000000000000000007FF6"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B17" epub:type="title" id="P7000497027000000000000000046B17"><span class="pcalibre1 pcalibre21 pcalibre2">11.6 </span></h1></header>
<ol class="pcalibre1 pcalibre2 pcalibre77" data-uri="chapter11.xhtml#P7000497027000000000000000046B18" id="P7000497027000000000000000046B18">
<li class="pcalibre1 pcalibre2 pcalibre78" data-uri="chapter11.xhtml#P7000497027000000000000000046B19" id="P7000497027000000000000000046B19">
<div class="pcalibre1 pcalibre2 pcalibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B1A" id="P7000497027000000000000000046B1A"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046B1B" id="P7000497027000000000000000046B1B">Modify T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>so that it echoes every request line and request header.</p></div></li>
<li class="pcalibre1 pcalibre2 pcalibre78" data-uri="chapter11.xhtml#P7000497027000000000000000046B1C" id="P7000497027000000000000000046B1C">
<div class="pcalibre1 pcalibre2 pcalibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B1D" id="P7000497027000000000000000046B1D"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046B1E" id="P7000497027000000000000000046B1E">Use your favorite browser to make a request to T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>for static content. Capture the output from T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>in a file.</p></div></li>
<li class="pcalibre1 pcalibre2 pcalibre78" data-uri="chapter11.xhtml#P7000497027000000000000000046B1F" id="P7000497027000000000000000046B1F">
<div class="pcalibre1 pcalibre2 pcalibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B20" id="P7000497027000000000000000046B20"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046B21" id="P7000497027000000000000000046B21">Inspect the output from T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>to determine the version of HTTP your browser uses.</p></div></li>
<li class="pcalibre1 pcalibre2 pcalibre78" data-uri="chapter11.xhtml#P7000497027000000000000000046B22" id="P7000497027000000000000000046B22">
<div class="pcalibre1 pcalibre2 pcalibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B23" id="P7000497027000000000000000046B23"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046B24" id="P7000497027000000000000000046B24"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000008001" epub:type="pagebreak" id="P7000497027000000000000000008001" title="966"></span>Consult the HTTP/1.1 standard in RFC 2616 to determine the meaning of each header in the HTTP request from your browser. You can obtain RFC 2616 from <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" href="http://www.rfc-editor.org/rfc.html">www.rfc-editor.org/<wbr class="pcalibre1 pcalibre2"/>rfc.html</a>.</p></div></li>
</ol>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000008002" id="P7000497027000000000000000008002"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B25" epub:type="title" id="P7000497027000000000000000046B25"><span class="pcalibre1 pcalibre21 pcalibre2">11.7 </span></h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B26" id="P7000497027000000000000000046B26">Extend T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>so that it serves MPG video files. Check your work using a real browser.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000008005" id="P7000497027000000000000000008005"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B27" epub:type="title" id="P7000497027000000000000000046B27"><span class="pcalibre1 pcalibre21 pcalibre2">11.8 </span></h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B28" id="P7000497027000000000000000046B28">Modify T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>so that it reaps CGI children inside a SIGCHLD handler instead of explicitly waiting for them to terminate.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000008008" id="P7000497027000000000000000008008"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B29" epub:type="title" id="P7000497027000000000000000046B29"><span class="pcalibre1 pcalibre21 pcalibre2">11.9 </span></h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B2A" id="P7000497027000000000000000046B2A">Modify T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>so that when it serves static content, it copies the requested file to the connected descriptor using <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B2B" id="P7000497027000000000000000046B2B">malloc, rio_readn</code>, and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B2C" id="P7000497027000000000000000046B2C">rio_writen</code>, instead of <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B2D" id="P7000497027000000000000000046B2D">mmap</code> and <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B2E" id="P7000497027000000000000000046B2E">rio_writen</code>.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P700049702700000000000000000800F" id="P700049702700000000000000000800F"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B2F" epub:type="title" id="P7000497027000000000000000046B2F"><span class="pcalibre1 pcalibre21 pcalibre2">11.10 </span></h1></header>
<ol class="pcalibre1 pcalibre2 pcalibre79" data-uri="chapter11.xhtml#P7000497027000000000000000046B30" id="P7000497027000000000000000046B30">
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046B31" id="P7000497027000000000000000046B31"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046B32" id="P7000497027000000000000000046B32">Write an HTML form for the CGI <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B33" id="P7000497027000000000000000046B33">adder</code> function in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007E82.xhtml#P7000497027000000000000000007F59"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">11.27</span></a>. Your form should include two text boxes that users fill in with the two numbers to be added together. Your form should request content using the GET method.</p></li>
<li class="pcalibre39 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046B34" id="P7000497027000000000000000046B34"><p class="pcalibre1 pcalibre2 pcalibre10" data-uri="chapter11.xhtml#P7000497027000000000000000046B35" id="P7000497027000000000000000046B35">Check your work by using a real browser to request the form from T<span class="pcalibre1 pcalibre29 pcalibre2">iny</span>, submit the filled-in form to T<span class="pcalibre1 pcalibre29 pcalibre2">iny</span>, and then display the dynamic content generated by <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B36" id="P7000497027000000000000000046B36">adder</code>.</p></li>
</ol>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000008018" id="P7000497027000000000000000008018"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B37" epub:type="title" id="P7000497027000000000000000046B37"><span class="pcalibre1 pcalibre21 pcalibre2">11.11 </span></h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B38" id="P7000497027000000000000000046B38">Extend T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>to support the HTTP HEAD method. Check your work using <span class="pcalibre1 pcalibre29 pcalibre2">telnet </span>as a Web client.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P700049702700000000000000000801B" id="P700049702700000000000000000801B"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B39" epub:type="title" id="P7000497027000000000000000046B39"><span class="pcalibre1 pcalibre21 pcalibre2">11.12 </span></h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B3A" id="P7000497027000000000000000046B3A">Extend T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>so that it serves dynamic content requested by the HTTP POST method. Check your work using your favorite Web browser.</p>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P700049702700000000000000000801E" id="P700049702700000000000000000801E"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B3B" epub:type="title" id="P7000497027000000000000000046B3B"><span class="pcalibre1 pcalibre21 pcalibre2">11.13 </span></h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B3C" id="P7000497027000000000000000046B3C">Modify T<span class="pcalibre1 pcalibre29 pcalibre2">iny </span>so that it deals cleanly (without terminating) with the SIGPIPE signals and EPIPE errors that occur when the write function attempts to write to a prematurely closed connection.</p>
</section>
</section></body></html>
<?xml version='1.0' encoding='utf-8'?>
<html epub:prefix="index: http://www.index.com/" lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg">
<head>
<meta content="PXE Basic 1.0" name="dcterms.conformsTo"/>
<meta content="PXE Tools version 1.39.52" name="generator"/>
<!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
<title>Solutions to Practice Problems </title>
<link href="../css/theme/night.css" rel="alternate stylesheet" title="night" type="text/css"/>
<link href="../css/theme/sepia.css" rel="alternate stylesheet" title="sepia" type="text/css"/>
<script src="js/format_lg_obj.js"></script>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
<body class="pcalibre1 pcalibre2 pcalibre" epub:type="bodymatter">
<section class="pcalibre1 pcalibre2 pcalibre3" id="P7000497027000000000000000008021"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre2 pcalibre4" data-uri="chapter11.xhtml#P7000497027000000000000000046B3D" epub:type="title" id="P7000497027000000000000000046B3D"><span class="pcalibre1 pcalibre21 pcalibre2">Solutions to Practice Problems </span></h1></header>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000008023" id="P7000497027000000000000000008023"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B3E" epub:type="title" id="P7000497027000000000000000046B3E"><a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007BFE.xhtml#P7000497027000000000000000007C3D"><span class="pcalibre1 pcalibre21 pcalibre2">Solution to Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">11.1 </span></a>(page <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" epub:type="pagebreak" href="fileP7000497027000000000000000007BFE.xhtml#P7000497027000000000000000007C3F">927</a>)</h1></header>
<table class="pcalibre1 pcalibre2 pcalibre43" data-uri="chapter11.xhtml#P7000497027000000000000000046B3F" id="P7000497027000000000000000046B3F">
<thead class="pcalibre44 pcalibre2 pcalibre1">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<th class="pcalibre1 pcalibre2 calibre5" data-uri="chapter11.xhtml#P7000497027000000000000000046B40" id="P7000497027000000000000000046B40">Hex address</th>
<th class="pcalibre1 pcalibre2 calibre5" data-uri="chapter11.xhtml#P7000497027000000000000000046B41" id="P7000497027000000000000000046B41">Dotted-decimal address</th>
</tr>
</thead>
<tbody class="pcalibre1 pcalibre2 calibre6">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B42" id="P7000497027000000000000000046B42"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B43" id="P7000497027000000000000000046B43">0x0</code></td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B44" id="P7000497027000000000000000046B44"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B45" id="P7000497027000000000000000046B45">0.0.0.0</code></td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B46" id="P7000497027000000000000000046B46"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B47" id="P7000497027000000000000000046B47">0xffffffff</code></td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B48" id="P7000497027000000000000000046B48"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B49" id="P7000497027000000000000000046B49">255.255.255.255</code></td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B4A" id="P7000497027000000000000000046B4A"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B4B" id="P7000497027000000000000000046B4B">0x7f000001</code></td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B4C" id="P7000497027000000000000000046B4C"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B4D" id="P7000497027000000000000000046B4D">127.0.0.1</code></td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B4E" id="P7000497027000000000000000046B4E"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B4F" id="P7000497027000000000000000046B4F">0xcdbca079</code></td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B50" id="P7000497027000000000000000046B50"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B51" id="P7000497027000000000000000046B51">205.188.160.121</code></td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B52" id="P7000497027000000000000000046B52"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B53" id="P7000497027000000000000000046B53"><span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P700049702700000000000000000803A" epub:type="pagebreak" id="P700049702700000000000000000803A" title="967"></span>0x400c950d</code></td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B54" id="P7000497027000000000000000046B54"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B55" id="P7000497027000000000000000046B55">64.12.149.13</code></td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B56" id="P7000497027000000000000000046B56"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B57" id="P7000497027000000000000000046B57">0xcdbc9217</code></td>
<td class="pcalibre1 pcalibre2 calibre7" data-uri="chapter11.xhtml#P7000497027000000000000000046B58" id="P7000497027000000000000000046B58"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B59" id="P7000497027000000000000000046B59">205.188.146.23</code></td>
</tr>
</tbody>
</table>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000008041" id="P7000497027000000000000000008041"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B5A" epub:type="title" id="P7000497027000000000000000046B5A"><a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007BFE.xhtml#P7000497027000000000000000007C59"><span class="pcalibre1 pcalibre21 pcalibre2">Solution to Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">11.2 </span></a>(page <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" epub:type="pagebreak" href="fileP7000497027000000000000000007BFE.xhtml#P7000497027000000000000000007C3F">927</a>)</h1></header>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046B5B" id="P7000497027000000000000000046B5B"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B5C" id="P7000497027000000000000000046B5C">
1	#include "csapp.h"
2	
3	int main(int argc, char **argv)
4	{
5		struct in_addr inaddr;	/* Address in network byte order */
6		uint32_t addr;		/* Address in host byte order */
7		char buf[MAXBUF];	/* Buffer for dotted-decimal string */
8	
9		if (argc != 2) {
10			fprintf(stderr, "usage: %s &lt;hex number&gt;\n", argv[0]);
11			exit(0);
12		}
13		sscanf(argv[1], "%x", &amp;addr);
14		inaddr.s_addr = htonl(addr);
15	
16		if (!inet_ntop(AF_INET, &amp;inaddr, buf, MAXBUF))
17			unix_error("inet_ntop");
18		printf("%s\n", buf); 19
20		exit(0);
21	}
</code></pre>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000008045" id="P7000497027000000000000000008045"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B5D" epub:type="title" id="P7000497027000000000000000046B5D"><a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007BFE.xhtml#P7000497027000000000000000007C62"><span class="pcalibre1 pcalibre21 pcalibre2">Solution to Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">11.3 </span></a>(page <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" epub:type="pagebreak" href="fileP7000497027000000000000000007BFE.xhtml#P7000497027000000000000000007C3F">927</a>)</h1></header>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046B5E" id="P7000497027000000000000000046B5E"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B5F" id="P7000497027000000000000000046B5F">
1	#include "csapp.h"
2	
3	int main(int argc, char **argv)
4	{
5		struct in_addr inaddr;	/* Address in network byte order */
6		int rc;
7	
8		if (argc != 2) {
9			fprintf(stderr, "usage: %s &lt;dotted-decimal&gt;\n", argv[0]);
10			exit(0);
11		}
12	
13		rc = inet_pton(AF_INET, argv[1], &amp;inaddr);
14		if (rc == 0)
15			app_error("inet_pton error: invalid dotted-decimal address");
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000008049" epub:type="pagebreak" id="P7000497027000000000000000008049" title="968"></span>16		else if (rc &lt; 0)
17			unix_error("inet_pton error");
18	
19		printf("0x%x\n", ntohl(inaddr.s_addr));
20		exit(0);
21	}
</code></pre>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P700049702700000000000000000804A" id="P700049702700000000000000000804A"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B60" epub:type="title" id="P7000497027000000000000000046B60"><a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007CC1.xhtml#P7000497027000000000000000007DFF"><span class="pcalibre1 pcalibre21 pcalibre2">Solution to Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">11.4 </span></a>(page <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" epub:type="pagebreak" href="fileP7000497027000000000000000007CC1.xhtml#P7000497027000000000000000007DF3">942</a>)</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B61" id="P7000497027000000000000000046B61">Here's a solution. Notice how much more difficult it is to use <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B62" id="P7000497027000000000000000046B62">inet_ntop</code>, which requires messy casting and deep structure references. The <code class="pcalibre1 calibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B63" id="P7000497027000000000000000046B63">getnameinfo</code> function is much simpler because it does all of that work for us.</p>
<pre class="calibre2 pcalibre2 pcalibre1" data-uri="chapter11.xhtml#P7000497027000000000000000046B64" id="P7000497027000000000000000046B64"><code class="calibre3 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B65" id="P7000497027000000000000000046B65">
1	#include "csapp.h"
2	
3	int main(int argc, char **argv)
4	{
5		struct addrinfo *p, *listp, hints;
6		struct sockaddr_in *sockp;
7		char buf[MAXLINE];
8		int rc;
9	
10		if (argc != 2) {
11			fprintf(stderr, "usage: %s &lt;domain name&gt;\n", argv[0]);
12			exit(0);
13		}
14	
15		/* Get a list of addrinfo records */
16		memset(&amp;hints, 0, sizeof(struct addrinfo));
17		hints.ai_family = AF_INET; /* IPv4 only */
18		hints.ai_socktype = SOCK_STREAM; /* Connections only */
19		if ((rc = getaddrinfo(argv[1], NULL, &amp;hints, &amp;listp)) != 0) {
20			fprintf(stderr, "getaddrinfo error: %s\n", gai_strerror(rc));
21			exit(1);
22		}
23	
24		/* Walk the list and display each associated IP address */
25		for (p = listp; p; p = p-&gt;ai_next) {
26			sockp = (struct sockaddr_in *)p-&gt;ai_addr;
27			Inet_ntop(AF_INET, &amp;(sockp-&gt;sin_addr), buf, MAXLINE);
28			printf("%s\n", buf);
29		}
30	
<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000008051" epub:type="pagebreak" id="P7000497027000000000000000008051" title="969"></span>31		/* Clean up */
32		Freeaddrinfo(listp);
33	
34		exit(0);
35	}
</code></pre>
</section>
<section class="pcalibre1 pcalibre2 pcalibre3" data-uri="chapter11.xhtml#P7000497027000000000000000008052" id="P7000497027000000000000000008052"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B66" epub:type="title" id="P7000497027000000000000000046B66"><a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007E82.xhtml#P7000497027000000000000000007F4F"><span class="pcalibre1 pcalibre21 pcalibre2">Solution to Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">11.5 </span></a>(page <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" epub:type="pagebreak" href="fileP7000497027000000000000000007E82.xhtml#P7000497027000000000000000007F26">954</a>)</h1></header>
<p class="pcalibre8 pcalibre1 pcalibre2" data-uri="chapter11.xhtml#P7000497027000000000000000046B67" id="P7000497027000000000000000046B67">The reason that standard I/O works in CGI programs is that the CGI program running in the child process does not need to explicitly close any of its input or output streams. When the child terminates, the kernel closes all descriptors automatically.<span class="pcalibre1 pcalibre2 pcalibre5" data-uri="chapter11.xhtml#P7000497027000000000000000008055" epub:type="pagebreak" id="P7000497027000000000000000008055" title="970"></span></p>
</section>
</section></body></html>
