<?xml version='1.0' encoding='utf-8'?>
<html xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg" xmlns:epub="http://www.idpf.org/2007/ops" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" epub:prefix="index: http://www.index.com/">
  <head>
    <meta name="dcterms.conformsTo" content="PXE Basic 1.0"/>
    <meta name="generator" content="PXE Tools version 1.39.52"/>
    <!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
    <title>Homework Problems </title>
    <link rel="alternate stylesheet" type="text/css" title="night" href="../css/theme/night.css"/>
    <link rel="alternate stylesheet" type="text/css" title="sepia" href="../css/theme/sepia.css"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body epub:type="bodymatter" class="pcalibre1 pcalibre2 pcalibre">
<section id="P7000497027000000000000000007B24" class="pcalibre1 pcalibre2 pcalibre3"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre2 pcalibre4" id="P700049702700000000000000004663F" data-uri="chapter10.xhtml#P700049702700000000000000004663F" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">Homework Problems </span></h1></header>
<section id="P7000497027000000000000000007B26" data-uri="chapter10.xhtml#P7000497027000000000000000007B26" class="pcalibre1 pcalibre2 pcalibre3"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" id="P7000497027000000000000000046640" data-uri="chapter10.xhtml#P7000497027000000000000000046640" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">10.6 </span></h1></header>
<p id="P7000497027000000000000000046641" data-uri="chapter10.xhtml#P7000497027000000000000000046641" class="pcalibre8 pcalibre1 pcalibre2">What is the output of the following program?</p>
<pre id="P7000497027000000000000000046642" data-uri="chapter10.xhtml#P7000497027000000000000000046642" class="calibre2 pcalibre2 pcalibre1"><code id="P7000497027000000000000000046643" data-uri="chapter10.xhtml#P7000497027000000000000000046643" class="calibre3 pcalibre1 pcalibre2">
1	#include "csapp.h"
2	
3	int main()
4	{
5		int fd1, fd2; 6
7		fd1 = Open("foo.txt", O_RDONLY, 0);
8		fd2 = Open("bar.txt", O_RDONLY, 0);
9		Close(fd2);
10		fd2 = Open("baz.txt", O_RDONLY, 0);
11		printf("fd2 = %d\n", fd2);
12		exit(0);
13	}
</code></pre>
</section>
<section id="P7000497027000000000000000007B2B" data-uri="chapter10.xhtml#P7000497027000000000000000007B2B" class="pcalibre1 pcalibre2 pcalibre3"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" id="P7000497027000000000000000046644" data-uri="chapter10.xhtml#P7000497027000000000000000046644" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">10.7 </span></h1></header>
<p id="P7000497027000000000000000046645" data-uri="chapter10.xhtml#P7000497027000000000000000046645" class="pcalibre8 pcalibre1 pcalibre2">Modify the <code id="P7000497027000000000000000046646" data-uri="chapter10.xhtml#P7000497027000000000000000046646" class="pcalibre1 calibre1 pcalibre2">cpfile</code> program in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007975.xhtml#P70004970270000000000000000079C8"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">10.5</span></a> so that it uses the R<span class="pcalibre1 pcalibre29 pcalibre2">io </span>functions to copy standard input to standard output, MAXBUF bytes at a time.</p>
</section>
<section id="P7000497027000000000000000007B2F" data-uri="chapter10.xhtml#P7000497027000000000000000007B2F" class="pcalibre1 pcalibre2 pcalibre3"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" id="P7000497027000000000000000046647" data-uri="chapter10.xhtml#P7000497027000000000000000046647" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">10.8 </span></h1></header>
<p id="P7000497027000000000000000046648" data-uri="chapter10.xhtml#P7000497027000000000000000046648" class="pcalibre8 pcalibre1 pcalibre2">Write a version of the <code id="P7000497027000000000000000046649" data-uri="chapter10.xhtml#P7000497027000000000000000046649" class="pcalibre1 calibre1 pcalibre2">statcheck</code> program in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007A14.xhtml#P7000497027000000000000000007A38"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">10.10</span></a>, called <code id="P700049702700000000000000004664A" data-uri="chapter10.xhtml#P700049702700000000000000004664A" class="pcalibre1 calibre1 pcalibre2">fstatcheck</code>, that takes a descriptor number on the command line rather than a filename.</p>
</section>
<section id="P7000497027000000000000000007B34" data-uri="chapter10.xhtml#P7000497027000000000000000007B34" class="pcalibre1 pcalibre2 pcalibre3"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" id="P700049702700000000000000004664B" data-uri="chapter10.xhtml#P700049702700000000000000004664B" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">10.9 </span></h1></header>
<p id="P700049702700000000000000004664C" data-uri="chapter10.xhtml#P700049702700000000000000004664C" class="pcalibre8 pcalibre1 pcalibre2">Consider the following invocation of the <code id="P700049702700000000000000004664D" data-uri="chapter10.xhtml#P700049702700000000000000004664D" class="pcalibre1 calibre1 pcalibre2">fstatcheck</code> program from <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000007B2F"><span class="pcalibre1 pcalibre21 pcalibre2">Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">10.8</span></a>:</p>
<pre id="P700049702700000000000000004664E" data-uri="chapter10.xhtml#P700049702700000000000000004664E" class="calibre2 pcalibre2 pcalibre1"><code id="P700049702700000000000000004664F" data-uri="chapter10.xhtml#P700049702700000000000000004664F" class="calibre3 pcalibre1 pcalibre2">linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">fstatcheck 3 &lt; foo.txt</i></code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" id="P7000497027000000000000000046650" data-uri="chapter10.xhtml#P7000497027000000000000000046650">You might expect that this invocation of <code id="P7000497027000000000000000046651" data-uri="chapter10.xhtml#P7000497027000000000000000046651" class="pcalibre1 calibre1 pcalibre2">fstatcheck</code> would fetch and display metadata for file <code id="P7000497027000000000000000046652" data-uri="chapter10.xhtml#P7000497027000000000000000046652" class="pcalibre1 calibre1 pcalibre2">foo.txt</code>. However, when we run it on our system, it fails with a "bad file descriptor." Given this behavior, fill in the pseudocode that the shell must be executing between the <code id="P7000497027000000000000000046653" data-uri="chapter10.xhtml#P7000497027000000000000000046653" class="pcalibre1 calibre1 pcalibre2">fork</code> and <code id="P7000497027000000000000000046654" data-uri="chapter10.xhtml#P7000497027000000000000000046654" class="pcalibre1 calibre1 pcalibre2">execve</code> calls:</p>

<pre id="P7000497027000000000000000046655" data-uri="chapter10.xhtml#P7000497027000000000000000046655" class="calibre2 pcalibre2 pcalibre1"><code id="P7000497027000000000000000046656" data-uri="chapter10.xhtml#P7000497027000000000000000046656" class="calibre3 pcalibre1 pcalibre2">
<span class="pcalibre1 pcalibre2 pcalibre5" id="P7000497027000000000000000007B41" title="915" data-uri="chapter10.xhtml#P7000497027000000000000000007B41" epub:type="pagebreak"></span>if (Fork() == 0) { /* child */
	/* What code is the shell executing right here? */
	Execve("fstatcheck", argv, envp);
}
</code></pre>
</section>
<section id="P7000497027000000000000000007B42" data-uri="chapter10.xhtml#P7000497027000000000000000007B42" class="pcalibre1 pcalibre2 pcalibre3"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" id="P7000497027000000000000000046657" data-uri="chapter10.xhtml#P7000497027000000000000000046657" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">10.10 </span></h1></header>
<p id="P7000497027000000000000000046658" data-uri="chapter10.xhtml#P7000497027000000000000000046658" class="pcalibre8 pcalibre1 pcalibre2">Modify the <code id="P7000497027000000000000000046659" data-uri="chapter10.xhtml#P7000497027000000000000000046659" class="pcalibre1 calibre1 pcalibre2">cpfile</code> program in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000007975.xhtml#P70004970270000000000000000079C8"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">10.5</span></a> so that it takes an optional command-line argument <code id="P700049702700000000000000004665A" data-uri="chapter10.xhtml#P700049702700000000000000004665A" class="pcalibre1 calibre1 pcalibre2">infile</code>. If <code id="P700049702700000000000000004665B" data-uri="chapter10.xhtml#P700049702700000000000000004665B" class="pcalibre1 calibre1 pcalibre2">infile</code> is given, then copy <code id="P700049702700000000000000004665C" data-uri="chapter10.xhtml#P700049702700000000000000004665C" class="pcalibre1 calibre1 pcalibre2">infile</code> to standard output; otherwise, copy standard input to standard output as before. The twist is that your solution must use the original copy loop (lines 9âˆ’11) for both cases. You are only allowed to insert code, and you are not allowed to change any of the existing code.</p>
</section>
</section></body></html>
