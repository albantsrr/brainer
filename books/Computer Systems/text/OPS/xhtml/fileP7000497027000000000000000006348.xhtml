<?xml version='1.0' encoding='utf-8'?>
<html xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg" xmlns:epub="http://www.idpf.org/2007/ops" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" epub:prefix="index: http://www.index.com/">
  <head>
    <meta name="dcterms.conformsTo" content="PXE Basic 1.0"/>
    <meta name="generator" content="PXE Tools version 1.39.52"/>
    <!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
    <title>7.8 Executable Object Files</title>
    <link rel="alternate stylesheet" type="text/css" title="night" href="../css/theme/night.css"/>
    <link rel="alternate stylesheet" type="text/css" title="sepia" href="../css/theme/sepia.css"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body epub:type="bodymatter" class="pcalibre1 pcalibre2 pcalibre">
<section id="P7000497027000000000000000006348" class="pcalibre1 pcalibre2 pcalibre3"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre2 pcalibre4" id="P7000497027000000000000000044ACD" data-uri="chapter07.xhtml#P7000497027000000000000000044ACD" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">7.8 </span>Executable Object Files</h1></header>
<p id="P7000497027000000000000000044ACE" data-uri="chapter07.xhtml#P7000497027000000000000000044ACE" class="pcalibre8 pcalibre1 pcalibre2">We have seen how the linker merges multiple object files into a single executable object file. Our example C program, which began life as a collection of ASCII text files, has been transformed into a single binary file that contains all of the information needed to load the program into memory and run it. <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P700049702700000000000000000634B"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">7.13</span></a> summarizes the kinds of information in a typical ELF executable file.</p>
<figure class="pcalibre2 pcalibre32 pcalibre35" id="P700049702700000000000000000634B" data-uri="chapter07.xhtml#P700049702700000000000000000634B">
<img alt="A diagram shows a typical ELF executable object file." id="P7000497027000000000000000044ACF" data-uri="P700049702700000000000000000B75B" src="../images/p695-1.png" class="pcalibre238 pcalibre2 pcalibre1"/>
<figcaption id="P7000497027000000000000000044AD0" data-uri="chapter07.xhtml#P7000497027000000000000000044AD0" class="pcalibre1 pcalibre2 calibre4"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" id="P7000497027000000000000000044AD1" data-uri="chapter07.xhtml#P7000497027000000000000000044AD1" epub:type="title"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">7.13 </span>Typical ELF executable object file.</h1></header>
<details class="pcalibre1 pcalibre2 pcalibre59" id="P7000497027000000000000000024DE4" data-uri="chapter07.xhtml#P7000497027000000000000000024DE4">
<summary class="pcalibre1 pcalibre2 pcalibre61 pcalibre60"><span class="pcalibre1 pcalibre2 pcalibre37">Description</span></summary>
<p id="P7000497027000000000000000044AD2" data-uri="chapter07.xhtml#P7000497027000000000000000044AD2" class="pcalibre8 pcalibre1 pcalibre2">A diagram has 11 sections extending from 0 at the top, with a section at the bottom, containing section header table, describing object file sections. All 12 sections are grouped, as summarized in the list below.</p>
<ul id="P7000497027000000000000000044AD3" data-uri="chapter07.xhtml#P7000497027000000000000000044AD3" class="pcalibre1 pcalibre2 pcalibre62">
<li id="P7000497027000000000000000044AD4" data-uri="chapter07.xhtml#P7000497027000000000000000044AD4" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044AD5" data-uri="chapter07.xhtml#P7000497027000000000000000044AD5" class="pcalibre1 pcalibre2 pcalibre10">Read-only memory segment (code segment):</p>
<ul id="P7000497027000000000000000044AD6" data-uri="chapter07.xhtml#P7000497027000000000000000044AD6" class="pcalibre1 pcalibre2 pcalibre69">
<li id="P7000497027000000000000000044AD7" data-uri="chapter07.xhtml#P7000497027000000000000000044AD7" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044AD8" data-uri="chapter07.xhtml#P7000497027000000000000000044AD8" class="pcalibre1 pcalibre2 pcalibre10">ELF header</p></li>
<li id="P7000497027000000000000000044AD9" data-uri="chapter07.xhtml#P7000497027000000000000000044AD9" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044ADA" data-uri="chapter07.xhtml#P7000497027000000000000000044ADA" class="pcalibre1 pcalibre2 pcalibre10">Segment header table (maps contiguous file sections to run-time memory segments)</p></li>
<li id="P7000497027000000000000000044ADB" data-uri="chapter07.xhtml#P7000497027000000000000000044ADB" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044ADC" data-uri="chapter07.xhtml#P7000497027000000000000000044ADC" class="pcalibre1 pcalibre2 pcalibre10">.init</p></li>
<li id="P7000497027000000000000000044ADD" data-uri="chapter07.xhtml#P7000497027000000000000000044ADD" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044ADE" data-uri="chapter07.xhtml#P7000497027000000000000000044ADE" class="pcalibre1 pcalibre2 pcalibre10">.text</p></li>
<li id="P7000497027000000000000000044ADF" data-uri="chapter07.xhtml#P7000497027000000000000000044ADF" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044AE0" data-uri="chapter07.xhtml#P7000497027000000000000000044AE0" class="pcalibre1 pcalibre2 pcalibre10">.rodata</p></li>
</ul></li>
<li id="P7000497027000000000000000044AE1" data-uri="chapter07.xhtml#P7000497027000000000000000044AE1" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044AE2" data-uri="chapter07.xhtml#P7000497027000000000000000044AE2" class="pcalibre1 pcalibre2 pcalibre10">Read/write memory segment (data segment)</p>
<ul id="P7000497027000000000000000044AE3" data-uri="chapter07.xhtml#P7000497027000000000000000044AE3" class="pcalibre1 pcalibre2 pcalibre69">
<li id="P7000497027000000000000000044AE4" data-uri="chapter07.xhtml#P7000497027000000000000000044AE4" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044AE5" data-uri="chapter07.xhtml#P7000497027000000000000000044AE5" class="pcalibre1 pcalibre2 pcalibre10">.data</p></li>
<li id="P7000497027000000000000000044AE6" data-uri="chapter07.xhtml#P7000497027000000000000000044AE6" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044AE7" data-uri="chapter07.xhtml#P7000497027000000000000000044AE7" class="pcalibre1 pcalibre2 pcalibre10">.bss</p></li>
</ul></li>
<li id="P7000497027000000000000000044AE8" data-uri="chapter07.xhtml#P7000497027000000000000000044AE8" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044AE9" data-uri="chapter07.xhtml#P7000497027000000000000000044AE9" class="pcalibre1 pcalibre2 pcalibre10">Symbol table and bebugging info are not loaded into memory</p>
<ul id="P7000497027000000000000000044AEA" data-uri="chapter07.xhtml#P7000497027000000000000000044AEA" class="pcalibre1 pcalibre2 pcalibre69">
<li id="P7000497027000000000000000044AEB" data-uri="chapter07.xhtml#P7000497027000000000000000044AEB" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044AEC" data-uri="chapter07.xhtml#P7000497027000000000000000044AEC" class="pcalibre1 pcalibre2 pcalibre10">.symtab</p></li>
<li id="P7000497027000000000000000044AED" data-uri="chapter07.xhtml#P7000497027000000000000000044AED" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044AEE" data-uri="chapter07.xhtml#P7000497027000000000000000044AEE" class="pcalibre1 pcalibre2 pcalibre10">.debug</p></li>
<li id="P7000497027000000000000000044AEF" data-uri="chapter07.xhtml#P7000497027000000000000000044AEF" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044AF0" data-uri="chapter07.xhtml#P7000497027000000000000000044AF0" class="pcalibre1 pcalibre2 pcalibre10">.line</p></li>
<li id="P7000497027000000000000000044AF1" data-uri="chapter07.xhtml#P7000497027000000000000000044AF1" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044AF2" data-uri="chapter07.xhtml#P7000497027000000000000000044AF2" class="pcalibre1 pcalibre2 pcalibre10">.strtb</p></li>
<li id="P7000497027000000000000000044AF3" data-uri="chapter07.xhtml#P7000497027000000000000000044AF3" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044AF4" data-uri="chapter07.xhtml#P7000497027000000000000000044AF4" class="pcalibre1 pcalibre2 pcalibre10">Section header table</p></li>
</ul></li>
</ul>
</details>
</figcaption>
</figure>
<figure class="pcalibre2 pcalibre32 pcalibre35" id="P700049702700000000000000000634F" data-uri="chapter07.xhtml#P700049702700000000000000000634F">
<span class="pcalibre1 pcalibre2 pcalibre5" id="P7000497027000000000000000006350" title="696" data-uri="chapter07.xhtml#P7000497027000000000000000006350" epub:type="pagebreak"></span>
<p id="P7000497027000000000000000044AF5" data-uri="chapter07.xhtml#P7000497027000000000000000044AF5" class="pcalibre8 pcalibre1 pcalibre2">-------------------------------------------<i class="pcalibre17 pcalibre2 pcalibre1">code/link/prog-exe.d</i></p>
<pre id="P7000497027000000000000000044AF6" data-uri="chapter07.xhtml#P7000497027000000000000000044AF6" class="calibre2 pcalibre2 pcalibre1"><code id="P7000497027000000000000000044AF7" data-uri="chapter07.xhtml#P7000497027000000000000000044AF7" class="calibre3 pcalibre1 pcalibre2">
	<i class="pcalibre17 pcalibre2 pcalibre1">Read-only code segment</i>
1	LOAD off	0x0000000000000000 vaddr 0x0000000000400000 paddr 0x0000000000400000 align 2**21
2	   filesz 0x000000000000069c memsz 0x000000000000069c flags r-x
	<i class="pcalibre17 pcalibre2 pcalibre1">Read/write data segment</i>
3	LOAD off	 0x0000000000000df8 vaddr 0x0000000000600df8 paddr 0x0000000000600df8 align 2**21
4	   filesz 0x0000000000000228 memsz 0x0000000000000230 flags rw-
</code></pre>
<p id="P7000497027000000000000000044AF8" data-uri="chapter07.xhtml#P7000497027000000000000000044AF8" class="pcalibre8 pcalibre1 pcalibre2">-------------------------------------------<i class="pcalibre17 pcalibre2 pcalibre1">code/link/prog-exe.d</i></p>
<figcaption id="P7000497027000000000000000044AF9" data-uri="chapter07.xhtml#P7000497027000000000000000044AF9" class="pcalibre1 pcalibre2 calibre4"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" id="P7000497027000000000000000044AFA" data-uri="chapter07.xhtml#P7000497027000000000000000044AFA" epub:type="title"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">7.14 </span>Program header table for the example executable <code id="P7000497027000000000000000044AFB" data-uri="chapter07.xhtml#P7000497027000000000000000044AFB" class="pcalibre1 calibre1 pcalibre2">prog.</code></h1></header>
<div class="pcalibre1 caption pcalibre2" id="P7000497027000000000000000044AFC" data-uri="chapter07.xhtml#P7000497027000000000000000044AFC"><p id="P7000497027000000000000000044AFD" data-uri="chapter07.xhtml#P7000497027000000000000000044AFD" class="pcalibre1 pcalibre2 pcalibre10"><code id="P7000497027000000000000000044AFE" data-uri="chapter07.xhtml#P7000497027000000000000000044AFE" class="pcalibre1 calibre1 pcalibre2">off</code>: offset in object file; <code id="P7000497027000000000000000044AFF" data-uri="chapter07.xhtml#P7000497027000000000000000044AFF" class="pcalibre1 calibre1 pcalibre2">vaddr/paddr</code>: memory address; <code id="P7000497027000000000000000044B00" data-uri="chapter07.xhtml#P7000497027000000000000000044B00" class="pcalibre1 calibre1 pcalibre2">align</code>: alignment requirement; <code id="P7000497027000000000000000044B01" data-uri="chapter07.xhtml#P7000497027000000000000000044B01" class="pcalibre1 calibre1 pcalibre2">filesz</code>: segment size in object file; <code id="P7000497027000000000000000044B02" data-uri="chapter07.xhtml#P7000497027000000000000000044B02" class="pcalibre1 calibre1 pcalibre2">memsz</code>: segment size in memory; <code id="P7000497027000000000000000044B03" data-uri="chapter07.xhtml#P7000497027000000000000000044B03" class="pcalibre1 calibre1 pcalibre2">flags</code>: run-time permissions.</p></div></figcaption>
</figure>
<p id="P7000497027000000000000000044B04" data-uri="chapter07.xhtml#P7000497027000000000000000044B04" class="pcalibre8 pcalibre1 pcalibre2">The format of an executable object file is similar to that of a relocatable object file. The ELF header describes the overall format of the file. It also includes the program's <i class="pcalibre17 pcalibre2 pcalibre1">entry point</i>, which is the address of the first instruction to execute when the program runs. The <code id="P7000497027000000000000000044B05" data-uri="chapter07.xhtml#P7000497027000000000000000044B05" class="pcalibre1 calibre1 pcalibre2">.text, .rodata</code>, and <code id="P7000497027000000000000000044B06" data-uri="chapter07.xhtml#P7000497027000000000000000044B06" class="pcalibre1 calibre1 pcalibre2">.data</code> sections are similar to those in a relocatable object file, except that these sections have been relocated to their eventual run-time memory addresses. The <code id="P7000497027000000000000000044B07" data-uri="chapter07.xhtml#P7000497027000000000000000044B07" class="pcalibre1 calibre1 pcalibre2">.init</code> section defines a small function, called <code id="P7000497027000000000000000044B08" data-uri="chapter07.xhtml#P7000497027000000000000000044B08" class="pcalibre1 calibre1 pcalibre2">_init</code>, that will be called by the program's initialization code. Since the executable is <i class="pcalibre17 pcalibre2 pcalibre1">fully linked</i> (relocated), it needs no <code id="P7000497027000000000000000044B09" data-uri="chapter07.xhtml#P7000497027000000000000000044B09" class="pcalibre1 calibre1 pcalibre2">.rel</code> sections.</p>
<p id="P7000497027000000000000000044B0A" data-uri="chapter07.xhtml#P7000497027000000000000000044B0A" class="pcalibre8 pcalibre1 pcalibre2">ELF executables are designed to be easy to load into memory, with contiguous chunks of the executable file mapped to contiguous memory segments. This mapping is described by the <i class="pcalibre17 pcalibre2 pcalibre1">program header table</i>. <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P700049702700000000000000000634F"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">7.14</span></a> shows part of the program header table for our example executable <code id="P7000497027000000000000000044B0B" data-uri="chapter07.xhtml#P7000497027000000000000000044B0B" class="pcalibre1 calibre1 pcalibre2">prog</code>, as displayed by <code id="P7000497027000000000000000044B0C" data-uri="chapter07.xhtml#P7000497027000000000000000044B0C" class="pcalibre1 calibre1 pcalibre2"><span class="pcalibre1 pcalibre29 pcalibre2">objdump</span></code>.</p>
<p id="P7000497027000000000000000044B0D" data-uri="chapter07.xhtml#P7000497027000000000000000044B0D" class="pcalibre8 pcalibre1 pcalibre2">From the program header table, we see that two memory segments will be initialized with the contents of the executable object file. Lines 1 and 2 tell us that the first segment (the <i class="pcalibre17 pcalibre2 pcalibre1">code segment</i>) has read/execute permissions, starts at memory address <code id="P7000497027000000000000000044B0E" data-uri="chapter07.xhtml#P7000497027000000000000000044B0E" class="pcalibre1 calibre1 pcalibre2">0x400000</code>, has a total size in memory of <code id="P7000497027000000000000000044B0F" data-uri="chapter07.xhtml#P7000497027000000000000000044B0F" class="pcalibre1 calibre1 pcalibre2">0x69c</code> bytes, and is initialized with the first <code id="P7000497027000000000000000044B10" data-uri="chapter07.xhtml#P7000497027000000000000000044B10" class="pcalibre1 calibre1 pcalibre2">0x69c</code> bytes of the executable object file, which includes the ELF header, the program header table, and the <code id="P7000497027000000000000000044B11" data-uri="chapter07.xhtml#P7000497027000000000000000044B11" class="pcalibre1 calibre1 pcalibre2">.init, .text</code>, and <code id="P7000497027000000000000000044B12" data-uri="chapter07.xhtml#P7000497027000000000000000044B12" class="pcalibre1 calibre1 pcalibre2">.rodata</code> sections.</p>
<p id="P7000497027000000000000000044B13" data-uri="chapter07.xhtml#P7000497027000000000000000044B13" class="pcalibre8 pcalibre1 pcalibre2">Lines 3 and 4 tell us that the second segment (the <i class="pcalibre17 pcalibre2 pcalibre1">data segment</i>) has read/write permissions, starts at memory address <code id="P7000497027000000000000000044B14" data-uri="chapter07.xhtml#P7000497027000000000000000044B14" class="pcalibre1 calibre1 pcalibre2">0x600df8</code>, has a total memory size of <code id="P7000497027000000000000000044B15" data-uri="chapter07.xhtml#P7000497027000000000000000044B15" class="pcalibre1 calibre1 pcalibre2">0x230</code> bytes, and is initialized with the <code id="P7000497027000000000000000044B16" data-uri="chapter07.xhtml#P7000497027000000000000000044B16" class="pcalibre1 calibre1 pcalibre2">0x228</code> bytes in the .data section starting at offset <code id="P7000497027000000000000000044B17" data-uri="chapter07.xhtml#P7000497027000000000000000044B17" class="pcalibre1 calibre1 pcalibre2">0xdf8</code> in the object file. The remaining 8 bytes in the segment correspond to <code id="P7000497027000000000000000044B18" data-uri="chapter07.xhtml#P7000497027000000000000000044B18" class="pcalibre1 calibre1 pcalibre2">.bss</code> data that will be initialized to zero at run time.</p>
<p id="P7000497027000000000000000044B19" data-uri="chapter07.xhtml#P7000497027000000000000000044B19" class="pcalibre8 pcalibre1 pcalibre2">For any segment <var class="pcalibre17 pcalibre2 pcalibre1">s</var>, the linker must choose a starting address, <code id="P7000497027000000000000000044B1A" data-uri="chapter07.xhtml#P7000497027000000000000000044B1A" class="pcalibre1 calibre1 pcalibre2">vaddr</code>, such that</p>
<pre id="P7000497027000000000000000044B1B" data-uri="chapter07.xhtml#P7000497027000000000000000044B1B" class="calibre2 pcalibre2 pcalibre1"><code id="P7000497027000000000000000044B1C" data-uri="chapter07.xhtml#P7000497027000000000000000044B1C" class="calibre3 pcalibre1 pcalibre2">vaddr mod align = offmod align</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" id="P7000497027000000000000000044B1D" data-uri="chapter07.xhtml#P7000497027000000000000000044B1D">where <code id="P7000497027000000000000000044B1E" data-uri="chapter07.xhtml#P7000497027000000000000000044B1E" class="pcalibre1 calibre1 pcalibre2">off</code> is the offset of the segment's first section in the object file, and <code id="P7000497027000000000000000044B1F" data-uri="chapter07.xhtml#P7000497027000000000000000044B1F" class="pcalibre1 calibre1 pcalibre2">align</code> is the alignment specified in the program header (2<sup class="pcalibre1 pcalibre2 pcalibre85">21</sup> = <code id="P7000497027000000000000000044B20" data-uri="chapter07.xhtml#P7000497027000000000000000044B20" class="pcalibre1 calibre1 pcalibre2">0x200000</code>). For example, in the data segment in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P700049702700000000000000000634F"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">7.14</span></a>,</p>
<p id="P7000497027000000000000000044B21" data-uri="chapter07.xhtml#P7000497027000000000000000044B21" class="pcalibre8 pcalibre1 pcalibre2"><span class="pcalibre1 pcalibre2 pcalibre5" id="P700049702700000000000000000637E" title="697" data-uri="chapter07.xhtml#P700049702700000000000000000637E" epub:type="pagebreak"></span></p>
<pre id="P7000497027000000000000000044B22" data-uri="chapter07.xhtml#P7000497027000000000000000044B22" class="calibre2 pcalibre2 pcalibre1"><code id="P7000497027000000000000000044B23" data-uri="chapter07.xhtml#P7000497027000000000000000044B23" class="calibre3 pcalibre1 pcalibre2">vaddr mod align = 0x600df8 mod 0x200000 = 0xdf8</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" id="P7000497027000000000000000044B24" data-uri="chapter07.xhtml#P7000497027000000000000000044B24">and</p>
<pre id="P7000497027000000000000000044B25" data-uri="chapter07.xhtml#P7000497027000000000000000044B25" class="calibre2 pcalibre2 pcalibre1"><code id="P7000497027000000000000000044B26" data-uri="chapter07.xhtml#P7000497027000000000000000044B26" class="calibre3 pcalibre1 pcalibre2">offmod align = 0xdf8 mod 0x200000= 0xdf8</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" id="P7000497027000000000000000044B27" data-uri="chapter07.xhtml#P7000497027000000000000000044B27">This alignment requirement is an optimization that enables segments in the object file to be transferred efficiently to memory when the program executes. The reason is somewhat subtle and is due to the way that virtual memory is organized as large contiguous power-of-2 chunks of bytes. You will learn all about virtual memory in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000006FF7.xhtml#P7000497027000000000000000006FF7"><span class="pcalibre1 pcalibre21 pcalibre2">Chapter </span><span class="pcalibre1 pcalibre21 pcalibre2">9</span></a>.</p>
</section></body></html>
