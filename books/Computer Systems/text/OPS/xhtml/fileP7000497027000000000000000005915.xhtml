<?xml version='1.0' encoding='utf-8'?>
<html xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg" xmlns:epub="http://www.idpf.org/2007/ops" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" epub:prefix="index: http://www.index.com/">
  <head>
    <meta name="dcterms.conformsTo" content="PXE Basic 1.0"/>
    <meta name="generator" content="PXE Tools version 1.39.52"/>
    <!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
    <title>6.5 Writing Cache-Friendly Code</title>
    <link rel="alternate stylesheet" type="text/css" title="night" href="../css/theme/night.css"/>
    <link rel="alternate stylesheet" type="text/css" title="sepia" href="../css/theme/sepia.css"/>
    <script src="js/format_lg_obj.js"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body epub:type="bodymatter" class="pcalibre1 pcalibre2 pcalibre">
<section id="P7000497027000000000000000005915" class="pcalibre1 pcalibre2 pcalibre3"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre2 pcalibre4" id="P700049702700000000000000004407A" data-uri="chapter06.xhtml#P700049702700000000000000004407A" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">6.5 </span>Writing Cache-Friendly Code</h1></header>
<p id="P700049702700000000000000004407B" data-uri="chapter06.xhtml#P700049702700000000000000004407B" class="pcalibre8 pcalibre1 pcalibre2">In <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000005435.xhtml#P7000497027000000000000000005435"><span class="pcalibre1 pcalibre21 pcalibre2">Section </span><span class="pcalibre1 pcalibre21 pcalibre2">6.2</span></a>, we introduced the idea of locality and talked in qualitative terms about what constitutes good locality. Now that we understand how cache memories work, we can be more precise. Programs with better locality will tend to have lower miss rates, and programs with lower miss rates will tend to run faster than programs with higher miss rates. Thus, good programmers should always try to</p>
<aside class="pcalibre31 pcalibre32 pcalibre2" id="P7000497027000000000000000005918" data-uri="chapter06.xhtml#P7000497027000000000000000005918"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre33" id="P700049702700000000000000004407C" data-uri="chapter06.xhtml#P700049702700000000000000004407C" epub:type="title"><span class="pcalibre1 pcalibre2 pcalibre5" id="P700049702700000000000000000591A" title="634" data-uri="chapter06.xhtml#P700049702700000000000000000591A" epub:type="pagebreak"></span><span class="pcalibre1 pcalibre2 pcalibre34">Aside </span>Cache lines, sets, and blocks: What's the difference?</h1></header>
<p id="P700049702700000000000000004407D" data-uri="chapter06.xhtml#P700049702700000000000000004407D" class="pcalibre1 pcalibre2 pcalibre40">It is easy to confuse the distinction between cache lines, sets, and blocks. Let's review these ideas and make sure they are clear:</p>
<ul id="P700049702700000000000000004407E" data-uri="chapter06.xhtml#P700049702700000000000000004407E" class="pcalibre1 calibre9 pcalibre2">
<li id="P700049702700000000000000004407F" data-uri="chapter06.xhtml#P700049702700000000000000004407F" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044080" data-uri="chapter06.xhtml#P7000497027000000000000000044080" class="pcalibre1 pcalibre2 pcalibre10">A <i class="pcalibre17 pcalibre2 pcalibre1">block</i> is a fixed-size packet of information that moves back and forth between a cache and main memory (or a lower-level cache).</p></li>
<li id="P7000497027000000000000000044081" data-uri="chapter06.xhtml#P7000497027000000000000000044081" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044082" data-uri="chapter06.xhtml#P7000497027000000000000000044082" class="pcalibre1 pcalibre2 pcalibre10">A <i class="pcalibre17 pcalibre2 pcalibre1">line</i> is a container in a cache that stores a block, as well as other information such as the valid bit and the tag bits.</p></li>
<li id="P7000497027000000000000000044083" data-uri="chapter06.xhtml#P7000497027000000000000000044083" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044084" data-uri="chapter06.xhtml#P7000497027000000000000000044084" class="pcalibre1 pcalibre2 pcalibre10">A <i class="pcalibre17 pcalibre2 pcalibre1">set</i> is a collection of one or more lines. Sets in direct-mapped caches consist of a single line. Sets in set associative and fully associative caches consist of multiple lines.</p></li>
</ul>
<p class="pcalibre1 pcalibre2 pcalibre40" id="P7000497027000000000000000044085" data-uri="chapter06.xhtml#P7000497027000000000000000044085">In direct-mapped caches, sets and lines are indeed equivalent. However, in associative caches, sets and lines are very different things and the terms cannot be used interchangeably.</p>
<p id="P7000497027000000000000000044086" data-uri="chapter06.xhtml#P7000497027000000000000000044086" class="pcalibre1 pcalibre2 pcalibre10">Since a line always stores a single block, the terms "line" and "block" are often used interchangeably. For example, systems professionals usually refer to the "line size" of a cache, when what they really mean is the block size. This usage is very common and shouldn't cause any confusion as long as you understand the distinction between blocks and lines.</p>
</aside>
<p class="pcalibre8 pcalibre1 pcalibre2" id="P7000497027000000000000000044087" data-uri="chapter06.xhtml#P7000497027000000000000000044087">write code that is <i class="pcalibre17 pcalibre2 pcalibre1">cache friendly</i>, in the sense that it has good locality. Here is the basic approach we use to try to ensure that our code is cache friendly.</p>
<ol id="P7000497027000000000000000044088" data-uri="chapter06.xhtml#P7000497027000000000000000044088" class="pcalibre1 calibre19 pcalibre2">
<li id="P7000497027000000000000000044089" data-uri="chapter06.xhtml#P7000497027000000000000000044089" class="pcalibre39 pcalibre2 pcalibre1"><p id="P700049702700000000000000004408A" data-uri="chapter06.xhtml#P700049702700000000000000004408A" class="pcalibre1 pcalibre2 pcalibre10"><span class="pcalibre1 pcalibre2 pcalibre41">Make the common case go fast. </span>Programs often spend most of their time in a few core functions. These functions often spend most of their time in a few loops. So focus on the inner loops of the core functions and ignore the rest.</p></li>
<li id="P700049702700000000000000004408B" data-uri="chapter06.xhtml#P700049702700000000000000004408B" class="pcalibre39 pcalibre2 pcalibre1"><p id="P700049702700000000000000004408C" data-uri="chapter06.xhtml#P700049702700000000000000004408C" class="pcalibre1 pcalibre2 pcalibre10"><span class="pcalibre1 pcalibre2 pcalibre41">Minimize the number of cache misses in each inner loop. </span>All other things being equal, such as the total number of loads and stores, loops with better miss rates will run faster.</p></li>
</ol>
<p id="P700049702700000000000000004408D" data-uri="chapter06.xhtml#P700049702700000000000000004408D" class="pcalibre8 pcalibre1 pcalibre2">To see how this works in practice, consider the <code id="P700049702700000000000000004408E" data-uri="chapter06.xhtml#P700049702700000000000000004408E" class="pcalibre1 calibre1 pcalibre2">sumvec</code> function from <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000005435.xhtml#P7000497027000000000000000005435"><span class="pcalibre1 pcalibre21 pcalibre2">Section </span><span class="pcalibre1 pcalibre21 pcalibre2">6.2</span></a>:</p>
<pre id="P700049702700000000000000004408F" data-uri="chapter06.xhtml#P700049702700000000000000004408F" class="calibre2 pcalibre2 pcalibre1"><code id="P7000497027000000000000000044090" data-uri="chapter06.xhtml#P7000497027000000000000000044090" class="calibre3 pcalibre1 pcalibre2">
1	int sumvec (int v[N])
2	{
3		int i, sum = 0 ;
4	
5		for (i = 0; i &lt; N; i++)
6			sum += v[i];
7		return sum;
8	}
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" id="P7000497027000000000000000044091" data-uri="chapter06.xhtml#P7000497027000000000000000044091">Is this function cache friendly? First, notice that there is good temporal locality in the loop body with respect to the local variables <code id="P7000497027000000000000000044092" data-uri="chapter06.xhtml#P7000497027000000000000000044092" class="pcalibre1 calibre1 pcalibre2">i</code> and <code id="P7000497027000000000000000044093" data-uri="chapter06.xhtml#P7000497027000000000000000044093" class="pcalibre1 calibre1 pcalibre2">sum</code>. In fact, because these are local variables, any reasonable optimizing compiler will cache them in the register file, the highest level of the memory hierarchy. Now consider the stride-1 references to vector <code id="P7000497027000000000000000044094" data-uri="chapter06.xhtml#P7000497027000000000000000044094" class="pcalibre1 calibre1 pcalibre2">v</code>. In general, if a cache has a block size of <var class="pcalibre17 pcalibre2 pcalibre1">B</var> bytes, then a <span class="pcalibre1 pcalibre2 pcalibre5" id="P7000497027000000000000000005933" title="635" data-uri="chapter06.xhtml#P7000497027000000000000000005933" epub:type="pagebreak"></span>stride-<var class="pcalibre17 pcalibre2 pcalibre1">k</var> reference pattern (where <var class="pcalibre17 pcalibre2 pcalibre1">k</var> is expressed in words) results in an average of min (1, (<i class="pcalibre17 pcalibre2 pcalibre1">word size</i> × <var class="pcalibre17 pcalibre2 pcalibre1">k</var>)/<var class="pcalibre17 pcalibre2 pcalibre1">B</var>) misses per loop iteration. This is minimized for <var class="pcalibre17 pcalibre2 pcalibre1">k</var> = 1, so the stride-1 references to <code id="P7000497027000000000000000044095" data-uri="chapter06.xhtml#P7000497027000000000000000044095" class="pcalibre1 calibre1 pcalibre2">v</code> are indeed cache friendly. For example, suppose that <code id="P7000497027000000000000000044096" data-uri="chapter06.xhtml#P7000497027000000000000000044096" class="pcalibre1 calibre1 pcalibre2">v</code> is block aligned, words are 4 bytes, cache blocks are 4 words, and the cache is initially empty (a cold cache). Then, regardless of the cache organization, the references to <code id="P7000497027000000000000000044097" data-uri="chapter06.xhtml#P7000497027000000000000000044097" class="pcalibre1 calibre1 pcalibre2">v</code> will result in the following pattern of hits and misses:</p>
<table class="pcalibre1 informaltable pcalibre2" id="P7000497027000000000000000044098" data-uri="chapter06.xhtml#P7000497027000000000000000044098">
<tbody class="pcalibre1 pcalibre2 calibre6">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td id="P7000497027000000000000000044099" data-uri="chapter06.xhtml#P7000497027000000000000000044099" class="pcalibre1 pcalibre2 calibre7"><code id="P700049702700000000000000004409A" data-uri="chapter06.xhtml#P700049702700000000000000004409A" class="calibre3 pcalibre1 pcalibre2">v[i]</code></td>
<td id="P700049702700000000000000004409B" data-uri="chapter06.xhtml#P700049702700000000000000004409B" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 0</td>
<td id="P700049702700000000000000004409C" data-uri="chapter06.xhtml#P700049702700000000000000004409C" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 1</td>
<td id="P700049702700000000000000004409D" data-uri="chapter06.xhtml#P700049702700000000000000004409D" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 2</td>
<td id="P700049702700000000000000004409E" data-uri="chapter06.xhtml#P700049702700000000000000004409E" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 3</td>
<td id="P700049702700000000000000004409F" data-uri="chapter06.xhtml#P700049702700000000000000004409F" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 4</td>
<td id="P70004970270000000000000000440A0" data-uri="chapter06.xhtml#P70004970270000000000000000440A0" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 5</td>
<td id="P70004970270000000000000000440A1" data-uri="chapter06.xhtml#P70004970270000000000000000440A1" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 6</td>
<td id="P70004970270000000000000000440A2" data-uri="chapter06.xhtml#P70004970270000000000000000440A2" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 7</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td id="P70004970270000000000000000440A3" data-uri="chapter06.xhtml#P70004970270000000000000000440A3" class="pcalibre1 pcalibre2 calibre7">Access order, [h]it or [m]iss</td>
<td id="P70004970270000000000000000440A4" data-uri="chapter06.xhtml#P70004970270000000000000000440A4" class="pcalibre1 pcalibre2 calibre7">1 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P70004970270000000000000000440A5" data-uri="chapter06.xhtml#P70004970270000000000000000440A5" class="pcalibre1 pcalibre2 calibre7">2 [h]</td>
<td id="P70004970270000000000000000440A6" data-uri="chapter06.xhtml#P70004970270000000000000000440A6" class="pcalibre1 pcalibre2 calibre7">3 [h]</td>
<td id="P70004970270000000000000000440A7" data-uri="chapter06.xhtml#P70004970270000000000000000440A7" class="pcalibre1 pcalibre2 calibre7">4 [h]</td>
<td id="P70004970270000000000000000440A8" data-uri="chapter06.xhtml#P70004970270000000000000000440A8" class="pcalibre1 pcalibre2 calibre7">5 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P70004970270000000000000000440A9" data-uri="chapter06.xhtml#P70004970270000000000000000440A9" class="pcalibre1 pcalibre2 calibre7">6 [h]</td>
<td id="P70004970270000000000000000440AA" data-uri="chapter06.xhtml#P70004970270000000000000000440AA" class="pcalibre1 pcalibre2 calibre7">7 [h]</td>
<td id="P70004970270000000000000000440AB" data-uri="chapter06.xhtml#P70004970270000000000000000440AB" class="pcalibre1 pcalibre2 calibre7">8 [h]</td>
</tr>
</tbody>
</table>
<p id="P70004970270000000000000000440AC" data-uri="chapter06.xhtml#P70004970270000000000000000440AC" class="pcalibre8 pcalibre1 pcalibre2">In this example, the reference to <code id="P70004970270000000000000000440AD" data-uri="chapter06.xhtml#P70004970270000000000000000440AD" class="pcalibre1 calibre1 pcalibre2">v[0]</code> misses and the corresponding block, which contains <code id="P70004970270000000000000000440AE" data-uri="chapter06.xhtml#P70004970270000000000000000440AE" class="pcalibre1 calibre1 pcalibre2">v[0]−v[3]</code>, is loaded into the cache from memory. Thus, the next three references are all hits. The reference to <code id="P70004970270000000000000000440AF" data-uri="chapter06.xhtml#P70004970270000000000000000440AF" class="pcalibre1 calibre1 pcalibre2">v[4]</code> causes another miss as a new block is loaded into the cache, the next three references are hits, and so on. In general, three out of four references will hit, which is the best we can do in this case with a cold cache.</p>
<p id="P70004970270000000000000000440B0" data-uri="chapter06.xhtml#P70004970270000000000000000440B0" class="pcalibre8 pcalibre1 pcalibre2">To summarize, our simple <code id="P70004970270000000000000000440B1" data-uri="chapter06.xhtml#P70004970270000000000000000440B1" class="pcalibre1 calibre1 pcalibre2">sumvec</code> example illustrates two important points about writing cache-friendly code:</p>
<ul id="P70004970270000000000000000440B2" data-uri="chapter06.xhtml#P70004970270000000000000000440B2" class="pcalibre1 calibre9 pcalibre2">
<li id="P70004970270000000000000000440B3" data-uri="chapter06.xhtml#P70004970270000000000000000440B3" class="pcalibre39 pcalibre2 pcalibre1"><p id="P70004970270000000000000000440B4" data-uri="chapter06.xhtml#P70004970270000000000000000440B4" class="pcalibre1 pcalibre2 pcalibre10">Repeated references to local variables are good because the compiler can cache them in the register file (temporal locality).</p></li>
<li id="P70004970270000000000000000440B5" data-uri="chapter06.xhtml#P70004970270000000000000000440B5" class="pcalibre39 pcalibre2 pcalibre1"><p id="P70004970270000000000000000440B6" data-uri="chapter06.xhtml#P70004970270000000000000000440B6" class="pcalibre1 pcalibre2 pcalibre10">Stride-1 reference patterns are good because caches at all levels of the memory hierarchy store data as contiguous blocks (spatial locality).</p></li>
</ul>
<p id="P70004970270000000000000000440B7" data-uri="chapter06.xhtml#P70004970270000000000000000440B7" class="pcalibre8 pcalibre1 pcalibre2">Spatial locality is especially important in programs that operate on multidimensional arrays. For example, consider the <code id="P70004970270000000000000000440B8" data-uri="chapter06.xhtml#P70004970270000000000000000440B8" class="pcalibre1 calibre1 pcalibre2">sumarrayrows</code> function from <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000005435.xhtml#P7000497027000000000000000005435"><span class="pcalibre1 pcalibre21 pcalibre2">Section </span><span class="pcalibre1 pcalibre21 pcalibre2">6.2</span></a>, which sums the elements of a two-dimensional array in row-major order:</p>
<pre id="P70004970270000000000000000440B9" data-uri="chapter06.xhtml#P70004970270000000000000000440B9" class="calibre2 pcalibre2 pcalibre1"><code id="P70004970270000000000000000440BA" data-uri="chapter06.xhtml#P70004970270000000000000000440BA" class="calibre3 pcalibre1 pcalibre2">
1	int sumarrayrows(int a[M][N])
2	{
3		int i, j, sum = 0;
5		for (i = 0; i &lt; M; i++)
6			for (j = 0; j &lt; N; j++)
7				sum += a[i][j];
8		return sum;
9	}
</code></pre>
<p id="P70004970270000000000000000440BB" data-uri="chapter06.xhtml#P70004970270000000000000000440BB" class="pcalibre8 pcalibre1 pcalibre2">Since C stores arrays in row-major order, the inner loop of this function has the same desirable stride-1 access pattern as <code id="P70004970270000000000000000440BC" data-uri="chapter06.xhtml#P70004970270000000000000000440BC" class="pcalibre1 calibre1 pcalibre2">sumvec</code>. For example, suppose we make the same assumptions about the cache as for <code id="P70004970270000000000000000440BD" data-uri="chapter06.xhtml#P70004970270000000000000000440BD" class="pcalibre1 calibre1 pcalibre2">sumvec</code>. Then the references to the array a will result in the following pattern of hits and misses:</p>
<table class="pcalibre1 informaltable pcalibre2" id="P70004970270000000000000000440BE" data-uri="chapter06.xhtml#P70004970270000000000000000440BE">
<thead class="pcalibre44 pcalibre2 pcalibre1">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<th id="P70004970270000000000000000440BF" data-uri="chapter06.xhtml#P70004970270000000000000000440BF" class="pcalibre1 pcalibre2 calibre5"><code id="P70004970270000000000000000440C0" data-uri="chapter06.xhtml#P70004970270000000000000000440C0" class="calibre3 pcalibre1 pcalibre2">a[i][j]</code></th>
<th id="P70004970270000000000000000440C1" data-uri="chapter06.xhtml#P70004970270000000000000000440C1" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 0</th>
<th id="P70004970270000000000000000440C2" data-uri="chapter06.xhtml#P70004970270000000000000000440C2" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 1</th>
<th id="P70004970270000000000000000440C3" data-uri="chapter06.xhtml#P70004970270000000000000000440C3" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 2</th>
<th id="P70004970270000000000000000440C4" data-uri="chapter06.xhtml#P70004970270000000000000000440C4" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 3</th>
<th id="P70004970270000000000000000440C5" data-uri="chapter06.xhtml#P70004970270000000000000000440C5" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 4</th>
<th id="P70004970270000000000000000440C6" data-uri="chapter06.xhtml#P70004970270000000000000000440C6" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 5</th>
<th id="P70004970270000000000000000440C7" data-uri="chapter06.xhtml#P70004970270000000000000000440C7" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 6</th>
<th id="P70004970270000000000000000440C8" data-uri="chapter06.xhtml#P70004970270000000000000000440C8" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 7</th>
</tr>
</thead>
<tbody class="pcalibre1 pcalibre2 calibre6">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td id="P70004970270000000000000000440C9" data-uri="chapter06.xhtml#P70004970270000000000000000440C9" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 0</td>
<td id="P70004970270000000000000000440CA" data-uri="chapter06.xhtml#P70004970270000000000000000440CA" class="pcalibre1 pcalibre2 calibre7">1 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P70004970270000000000000000440CB" data-uri="chapter06.xhtml#P70004970270000000000000000440CB" class="pcalibre1 pcalibre2 calibre7">2 [h]</td>
<td id="P70004970270000000000000000440CC" data-uri="chapter06.xhtml#P70004970270000000000000000440CC" class="pcalibre1 pcalibre2 calibre7">3 [h]</td>
<td id="P70004970270000000000000000440CD" data-uri="chapter06.xhtml#P70004970270000000000000000440CD" class="pcalibre1 pcalibre2 calibre7">4 [h]</td>
<td id="P70004970270000000000000000440CE" data-uri="chapter06.xhtml#P70004970270000000000000000440CE" class="pcalibre1 pcalibre2 calibre7">5 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P70004970270000000000000000440CF" data-uri="chapter06.xhtml#P70004970270000000000000000440CF" class="pcalibre1 pcalibre2 calibre7">6 [h]</td>
<td id="P70004970270000000000000000440D0" data-uri="chapter06.xhtml#P70004970270000000000000000440D0" class="pcalibre1 pcalibre2 calibre7">7 [h]</td>
<td id="P70004970270000000000000000440D1" data-uri="chapter06.xhtml#P70004970270000000000000000440D1" class="pcalibre1 pcalibre2 calibre7">8 [h]</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td id="P70004970270000000000000000440D2" data-uri="chapter06.xhtml#P70004970270000000000000000440D2" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 1</td>
<td id="P70004970270000000000000000440D3" data-uri="chapter06.xhtml#P70004970270000000000000000440D3" class="pcalibre1 pcalibre2 calibre7">9 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P70004970270000000000000000440D4" data-uri="chapter06.xhtml#P70004970270000000000000000440D4" class="pcalibre1 pcalibre2 calibre7">10 [h]</td>
<td id="P70004970270000000000000000440D5" data-uri="chapter06.xhtml#P70004970270000000000000000440D5" class="pcalibre1 pcalibre2 calibre7">11 [h]</td>
<td id="P70004970270000000000000000440D6" data-uri="chapter06.xhtml#P70004970270000000000000000440D6" class="pcalibre1 pcalibre2 calibre7">12 [h]</td>
<td id="P70004970270000000000000000440D7" data-uri="chapter06.xhtml#P70004970270000000000000000440D7" class="pcalibre1 pcalibre2 calibre7">13 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P70004970270000000000000000440D8" data-uri="chapter06.xhtml#P70004970270000000000000000440D8" class="pcalibre1 pcalibre2 calibre7">14 [h]</td>
<td id="P70004970270000000000000000440D9" data-uri="chapter06.xhtml#P70004970270000000000000000440D9" class="pcalibre1 pcalibre2 calibre7">15 [h]</td>
<td id="P70004970270000000000000000440DA" data-uri="chapter06.xhtml#P70004970270000000000000000440DA" class="pcalibre1 pcalibre2 calibre7">16 [h]</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td id="P70004970270000000000000000440DB" data-uri="chapter06.xhtml#P70004970270000000000000000440DB" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 2</td>
<td id="P70004970270000000000000000440DC" data-uri="chapter06.xhtml#P70004970270000000000000000440DC" class="pcalibre1 pcalibre2 calibre7">17 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P70004970270000000000000000440DD" data-uri="chapter06.xhtml#P70004970270000000000000000440DD" class="pcalibre1 pcalibre2 calibre7">18 [h]</td>
<td id="P70004970270000000000000000440DE" data-uri="chapter06.xhtml#P70004970270000000000000000440DE" class="pcalibre1 pcalibre2 calibre7">19 [h]</td>
<td id="P70004970270000000000000000440DF" data-uri="chapter06.xhtml#P70004970270000000000000000440DF" class="pcalibre1 pcalibre2 calibre7">20 [h]</td>
<td id="P70004970270000000000000000440E0" data-uri="chapter06.xhtml#P70004970270000000000000000440E0" class="pcalibre1 pcalibre2 calibre7">21 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P70004970270000000000000000440E1" data-uri="chapter06.xhtml#P70004970270000000000000000440E1" class="pcalibre1 pcalibre2 calibre7">22 [h]</td>
<td id="P70004970270000000000000000440E2" data-uri="chapter06.xhtml#P70004970270000000000000000440E2" class="pcalibre1 pcalibre2 calibre7">23 [h]</td>
<td id="P70004970270000000000000000440E3" data-uri="chapter06.xhtml#P70004970270000000000000000440E3" class="pcalibre1 pcalibre2 calibre7">24 [h]</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td id="P70004970270000000000000000440E4" data-uri="chapter06.xhtml#P70004970270000000000000000440E4" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 3</td>
<td id="P70004970270000000000000000440E5" data-uri="chapter06.xhtml#P70004970270000000000000000440E5" class="pcalibre1 pcalibre2 calibre7">25 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P70004970270000000000000000440E6" data-uri="chapter06.xhtml#P70004970270000000000000000440E6" class="pcalibre1 pcalibre2 calibre7">26 [h]</td>
<td id="P70004970270000000000000000440E7" data-uri="chapter06.xhtml#P70004970270000000000000000440E7" class="pcalibre1 pcalibre2 calibre7">27 [h]</td>
<td id="P70004970270000000000000000440E8" data-uri="chapter06.xhtml#P70004970270000000000000000440E8" class="pcalibre1 pcalibre2 calibre7">28 [h]</td>
<td id="P70004970270000000000000000440E9" data-uri="chapter06.xhtml#P70004970270000000000000000440E9" class="pcalibre1 pcalibre2 calibre7">29 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P70004970270000000000000000440EA" data-uri="chapter06.xhtml#P70004970270000000000000000440EA" class="pcalibre1 pcalibre2 calibre7">30 [h]</td>
<td id="P70004970270000000000000000440EB" data-uri="chapter06.xhtml#P70004970270000000000000000440EB" class="pcalibre1 pcalibre2 calibre7">31 [h]</td>
<td id="P70004970270000000000000000440EC" data-uri="chapter06.xhtml#P70004970270000000000000000440EC" class="pcalibre1 pcalibre2 calibre7">32 [h]</td>
</tr>
</tbody>
</table>
<p id="P70004970270000000000000000440ED" data-uri="chapter06.xhtml#P70004970270000000000000000440ED" class="pcalibre8 pcalibre1 pcalibre2"><span class="pcalibre1 pcalibre2 pcalibre5" id="P700049702700000000000000000598D" title="636" data-uri="chapter06.xhtml#P700049702700000000000000000598D" epub:type="pagebreak"></span>But consider what happens if we make the seemingly innocuous change of permuting the loops:</p>
<pre id="P70004970270000000000000000440EE" data-uri="chapter06.xhtml#P70004970270000000000000000440EE" class="calibre2 pcalibre2 pcalibre1"><code id="P70004970270000000000000000440EF" data-uri="chapter06.xhtml#P70004970270000000000000000440EF" class="calibre3 pcalibre1 pcalibre2">
1	int sumarraycols(int a[M][N])
2	{
3		int i, j, sum = 0;
4
5		for (j = 0; j &lt; N; j++)
6			for (i = 0; i &lt; M; i++)
7				sum += a[i][j];
8		return sum;
9	}
</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" id="P70004970270000000000000000440F0" data-uri="chapter06.xhtml#P70004970270000000000000000440F0">In this case, we are scanning the array column by column instead of row by row. If we are lucky and the entire array fits in the cache, then we will enjoy the same miss rate of 1/4. However, if the array is larger than the cache (the more likely case), then each and every access of <code id="P70004970270000000000000000440F1" data-uri="chapter06.xhtml#P70004970270000000000000000440F1" class="pcalibre1 calibre1 pcalibre2">a[i][j]</code> will miss!</p>
<table class="pcalibre1 informaltable pcalibre2" id="P70004970270000000000000000440F2" data-uri="chapter06.xhtml#P70004970270000000000000000440F2">
<thead class="pcalibre44 pcalibre2 pcalibre1">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<th id="P70004970270000000000000000440F3" data-uri="chapter06.xhtml#P70004970270000000000000000440F3" class="pcalibre1 pcalibre2 calibre5"><code id="P70004970270000000000000000440F4" data-uri="chapter06.xhtml#P70004970270000000000000000440F4" class="calibre3 pcalibre1 pcalibre2">a[i][j]</code></th>
<th id="P70004970270000000000000000440F5" data-uri="chapter06.xhtml#P70004970270000000000000000440F5" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 0</th>
<th id="P70004970270000000000000000440F6" data-uri="chapter06.xhtml#P70004970270000000000000000440F6" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 1</th>
<th id="P70004970270000000000000000440F7" data-uri="chapter06.xhtml#P70004970270000000000000000440F7" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 2</th>
<th id="P70004970270000000000000000440F8" data-uri="chapter06.xhtml#P70004970270000000000000000440F8" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 3</th>
<th id="P70004970270000000000000000440F9" data-uri="chapter06.xhtml#P70004970270000000000000000440F9" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 4</th>
<th id="P70004970270000000000000000440FA" data-uri="chapter06.xhtml#P70004970270000000000000000440FA" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 5</th>
<th id="P70004970270000000000000000440FB" data-uri="chapter06.xhtml#P70004970270000000000000000440FB" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 6</th>
<th id="P70004970270000000000000000440FC" data-uri="chapter06.xhtml#P70004970270000000000000000440FC" class="pcalibre1 pcalibre2 calibre5"><var class="pcalibre17 pcalibre2 pcalibre1">j</var> = 7</th>
</tr>
</thead>
<tbody class="pcalibre1 pcalibre2 calibre6">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td id="P70004970270000000000000000440FD" data-uri="chapter06.xhtml#P70004970270000000000000000440FD" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 0</td>
<td id="P70004970270000000000000000440FE" data-uri="chapter06.xhtml#P70004970270000000000000000440FE" class="pcalibre1 pcalibre2 calibre7">1 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P70004970270000000000000000440FF" data-uri="chapter06.xhtml#P70004970270000000000000000440FF" class="pcalibre1 pcalibre2 calibre7">5 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044100" data-uri="chapter06.xhtml#P7000497027000000000000000044100" class="pcalibre1 pcalibre2 calibre7">9 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044101" data-uri="chapter06.xhtml#P7000497027000000000000000044101" class="pcalibre1 pcalibre2 calibre7">13 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044102" data-uri="chapter06.xhtml#P7000497027000000000000000044102" class="pcalibre1 pcalibre2 calibre7">17 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044103" data-uri="chapter06.xhtml#P7000497027000000000000000044103" class="pcalibre1 pcalibre2 calibre7">21 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044104" data-uri="chapter06.xhtml#P7000497027000000000000000044104" class="pcalibre1 pcalibre2 calibre7">25 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044105" data-uri="chapter06.xhtml#P7000497027000000000000000044105" class="pcalibre1 pcalibre2 calibre7">29 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td id="P7000497027000000000000000044106" data-uri="chapter06.xhtml#P7000497027000000000000000044106" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 1</td>
<td id="P7000497027000000000000000044107" data-uri="chapter06.xhtml#P7000497027000000000000000044107" class="pcalibre1 pcalibre2 calibre7">2 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044108" data-uri="chapter06.xhtml#P7000497027000000000000000044108" class="pcalibre1 pcalibre2 calibre7">6 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044109" data-uri="chapter06.xhtml#P7000497027000000000000000044109" class="pcalibre1 pcalibre2 calibre7">10 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P700049702700000000000000004410A" data-uri="chapter06.xhtml#P700049702700000000000000004410A" class="pcalibre1 pcalibre2 calibre7">14 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P700049702700000000000000004410B" data-uri="chapter06.xhtml#P700049702700000000000000004410B" class="pcalibre1 pcalibre2 calibre7">18 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P700049702700000000000000004410C" data-uri="chapter06.xhtml#P700049702700000000000000004410C" class="pcalibre1 pcalibre2 calibre7">22 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P700049702700000000000000004410D" data-uri="chapter06.xhtml#P700049702700000000000000004410D" class="pcalibre1 pcalibre2 calibre7">26 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P700049702700000000000000004410E" data-uri="chapter06.xhtml#P700049702700000000000000004410E" class="pcalibre1 pcalibre2 calibre7">30 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td id="P700049702700000000000000004410F" data-uri="chapter06.xhtml#P700049702700000000000000004410F" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 2</td>
<td id="P7000497027000000000000000044110" data-uri="chapter06.xhtml#P7000497027000000000000000044110" class="pcalibre1 pcalibre2 calibre7">3 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044111" data-uri="chapter06.xhtml#P7000497027000000000000000044111" class="pcalibre1 pcalibre2 calibre7">7 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044112" data-uri="chapter06.xhtml#P7000497027000000000000000044112" class="pcalibre1 pcalibre2 calibre7">11 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044113" data-uri="chapter06.xhtml#P7000497027000000000000000044113" class="pcalibre1 pcalibre2 calibre7">15 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044114" data-uri="chapter06.xhtml#P7000497027000000000000000044114" class="pcalibre1 pcalibre2 calibre7">19 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044115" data-uri="chapter06.xhtml#P7000497027000000000000000044115" class="pcalibre1 pcalibre2 calibre7">23 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044116" data-uri="chapter06.xhtml#P7000497027000000000000000044116" class="pcalibre1 pcalibre2 calibre7">27 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044117" data-uri="chapter06.xhtml#P7000497027000000000000000044117" class="pcalibre1 pcalibre2 calibre7">31 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td id="P7000497027000000000000000044118" data-uri="chapter06.xhtml#P7000497027000000000000000044118" class="pcalibre1 pcalibre2 calibre7"><var class="pcalibre17 pcalibre2 pcalibre1">i</var> = 3</td>
<td id="P7000497027000000000000000044119" data-uri="chapter06.xhtml#P7000497027000000000000000044119" class="pcalibre1 pcalibre2 calibre7">4 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P700049702700000000000000004411A" data-uri="chapter06.xhtml#P700049702700000000000000004411A" class="pcalibre1 pcalibre2 calibre7">8 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P700049702700000000000000004411B" data-uri="chapter06.xhtml#P700049702700000000000000004411B" class="pcalibre1 pcalibre2 calibre7">12 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P700049702700000000000000004411C" data-uri="chapter06.xhtml#P700049702700000000000000004411C" class="pcalibre1 pcalibre2 calibre7">16 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P700049702700000000000000004411D" data-uri="chapter06.xhtml#P700049702700000000000000004411D" class="pcalibre1 pcalibre2 calibre7">20 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P700049702700000000000000004411E" data-uri="chapter06.xhtml#P700049702700000000000000004411E" class="pcalibre1 pcalibre2 calibre7">24 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P700049702700000000000000004411F" data-uri="chapter06.xhtml#P700049702700000000000000004411F" class="pcalibre1 pcalibre2 calibre7">28 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
<td id="P7000497027000000000000000044120" data-uri="chapter06.xhtml#P7000497027000000000000000044120" class="pcalibre1 pcalibre2 calibre7">32 <b class="pcalibre1 pcalibre2 pcalibre12">[m]</b></td>
</tr>
</tbody>
</table>
<p id="P7000497027000000000000000044121" data-uri="chapter06.xhtml#P7000497027000000000000000044121" class="pcalibre8 pcalibre1 pcalibre2">Higher miss rates can have a significant impact on running time. For example, on our desktop machine, <code id="P7000497027000000000000000044122" data-uri="chapter06.xhtml#P7000497027000000000000000044122" class="pcalibre1 calibre1 pcalibre2">sumarrayrows</code> runs 25 times faster than <code id="P7000497027000000000000000044123" data-uri="chapter06.xhtml#P7000497027000000000000000044123" class="pcalibre1 calibre1 pcalibre2">sumarraycols</code> for large array sizes. To summarize, programmers should be aware of locality in their programs and try to write programs that exploit it.</p>
<section id="P70004970270000000000000000059C4" data-uri="chapter06.xhtml#P70004970270000000000000000059C4" epub:type="practice" class="pcalibre1 pcalibre2 pcalibre3"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" id="P7000497027000000000000000044124" data-uri="chapter06.xhtml#P7000497027000000000000000044124" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">Practice Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">6.17 </span>(solution page <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" epub:type="pagebreak" href="fileP7000497027000000000000000005E52.xhtml#P7000497027000000000000000005F33">665</a>)</h1></header>
<ol class="pcalibre1 pcalibre2 pcalibre77" id="P7000497027000000000000000044125" data-uri="chapter06.xhtml#P7000497027000000000000000044125">
<li class="pcalibre1 pcalibre2 pcalibre78" id="P7000497027000000000000000044126" data-uri="chapter06.xhtml#P7000497027000000000000000044126">
<div class="pcalibre1 pcalibre2 pcalibre7" id="P7000497027000000000000000044127" data-uri="chapter06.xhtml#P7000497027000000000000000044127"><p id="P7000497027000000000000000044128" data-uri="chapter06.xhtml#P7000497027000000000000000044128" class="pcalibre1 pcalibre2 pcalibre10">Transposing the rows and columns of a matrix is an important problem in signal processing and scientific computing applications. It is also interesting from a locality point of view because its reference pattern is both row-wise and column-wise. For example, consider the following transpose routine:</p>
<pre id="P7000497027000000000000000044129" data-uri="chapter06.xhtml#P7000497027000000000000000044129" class="calibre2 pcalibre2 pcalibre1"><code id="P700049702700000000000000004412A" data-uri="chapter06.xhtml#P700049702700000000000000004412A" class="calibre3 pcalibre1 pcalibre2">
1	typedef int array[2][2];
2
3	void transpose1(array dst, array src)
4	{
5		int i, j;
6
7		for (i = 0; i &lt; 2; i++) {
8			for (j = 0; j &lt; 2; j++) {
9				dst[j][i] = src[i][j];
10			}
11		}
12	}
</code></pre>
<p id="P700049702700000000000000004412B" data-uri="chapter06.xhtml#P700049702700000000000000004412B" class="pcalibre1 pcalibre2 pcalibre10"><span class="pcalibre1 pcalibre2 pcalibre5" id="P70004970270000000000000000059CD" title="637" data-uri="chapter06.xhtml#P70004970270000000000000000059CD" epub:type="pagebreak"></span>Assume this code runs on a machine with the following properties:</p>
<ul id="P700049702700000000000000004412C" data-uri="chapter06.xhtml#P700049702700000000000000004412C" class="pcalibre1 pcalibre2 pcalibre117">
<li id="P700049702700000000000000004412D" data-uri="chapter06.xhtml#P700049702700000000000000004412D" class="pcalibre39 pcalibre2 pcalibre1"><p id="P700049702700000000000000004412E" data-uri="chapter06.xhtml#P700049702700000000000000004412E" class="pcalibre1 pcalibre2 pcalibre10"><code id="P700049702700000000000000004412F" data-uri="chapter06.xhtml#P700049702700000000000000004412F" class="pcalibre1 calibre1 pcalibre2">sizeof(int)</code> = 4.</p></li>
<li id="P7000497027000000000000000044130" data-uri="chapter06.xhtml#P7000497027000000000000000044130" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044131" data-uri="chapter06.xhtml#P7000497027000000000000000044131" class="pcalibre1 pcalibre2 pcalibre10">The <code id="P7000497027000000000000000044132" data-uri="chapter06.xhtml#P7000497027000000000000000044132" class="pcalibre1 calibre1 pcalibre2">src</code> array starts at address 0 and the <code id="P7000497027000000000000000044133" data-uri="chapter06.xhtml#P7000497027000000000000000044133" class="pcalibre1 calibre1 pcalibre2">dst</code> array starts at address 16 (decimal).</p></li>
<li id="P7000497027000000000000000044134" data-uri="chapter06.xhtml#P7000497027000000000000000044134" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044135" data-uri="chapter06.xhtml#P7000497027000000000000000044135" class="pcalibre1 pcalibre2 pcalibre10">There is a single L1 data cache that is direct-mapped, write-through, and write-allocate, with a block size of 8 bytes.</p></li>
<li id="P7000497027000000000000000044136" data-uri="chapter06.xhtml#P7000497027000000000000000044136" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044137" data-uri="chapter06.xhtml#P7000497027000000000000000044137" class="pcalibre1 pcalibre2 pcalibre10">The cache has a total size of 16 data bytes and the cache is initially empty.</p></li>
<li id="P7000497027000000000000000044138" data-uri="chapter06.xhtml#P7000497027000000000000000044138" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044139" data-uri="chapter06.xhtml#P7000497027000000000000000044139" class="pcalibre1 pcalibre2 pcalibre10">Accesses to the <code id="P700049702700000000000000004413A" data-uri="chapter06.xhtml#P700049702700000000000000004413A" class="pcalibre1 calibre1 pcalibre2">src</code> and <code id="P700049702700000000000000004413B" data-uri="chapter06.xhtml#P700049702700000000000000004413B" class="pcalibre1 calibre1 pcalibre2">dst</code> arrays are the only sources of read and write misses, respectively.</p></li>
</ul>
<ol class="pcalibre1 pcalibre2 pcalibre79" id="P700049702700000000000000004413C" data-uri="chapter06.xhtml#P700049702700000000000000004413C">
<li id="P700049702700000000000000004413D" data-uri="chapter06.xhtml#P700049702700000000000000004413D" class="pcalibre39 pcalibre2 pcalibre1"><p id="P700049702700000000000000004413E" data-uri="chapter06.xhtml#P700049702700000000000000004413E" class="pcalibre1 pcalibre2 pcalibre10">For each <code id="P700049702700000000000000004413F" data-uri="chapter06.xhtml#P700049702700000000000000004413F" class="pcalibre1 calibre1 pcalibre2">row</code> and <code id="P7000497027000000000000000044140" data-uri="chapter06.xhtml#P7000497027000000000000000044140" class="pcalibre1 calibre1 pcalibre2">col</code>, indicate whether the access to <code id="P7000497027000000000000000044141" data-uri="chapter06.xhtml#P7000497027000000000000000044141" class="pcalibre1 calibre1 pcalibre2">src[row][col]</code> and <code id="P7000497027000000000000000044142" data-uri="chapter06.xhtml#P7000497027000000000000000044142" class="pcalibre1 calibre1 pcalibre2">dst[row][col]</code> is a hit (h) or a miss (m). For example, reading <code id="P7000497027000000000000000044143" data-uri="chapter06.xhtml#P7000497027000000000000000044143" class="pcalibre1 calibre1 pcalibre2">src[0][0]</code> is a miss and writing <code id="P7000497027000000000000000044144" data-uri="chapter06.xhtml#P7000497027000000000000000044144" class="pcalibre1 calibre1 pcalibre2">dst[0][0]</code> is also a miss.</p>
<table id="P7000497027000000000000000044145" data-uri="chapter06.xhtml#P7000497027000000000000000044145" class="pcalibre1 pcalibre2 pcalibre43">
<thead class="pcalibre44 pcalibre2 pcalibre1">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<th colspan="3" id="P7000497027000000000000000044146" data-uri="chapter06.xhtml#P7000497027000000000000000044146" class="pcalibre1 pcalibre2 calibre5"><code id="P7000497027000000000000000044147" data-uri="chapter06.xhtml#P7000497027000000000000000044147" class="calibre3 pcalibre1 pcalibre2">dst array</code></th>
<th colspan="3" id="P7000497027000000000000000044148" data-uri="chapter06.xhtml#P7000497027000000000000000044148" class="pcalibre1 pcalibre2 calibre5"><code id="P7000497027000000000000000044149" data-uri="chapter06.xhtml#P7000497027000000000000000044149" class="calibre3 pcalibre1 pcalibre2">src array</code></th>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<th id="P700049702700000000000000004414A" data-uri="chapter06.xhtml#P700049702700000000000000004414A" class="pcalibre1 pcalibre2 calibre5"/>
<th id="P700049702700000000000000004414B" data-uri="chapter06.xhtml#P700049702700000000000000004414B" class="pcalibre1 pcalibre2 calibre5">Col. 0</th>
<th id="P700049702700000000000000004414C" data-uri="chapter06.xhtml#P700049702700000000000000004414C" class="pcalibre1 pcalibre2 calibre5">Col. 1</th>
<th id="P700049702700000000000000004414D" data-uri="chapter06.xhtml#P700049702700000000000000004414D" class="pcalibre1 pcalibre2 calibre5"/>
<th id="P700049702700000000000000004414E" data-uri="chapter06.xhtml#P700049702700000000000000004414E" class="pcalibre1 pcalibre2 calibre5">Col. 0</th>
<th id="P700049702700000000000000004414F" data-uri="chapter06.xhtml#P700049702700000000000000004414F" class="pcalibre1 pcalibre2 calibre5">Col. 1</th>
</tr>
</thead>
<tbody class="pcalibre1 pcalibre2 calibre6">
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td id="P7000497027000000000000000044150" data-uri="chapter06.xhtml#P7000497027000000000000000044150" class="pcalibre1 pcalibre2 calibre7">Row 0</td>
<td id="P7000497027000000000000000044151" data-uri="chapter06.xhtml#P7000497027000000000000000044151" class="pcalibre1 pcalibre2 calibre7">m</td>
<td id="P7000497027000000000000000044152" data-uri="chapter06.xhtml#P7000497027000000000000000044152" class="pcalibre1 pcalibre2 calibre7">_____</td>
<td id="P7000497027000000000000000044153" data-uri="chapter06.xhtml#P7000497027000000000000000044153" class="pcalibre1 pcalibre2 calibre7">Row0</td>
<td id="P7000497027000000000000000044154" data-uri="chapter06.xhtml#P7000497027000000000000000044154" class="pcalibre1 pcalibre2 calibre7">m</td>
<td id="P7000497027000000000000000044155" data-uri="chapter06.xhtml#P7000497027000000000000000044155" class="pcalibre1 pcalibre2 calibre7">_____</td>
</tr>
<tr class="pcalibre45 pcalibre1 pcalibre2">
<td id="P7000497027000000000000000044156" data-uri="chapter06.xhtml#P7000497027000000000000000044156" class="pcalibre1 pcalibre2 calibre7">Row 1</td>
<td id="P7000497027000000000000000044157" data-uri="chapter06.xhtml#P7000497027000000000000000044157" class="pcalibre1 pcalibre2 calibre7">_____</td>
<td id="P7000497027000000000000000044158" data-uri="chapter06.xhtml#P7000497027000000000000000044158" class="pcalibre1 pcalibre2 calibre7">_____</td>
<td id="P7000497027000000000000000044159" data-uri="chapter06.xhtml#P7000497027000000000000000044159" class="pcalibre1 pcalibre2 calibre7">Row 1</td>
<td id="P700049702700000000000000004415A" data-uri="chapter06.xhtml#P700049702700000000000000004415A" class="pcalibre1 pcalibre2 calibre7">_____</td>
<td id="P700049702700000000000000004415B" data-uri="chapter06.xhtml#P700049702700000000000000004415B" class="pcalibre1 pcalibre2 calibre7">_____</td>
</tr>
</tbody>
</table></li>
<li id="P700049702700000000000000004415C" data-uri="chapter06.xhtml#P700049702700000000000000004415C" class="pcalibre39 pcalibre2 pcalibre1"><p id="P700049702700000000000000004415D" data-uri="chapter06.xhtml#P700049702700000000000000004415D" class="pcalibre1 pcalibre2 pcalibre10">Repeat the problem for a cache with 32 data bytes.</p></li>
</ol></div></li>
</ol>
</section>
<section id="P7000497027000000000000000005A00" data-uri="chapter06.xhtml#P7000497027000000000000000005A00" epub:type="practice" class="pcalibre1 pcalibre2 pcalibre3"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" id="P700049702700000000000000004415E" data-uri="chapter06.xhtml#P700049702700000000000000004415E" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">Practice Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">6.18 </span>(solution page <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" epub:type="pagebreak" href="fileP7000497027000000000000000005E52.xhtml#P7000497027000000000000000005F85">666</a>)</h1></header>
<ol class="pcalibre1 pcalibre2 pcalibre77" id="P700049702700000000000000004415F" data-uri="chapter06.xhtml#P700049702700000000000000004415F">
<li class="pcalibre1 pcalibre2 pcalibre78" id="P7000497027000000000000000044160" data-uri="chapter06.xhtml#P7000497027000000000000000044160">
<div class="pcalibre1 pcalibre2 pcalibre7" id="P7000497027000000000000000044161" data-uri="chapter06.xhtml#P7000497027000000000000000044161"><p id="P7000497027000000000000000044162" data-uri="chapter06.xhtml#P7000497027000000000000000044162" class="pcalibre1 pcalibre2 pcalibre10">The heart of the recent hit game <i class="pcalibre17 pcalibre2 pcalibre1">SimAquarium</i> is a tight loop that calculates the average position of 256 algae. You are evaluating its cache performance on a machine with a 1,024-byte direct-mapped data cache with 16-byte blocks (<var class="pcalibre17 pcalibre2 pcalibre1">B</var> = 16). You are given the following definitions:</p>
<pre id="P7000497027000000000000000044163" data-uri="chapter06.xhtml#P7000497027000000000000000044163" class="calibre2 pcalibre2 pcalibre1"><code id="P7000497027000000000000000044164" data-uri="chapter06.xhtml#P7000497027000000000000000044164" class="calibre3 pcalibre1 pcalibre2">
1	struct algae_position {
2		int x;
3		int y;
4	};
5
6	struct algae_position grid[16][16];
7	int total_x = 0, total_y = 0;
8	int i, j;
</code></pre>
<p id="P7000497027000000000000000044165" data-uri="chapter06.xhtml#P7000497027000000000000000044165" class="pcalibre1 pcalibre2 pcalibre10">You should also assume the following:</p>
<ul id="P7000497027000000000000000044166" data-uri="chapter06.xhtml#P7000497027000000000000000044166" class="pcalibre1 pcalibre2 pcalibre117">
<li id="P7000497027000000000000000044167" data-uri="chapter06.xhtml#P7000497027000000000000000044167" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044168" data-uri="chapter06.xhtml#P7000497027000000000000000044168" class="pcalibre1 pcalibre2 pcalibre10"><code id="P7000497027000000000000000044169" data-uri="chapter06.xhtml#P7000497027000000000000000044169" class="pcalibre1 calibre1 pcalibre2">sizeof(int)</code> = 4.</p></li>
<li id="P700049702700000000000000004416A" data-uri="chapter06.xhtml#P700049702700000000000000004416A" class="pcalibre39 pcalibre2 pcalibre1"><p id="P700049702700000000000000004416B" data-uri="chapter06.xhtml#P700049702700000000000000004416B" class="pcalibre1 pcalibre2 pcalibre10"><code id="P700049702700000000000000004416C" data-uri="chapter06.xhtml#P700049702700000000000000004416C" class="pcalibre1 calibre1 pcalibre2">grid</code> begins at memory address 0.</p></li>
<li id="P700049702700000000000000004416D" data-uri="chapter06.xhtml#P700049702700000000000000004416D" class="pcalibre39 pcalibre2 pcalibre1"><p id="P700049702700000000000000004416E" data-uri="chapter06.xhtml#P700049702700000000000000004416E" class="pcalibre1 pcalibre2 pcalibre10">The cache is initially empty.</p></li>
<li id="P700049702700000000000000004416F" data-uri="chapter06.xhtml#P700049702700000000000000004416F" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044170" data-uri="chapter06.xhtml#P7000497027000000000000000044170" class="pcalibre1 pcalibre2 pcalibre10">The only memory accesses are to the entries of the array <code id="P7000497027000000000000000044171" data-uri="chapter06.xhtml#P7000497027000000000000000044171" class="pcalibre1 calibre1 pcalibre2">grid.</code> Variables <code id="P7000497027000000000000000044172" data-uri="chapter06.xhtml#P7000497027000000000000000044172" class="pcalibre1 calibre1 pcalibre2">i, j, total_x</code>, and <code id="P7000497027000000000000000044173" data-uri="chapter06.xhtml#P7000497027000000000000000044173" class="pcalibre1 calibre1 pcalibre2">total_y</code> are stored in registers.</p></li>
</ul>
<p id="P7000497027000000000000000044174" data-uri="chapter06.xhtml#P7000497027000000000000000044174" class="pcalibre1 pcalibre2 pcalibre10"><span class="pcalibre1 pcalibre2 pcalibre5" id="P7000497027000000000000000005A18" title="638" data-uri="chapter06.xhtml#P7000497027000000000000000005A18" epub:type="pagebreak"></span>Determine the cache performance for the following code:</p>
<pre id="P7000497027000000000000000044175" data-uri="chapter06.xhtml#P7000497027000000000000000044175" class="calibre2 pcalibre2 pcalibre1"><code id="P7000497027000000000000000044176" data-uri="chapter06.xhtml#P7000497027000000000000000044176" class="calibre3 pcalibre1 pcalibre2">
1	for (i = 0; i &lt; 16; i++) {
2		for (j = 0; j &lt; 16; j++) {
3			total_x += grid[i][j].x;
4		}
5	}
6
7	for (i = 0; i &lt; 16; i++) {
8		for (j = 0; j &lt; 16; j++) {
9			total_y += grid[i][j].y;
10		}
11	}
</code></pre>
<ol class="pcalibre1 pcalibre2 pcalibre79" id="P7000497027000000000000000044177" data-uri="chapter06.xhtml#P7000497027000000000000000044177">
<li id="P7000497027000000000000000044178" data-uri="chapter06.xhtml#P7000497027000000000000000044178" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044179" data-uri="chapter06.xhtml#P7000497027000000000000000044179" class="pcalibre1 pcalibre2 pcalibre10">What is the total number of reads?</p></li>
<li id="P700049702700000000000000004417A" data-uri="chapter06.xhtml#P700049702700000000000000004417A" class="pcalibre39 pcalibre2 pcalibre1"><p id="P700049702700000000000000004417B" data-uri="chapter06.xhtml#P700049702700000000000000004417B" class="pcalibre1 pcalibre2 pcalibre10">What is the total number of reads that miss in the cache?</p></li>
<li id="P700049702700000000000000004417C" data-uri="chapter06.xhtml#P700049702700000000000000004417C" class="pcalibre39 pcalibre2 pcalibre1"><p id="P700049702700000000000000004417D" data-uri="chapter06.xhtml#P700049702700000000000000004417D" class="pcalibre1 pcalibre2 pcalibre10">What is the miss rate?</p></li>
</ol></div></li>
</ol>
</section>
<section id="P7000497027000000000000000005A22" data-uri="chapter06.xhtml#P7000497027000000000000000005A22" epub:type="practice" class="pcalibre1 pcalibre2 pcalibre3"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" id="P700049702700000000000000004417E" data-uri="chapter06.xhtml#P700049702700000000000000004417E" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">Practice Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">6.19 </span>(solution page <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" epub:type="pagebreak" href="fileP7000497027000000000000000005E52.xhtml#P7000497027000000000000000005F85">666</a>)</h1></header>
<ol class="pcalibre1 pcalibre2 pcalibre77" id="P700049702700000000000000004417F" data-uri="chapter06.xhtml#P700049702700000000000000004417F">
<li class="pcalibre1 pcalibre2 pcalibre78" id="P7000497027000000000000000044180" data-uri="chapter06.xhtml#P7000497027000000000000000044180">
<div class="pcalibre1 pcalibre2 pcalibre7" id="P7000497027000000000000000044181" data-uri="chapter06.xhtml#P7000497027000000000000000044181"><p id="P7000497027000000000000000044182" data-uri="chapter06.xhtml#P7000497027000000000000000044182" class="pcalibre1 pcalibre2 pcalibre10">Given the assumptions of <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000005A00"><span class="pcalibre1 pcalibre21 pcalibre2">Practice Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">6.18</span></a>, determine the cache performance of the following code:</p>
<pre id="P7000497027000000000000000044183" data-uri="chapter06.xhtml#P7000497027000000000000000044183" class="calibre2 pcalibre2 pcalibre1"><code id="P7000497027000000000000000044184" data-uri="chapter06.xhtml#P7000497027000000000000000044184" class="calibre3 pcalibre1 pcalibre2">
1	for (i = 0; i &lt; 16; i++){
2		for (j = 0; j &lt; 16; j++) {
3			total_x += grid[j][i].x;
4			total_y += grid[j][i].y;
5		}
6	}
</code></pre>
<ol class="pcalibre1 pcalibre2 pcalibre79" id="P7000497027000000000000000044185" data-uri="chapter06.xhtml#P7000497027000000000000000044185">
<li id="P7000497027000000000000000044186" data-uri="chapter06.xhtml#P7000497027000000000000000044186" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044187" data-uri="chapter06.xhtml#P7000497027000000000000000044187" class="pcalibre1 pcalibre2 pcalibre10">What is the total number of reads?</p></li>
<li id="P7000497027000000000000000044188" data-uri="chapter06.xhtml#P7000497027000000000000000044188" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044189" data-uri="chapter06.xhtml#P7000497027000000000000000044189" class="pcalibre1 pcalibre2 pcalibre10">What is the total number of reads that miss in the cache?</p></li>
<li id="P700049702700000000000000004418A" data-uri="chapter06.xhtml#P700049702700000000000000004418A" class="pcalibre39 pcalibre2 pcalibre1"><p id="P700049702700000000000000004418B" data-uri="chapter06.xhtml#P700049702700000000000000004418B" class="pcalibre1 pcalibre2 pcalibre10">What is the miss rate?</p></li>
<li id="P700049702700000000000000004418C" data-uri="chapter06.xhtml#P700049702700000000000000004418C" class="pcalibre39 pcalibre2 pcalibre1"><p id="P700049702700000000000000004418D" data-uri="chapter06.xhtml#P700049702700000000000000004418D" class="pcalibre1 pcalibre2 pcalibre10">What would the miss rate be if the cache were twice as big?</p></li>
</ol></div></li>
</ol>
</section>
<section id="P7000497027000000000000000005A33" data-uri="chapter06.xhtml#P7000497027000000000000000005A33" epub:type="practice" class="pcalibre1 pcalibre2 pcalibre3"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre30 pcalibre1 pcalibre2" id="P700049702700000000000000004418E" data-uri="chapter06.xhtml#P700049702700000000000000004418E" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">Practice Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">6.20 </span>(solution page <a class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13" epub:type="pagebreak" href="fileP7000497027000000000000000005E52.xhtml#P7000497027000000000000000005F85">666</a>)</h1></header>
<ol class="pcalibre1 pcalibre2 pcalibre77" id="P700049702700000000000000004418F" data-uri="chapter06.xhtml#P700049702700000000000000004418F">
<li class="pcalibre1 pcalibre2 pcalibre78" id="P7000497027000000000000000044190" data-uri="chapter06.xhtml#P7000497027000000000000000044190">
<div class="pcalibre1 pcalibre2 pcalibre7" id="P7000497027000000000000000044191" data-uri="chapter06.xhtml#P7000497027000000000000000044191"><p id="P7000497027000000000000000044192" data-uri="chapter06.xhtml#P7000497027000000000000000044192" class="pcalibre1 pcalibre2 pcalibre10">Given the assumptions of <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000005A00"><span class="pcalibre1 pcalibre21 pcalibre2">Practice Problem </span><span class="pcalibre1 pcalibre21 pcalibre2">6.18</span></a>, determine the cache performance of the following code:</p>
<pre id="P7000497027000000000000000044193" data-uri="chapter06.xhtml#P7000497027000000000000000044193" class="calibre2 pcalibre2 pcalibre1"><code id="P7000497027000000000000000044194" data-uri="chapter06.xhtml#P7000497027000000000000000044194" class="calibre3 pcalibre1 pcalibre2">
1	for (i = 0; i &lt; 16; i++){
2		for (j = 0; j &lt; 16; j++) {
3			total_x += grid[i][j].x;
4			total_y += grid[i][j].y;
5		}
6	}
</code></pre>
<ol class="pcalibre1 pcalibre2 pcalibre79" id="P7000497027000000000000000044195" data-uri="chapter06.xhtml#P7000497027000000000000000044195">
<li id="P7000497027000000000000000044196" data-uri="chapter06.xhtml#P7000497027000000000000000044196" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044197" data-uri="chapter06.xhtml#P7000497027000000000000000044197" class="pcalibre1 pcalibre2 pcalibre10"><span class="pcalibre1 pcalibre2 pcalibre5" id="P7000497027000000000000000005A3E" title="639" data-uri="chapter06.xhtml#P7000497027000000000000000005A3E" epub:type="pagebreak"></span>What is the total number of reads?</p></li>
<li id="P7000497027000000000000000044198" data-uri="chapter06.xhtml#P7000497027000000000000000044198" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000044199" data-uri="chapter06.xhtml#P7000497027000000000000000044199" class="pcalibre1 pcalibre2 pcalibre10">What is the total number of reads that miss in the cache?</p></li>
<li id="P700049702700000000000000004419A" data-uri="chapter06.xhtml#P700049702700000000000000004419A" class="pcalibre39 pcalibre2 pcalibre1"><p id="P700049702700000000000000004419B" data-uri="chapter06.xhtml#P700049702700000000000000004419B" class="pcalibre1 pcalibre2 pcalibre10">What is the miss rate?</p></li>
<li id="P700049702700000000000000004419C" data-uri="chapter06.xhtml#P700049702700000000000000004419C" class="pcalibre39 pcalibre2 pcalibre1"><p id="P700049702700000000000000004419D" data-uri="chapter06.xhtml#P700049702700000000000000004419D" class="pcalibre1 pcalibre2 pcalibre10">What would the miss rate be if the cache were twice as big?</p></li>
</ol></div></li>
</ol>
</section>
</section></body></html>
