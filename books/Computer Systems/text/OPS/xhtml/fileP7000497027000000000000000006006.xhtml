<?xml version='1.0' encoding='utf-8'?>
<html xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg" xmlns:epub="http://www.idpf.org/2007/ops" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" epub:prefix="index: http://www.index.com/">
  <head>
    <meta name="dcterms.conformsTo" content="PXE Basic 1.0"/>
    <meta name="generator" content="PXE Tools version 1.39.52"/>
    <!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
    <title>7.1 Compiler Drivers</title>
    <link rel="alternate stylesheet" type="text/css" title="night" href="../css/theme/night.css"/>
    <link rel="alternate stylesheet" type="text/css" title="sepia" href="../css/theme/sepia.css"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body epub:type="bodymatter" class="pcalibre1 pcalibre2 pcalibre">
<section id="P7000497027000000000000000006006" class="pcalibre1 pcalibre2 pcalibre3"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre2 pcalibre4" id="P700049702700000000000000004478D" data-uri="chapter07.xhtml#P700049702700000000000000004478D" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">7.1 </span>Compiler Drivers</h1></header>
<p id="P700049702700000000000000004478E" data-uri="chapter07.xhtml#P700049702700000000000000004478E" class="pcalibre8 pcalibre1 pcalibre2">Consider the C program in <a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="fileP7000497027000000000000000005FB4.xhtml#P7000497027000000000000000005FF0"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">7.1</span></a>. It will serve as a simple running example throughout this chapter that will allow us to make some important points about how linkers work.</p>
<p id="P700049702700000000000000004478F" data-uri="chapter07.xhtml#P700049702700000000000000004478F" class="pcalibre8 pcalibre1 pcalibre2">Most compilation systems provide a <i class="pcalibre17 pcalibre2 pcalibre1">compiler driver</i> that invokes the language preprocessor, compiler, assembler, and linker, as needed on behalf of the user. For example, to build the example program using the GNU compilation system, we might invoke the <span class="pcalibre1 pcalibre29 pcalibre2">gcc </span>driver by typing the following command to the shell:</p>
<pre id="P7000497027000000000000000044790" data-uri="chapter07.xhtml#P7000497027000000000000000044790" class="calibre2 pcalibre2 pcalibre1"><code id="P7000497027000000000000000044791" data-uri="chapter07.xhtml#P7000497027000000000000000044791" class="calibre3 pcalibre1 pcalibre2">linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">gcc -Og -o prog main.c sum.c</i></code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" id="P7000497027000000000000000044792" data-uri="chapter07.xhtml#P7000497027000000000000000044792"><a class="pcalibre15 pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre28" href="#P7000497027000000000000000006011"><span class="pcalibre1 pcalibre21 pcalibre2">Figure </span><span class="pcalibre1 pcalibre21 pcalibre2">7.2</span></a> summarizes the activities of the driver as it translates the example program from an ASCII source file into an executable object file. (If you want to see these steps for yourself, run <span class="pcalibre1 pcalibre29 pcalibre2">gcc </span>with the -<code id="P7000497027000000000000000044793" data-uri="chapter07.xhtml#P7000497027000000000000000044793" class="pcalibre1 calibre1 pcalibre2">v</code> option.) The driver first runs the C preprocessor (<code id="P7000497027000000000000000044794" data-uri="chapter07.xhtml#P7000497027000000000000000044794" class="pcalibre1 calibre1 pcalibre2">cpp</code>),<a class="pcalibre1 pcalibre2 pcalibre56 pcalibre16 pcalibre14 pcalibre15" id="r__P7000497027000000000000000006662" epub:type="noteref" href="#P7000497027000000000000000006662">1</a> which translates the C source file <code id="P7000497027000000000000000044795" data-uri="chapter07.xhtml#P7000497027000000000000000044795" class="pcalibre1 calibre1 pcalibre2">main.c</code> into an ASCII intermediate file <code id="P7000497027000000000000000044796" data-uri="chapter07.xhtml#P7000497027000000000000000044796" class="pcalibre1 calibre1 pcalibre2">main.i</code>:</p><aside class="pcalibre2 pcalibre32 pcalibre57" id="P7000497027000000000000000006662" data-uri="chapter07.xhtml#P7000497027000000000000000006662" epub:type="footnote"><p class="pcalibre1 pcalibre2 pcalibre10"><span class="pcalibre1 pcalibre58 pcalibre2"><a href="#r__P7000497027000000000000000006662" class="pcalibre1 pcalibre2 pcalibre16 pcalibre14 pcalibre15 pcalibre13">1. </a></span>In some versions of <span class="pcalibre1 pcalibre29 pcalibre2">gcc</span>, the preprocessor is integrated into the compiler driver.</p></aside>
<figure class="pcalibre2 pcalibre32 pcalibre35" id="P7000497027000000000000000006011" data-uri="chapter07.xhtml#P7000497027000000000000000006011">
<span class="pcalibre1 pcalibre2 pcalibre5" id="P7000497027000000000000000006012" title="672" data-uri="chapter07.xhtml#P7000497027000000000000000006012" epub:type="pagebreak"></span>
<img alt="A diagram illustrates static linking." id="P7000497027000000000000000044797" data-uri="P700049702700000000000000000B758" src="../images/p672-1.png" class="pcalibre1 pcalibre2 pcalibre234"/>
<figcaption id="P7000497027000000000000000044798" data-uri="chapter07.xhtml#P7000497027000000000000000044798" class="pcalibre1 pcalibre2 calibre4"><header class="pcalibre1 pcalibre2 pcalibre3"><h1 class="pcalibre1 pcalibre2 pcalibre36" id="P7000497027000000000000000044799" data-uri="chapter07.xhtml#P7000497027000000000000000044799" epub:type="title"><span class="label pcalibre1 pcalibre2">Figure </span><span class="pcalibre1 pcalibre2 pcalibre37">7.2 </span>Static linking.</h1></header>
<div class="pcalibre1 pcalibre2 pcalibre7" id="P700049702700000000000000004479A" data-uri="chapter07.xhtml#P700049702700000000000000004479A"><p id="P700049702700000000000000004479B" data-uri="chapter07.xhtml#P700049702700000000000000004479B" class="pcalibre1 pcalibre2 pcalibre10">The linker combines relocatable object files to form an executable object file <code id="P700049702700000000000000004479C" data-uri="chapter07.xhtml#P700049702700000000000000004479C" class="pcalibre1 calibre1 pcalibre2">prog</code>.</p></div>
<details class="pcalibre1 pcalibre2 pcalibre59" id="P7000497027000000000000000024AAC" data-uri="chapter07.xhtml#P7000497027000000000000000024AAC">
<summary class="pcalibre1 pcalibre2 pcalibre61 pcalibre60"><span class="pcalibre1 pcalibre2 pcalibre37">Description</span></summary>
<p id="P700049702700000000000000004479D" data-uri="chapter07.xhtml#P700049702700000000000000004479D" class="pcalibre8 pcalibre1 pcalibre2">A diagram shows a flow through the following:</p>
<ul id="P700049702700000000000000004479E" data-uri="chapter07.xhtml#P700049702700000000000000004479E" class="pcalibre1 pcalibre2 pcalibre62">
<li id="P700049702700000000000000004479F" data-uri="chapter07.xhtml#P700049702700000000000000004479F" class="pcalibre39 pcalibre2 pcalibre1"><p id="P70004970270000000000000000447A0" data-uri="chapter07.xhtml#P70004970270000000000000000447A0" class="pcalibre1 pcalibre2 pcalibre10">Source files main.c and sum.c</p></li>
<li id="P70004970270000000000000000447A1" data-uri="chapter07.xhtml#P70004970270000000000000000447A1" class="pcalibre39 pcalibre2 pcalibre1"><p id="P70004970270000000000000000447A2" data-uri="chapter07.xhtml#P70004970270000000000000000447A2" class="pcalibre1 pcalibre2 pcalibre10">Translators (cpp, cc1, as), one each from main.c and sum.c</p></li>
<li id="P70004970270000000000000000447A3" data-uri="chapter07.xhtml#P70004970270000000000000000447A3" class="pcalibre39 pcalibre2 pcalibre1"><p id="P70004970270000000000000000447A4" data-uri="chapter07.xhtml#P70004970270000000000000000447A4" class="pcalibre1 pcalibre2 pcalibre10">Relocatable object files: main.o from translator from main.c and sum.o from translator from sum.c</p></li>
<li id="P70004970270000000000000000447A5" data-uri="chapter07.xhtml#P70004970270000000000000000447A5" class="pcalibre39 pcalibre2 pcalibre1"><p id="P70004970270000000000000000447A6" data-uri="chapter07.xhtml#P70004970270000000000000000447A6" class="pcalibre1 pcalibre2 pcalibre10">Linker (ld) from relocatable object files</p></li>
<li id="P70004970270000000000000000447A7" data-uri="chapter07.xhtml#P70004970270000000000000000447A7" class="pcalibre39 pcalibre2 pcalibre1"><p id="P70004970270000000000000000447A8" data-uri="chapter07.xhtml#P70004970270000000000000000447A8" class="pcalibre1 pcalibre2 pcalibre10">Fully linked executable object file: prog</p></li>
</ul>
</details>
</figcaption>
</figure>
<pre id="P70004970270000000000000000447A9" data-uri="chapter07.xhtml#P70004970270000000000000000447A9" class="calibre2 pcalibre2 pcalibre1"><code id="P70004970270000000000000000447AA" data-uri="chapter07.xhtml#P70004970270000000000000000447AA" class="calibre3 pcalibre1 pcalibre2">cpp [<i class="pcalibre17 pcalibre2 pcalibre1">other arguments</i>] main.c /tmp/main.i</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" id="P70004970270000000000000000447AB" data-uri="chapter07.xhtml#P70004970270000000000000000447AB">Next, the driver runs the C compiler (<code id="P70004970270000000000000000447AC" data-uri="chapter07.xhtml#P70004970270000000000000000447AC" class="pcalibre1 calibre1 pcalibre2">cc1</code>), which translates <code id="P70004970270000000000000000447AD" data-uri="chapter07.xhtml#P70004970270000000000000000447AD" class="pcalibre1 calibre1 pcalibre2">main.i</code> into an ASCII assembly-language file <code id="P70004970270000000000000000447AE" data-uri="chapter07.xhtml#P70004970270000000000000000447AE" class="pcalibre1 calibre1 pcalibre2">main.s</code>:</p>
<pre id="P70004970270000000000000000447AF" data-uri="chapter07.xhtml#P70004970270000000000000000447AF" class="calibre2 pcalibre2 pcalibre1"><code id="P70004970270000000000000000447B0" data-uri="chapter07.xhtml#P70004970270000000000000000447B0" class="calibre3 pcalibre1 pcalibre2">cc1 /tmp/main.i -0g [<i class="pcalibre17 pcalibre2 pcalibre1">other arguments</i>] -o /tmp/main.s</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" id="P70004970270000000000000000447B1" data-uri="chapter07.xhtml#P70004970270000000000000000447B1">Then, the driver runs the assembler (as), which translates <code id="P70004970270000000000000000447B2" data-uri="chapter07.xhtml#P70004970270000000000000000447B2" class="pcalibre1 calibre1 pcalibre2">main.s</code> into a binary <i class="pcalibre17 pcalibre2 pcalibre1">relocatable object file</i> <code id="P70004970270000000000000000447B3" data-uri="chapter07.xhtml#P70004970270000000000000000447B3" class="pcalibre1 calibre1 pcalibre2">main.o:</code></p>
<pre id="P70004970270000000000000000447B4" data-uri="chapter07.xhtml#P70004970270000000000000000447B4" class="calibre2 pcalibre2 pcalibre1"><code id="P70004970270000000000000000447B5" data-uri="chapter07.xhtml#P70004970270000000000000000447B5" class="calibre3 pcalibre1 pcalibre2">as [<i class="pcalibre17 pcalibre2 pcalibre1">other arguments</i>] -o /tmp/main.o /tmp/main.s</code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" id="P70004970270000000000000000447B6" data-uri="chapter07.xhtml#P70004970270000000000000000447B6">The driver goes through the same process to generate <code id="P70004970270000000000000000447B7" data-uri="chapter07.xhtml#P70004970270000000000000000447B7" class="pcalibre1 calibre1 pcalibre2">sum.o.</code> Finally, it runs the linker program <code id="P70004970270000000000000000447B8" data-uri="chapter07.xhtml#P70004970270000000000000000447B8" class="pcalibre1 calibre1 pcalibre2">ld</code>, which combines <code id="P70004970270000000000000000447B9" data-uri="chapter07.xhtml#P70004970270000000000000000447B9" class="pcalibre1 calibre1 pcalibre2">main.o</code> and <code id="P70004970270000000000000000447BA" data-uri="chapter07.xhtml#P70004970270000000000000000447BA" class="pcalibre1 calibre1 pcalibre2">sum.o</code>, along with the necessary system object files, to create the binary <i class="pcalibre17 pcalibre2 pcalibre1">executable object file</i> <code id="P70004970270000000000000000447BB" data-uri="chapter07.xhtml#P70004970270000000000000000447BB" class="pcalibre1 calibre1 pcalibre2">prog</code>:</p>
<pre id="P70004970270000000000000000447BC" data-uri="chapter07.xhtml#P70004970270000000000000000447BC" class="calibre2 pcalibre2 pcalibre1"><code id="P70004970270000000000000000447BD" data-uri="chapter07.xhtml#P70004970270000000000000000447BD" class="calibre3 pcalibre1 pcalibre2">ld -o prog [<i class="pcalibre17 pcalibre2 pcalibre1">system object files and args</i>] /tmp/main.o /tmp/sum.o</code></pre>
<p id="P70004970270000000000000000447BE" data-uri="chapter07.xhtml#P70004970270000000000000000447BE" class="pcalibre8 pcalibre1 pcalibre2">To run the executable <code id="P70004970270000000000000000447BF" data-uri="chapter07.xhtml#P70004970270000000000000000447BF" class="pcalibre1 calibre1 pcalibre2">prog</code>, we type its name on the Linux shell's command line:</p>
<pre id="P70004970270000000000000000447C0" data-uri="chapter07.xhtml#P70004970270000000000000000447C0" class="calibre2 pcalibre2 pcalibre1"><code id="P70004970270000000000000000447C1" data-uri="chapter07.xhtml#P70004970270000000000000000447C1" class="calibre3 pcalibre1 pcalibre2">linux&gt; <i class="pcalibre17 pcalibre2 pcalibre1">./prog</i></code></pre>
<p class="pcalibre8 pcalibre1 pcalibre2" id="P70004970270000000000000000447C2" data-uri="chapter07.xhtml#P70004970270000000000000000447C2">The shell invokes a function in the operating system called the <i class="pcalibre17 pcalibre2 pcalibre1">loader</i>, which copies the code and data in the executable file <code id="P70004970270000000000000000447C3" data-uri="chapter07.xhtml#P70004970270000000000000000447C3" class="pcalibre1 calibre1 pcalibre2">prog</code> into memory, and then transfers control to the beginning of the program.</p>
</section></body></html>
