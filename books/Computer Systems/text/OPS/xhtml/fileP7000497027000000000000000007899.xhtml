<?xml version='1.0' encoding='utf-8'?>
<html xmlns:m="http://www.w3.org/1998/Math/MathML" xmlns:svg="http://www.w3.org/2000/svg" xmlns:epub="http://www.idpf.org/2007/ops" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" epub:prefix="index: http://www.index.com/">
  <head>
    <meta name="dcterms.conformsTo" content="PXE Basic 1.0"/>
    <meta name="generator" content="PXE Tools version 1.39.52"/>
    <!--Created by pxe.pl for standard version PXE Basic 1.0,data-profile-product=standard by PXE Tools 1.39.52, partial=false-->
    <title>10.1 Unix I/O</title>
    <link rel="alternate stylesheet" type="text/css" title="night" href="../css/theme/night.css"/>
    <link rel="alternate stylesheet" type="text/css" title="sepia" href="../css/theme/sepia.css"/>
    <script src="js/format_lg_obj.js"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body epub:type="bodymatter" class="pcalibre1 pcalibre2 pcalibre">
<section id="P7000497027000000000000000007899" class="pcalibre1 pcalibre2 pcalibre3"><header class="pcalibre1 pcalibre2 calibre"><h1 class="pcalibre1 pcalibre2 pcalibre4" id="P7000497027000000000000000046362" data-uri="chapter10.xhtml#P7000497027000000000000000046362" epub:type="title"><span class="pcalibre1 pcalibre21 pcalibre2">10.1 </span>Unix I/O</h1></header>
<p id="P7000497027000000000000000046363" data-uri="chapter10.xhtml#P7000497027000000000000000046363" class="pcalibre8 pcalibre1 pcalibre2">A Linux <i class="pcalibre17 pcalibre2 pcalibre1">file</i> is a sequence of <var class="pcalibre17 pcalibre2 pcalibre1">m</var> bytes:</p>
<div class="pcalibre1 pcalibre2 informalequation" id="P7000497027000000000000000046364" data-uri="chapter10.xhtml#P7000497027000000000000000046364">
<m:math display="block" alttext="" data-uri="" altimg-width="221" altimg-height="19" altimg="../images/ch10-1.png"><m:mrow><m:msub><m:mi>B</m:mi><m:mn>0</m:mn></m:msub><m:mo>,</m:mo><m:mtext> </m:mtext><m:msub><m:mi>B</m:mi><m:mn>1</m:mn></m:msub><m:mo>,</m:mo><m:mtext> </m:mtext><m:mo>…</m:mo><m:mo>,</m:mo><m:mtext> </m:mtext><m:msub><m:mi>B</m:mi><m:mi>k</m:mi></m:msub><m:mo>,</m:mo><m:mtext> </m:mtext><m:mo>…</m:mo><m:mo>,</m:mo><m:mtext> </m:mtext><m:msub><m:mi>B</m:mi><m:mrow><m:mi>m</m:mi><m:mo>-</m:mo><m:mn>1</m:mn></m:mrow></m:msub></m:mrow></m:math>
</div>
<p id="P7000497027000000000000000046365" data-uri="chapter10.xhtml#P7000497027000000000000000046365" class="pcalibre8 pcalibre1 pcalibre2">All I/O devices, such as networks, disks, and terminals, are modeled as files, and all input and output is performed by reading and writing the appropriate files. This elegant mapping of devices to files allows the Linux kernel to export a simple, low-level application interface, known as <i class="pcalibre17 pcalibre2 pcalibre1">Unix I/O</i>, that enables all input and output to be performed in a uniform and consistent way:</p>
<ul class="pcalibre38 pcalibre1 pcalibre2" id="P7000497027000000000000000046366" data-uri="chapter10.xhtml#P7000497027000000000000000046366">
<li id="P7000497027000000000000000046367" data-uri="chapter10.xhtml#P7000497027000000000000000046367" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000046368" data-uri="chapter10.xhtml#P7000497027000000000000000046368" class="pcalibre1 pcalibre2 pcalibre40"><span class="pcalibre1 pcalibre2 pcalibre5" id="P70004970270000000000000000078A1" title="891" data-uri="chapter10.xhtml#P70004970270000000000000000078A1" epub:type="pagebreak"></span><span class="pcalibre1 pcalibre2 pcalibre41">Opening files. </span>An application announces its intention to access an I/O device by asking the kernel to <i class="pcalibre17 pcalibre2 pcalibre1">open</i> the corresponding file. The kernel returns a small nonnegative integer, called a <i class="pcalibre17 pcalibre2 pcalibre1">descriptor</i>, that identifies the file in all subsequent operations on the file. The kernel keeps track of all information about the open file. The application only keeps track of the descriptor.</p>
<p id="P7000497027000000000000000046369" data-uri="chapter10.xhtml#P7000497027000000000000000046369" class="pcalibre1 pcalibre2 pcalibre42">Each process created by a Linux shell begins life with three open files: <i class="pcalibre17 pcalibre2 pcalibre1">standard input</i> (descriptor 0), <i class="pcalibre17 pcalibre2 pcalibre1">standard output</i> (descriptor 1), and <i class="pcalibre17 pcalibre2 pcalibre1">standard error</i> (descriptor 2). The header file <code id="P700049702700000000000000004636A" data-uri="chapter10.xhtml#P700049702700000000000000004636A" class="pcalibre1 calibre1 pcalibre2">&lt;unistd.h&gt;</code> defines constants <code id="P700049702700000000000000004636B" data-uri="chapter10.xhtml#P700049702700000000000000004636B" class="pcalibre1 calibre1 pcalibre2">STDIN_FILENO, STDOUT_FILENO</code>, and <code id="P700049702700000000000000004636C" data-uri="chapter10.xhtml#P700049702700000000000000004636C" class="pcalibre1 calibre1 pcalibre2">STDERR_FILENO</code>, which can be used instead of the explicit descriptor values.</p></li>
<li id="P700049702700000000000000004636D" data-uri="chapter10.xhtml#P700049702700000000000000004636D" class="pcalibre39 pcalibre2 pcalibre1"><p id="P700049702700000000000000004636E" data-uri="chapter10.xhtml#P700049702700000000000000004636E" class="pcalibre1 pcalibre2 pcalibre40"><span class="pcalibre1 pcalibre2 pcalibre41">Changing the current file position. </span>The kernel maintains a <i class="pcalibre17 pcalibre2 pcalibre1">file position k</i>, initially 0, for each open file. The file position is a byte offset from the beginning of a file. An application can set the current file position <var class="pcalibre17 pcalibre2 pcalibre1">k</var> explicitly by performing a <i class="pcalibre17 pcalibre2 pcalibre1">seek</i> operation.</p></li>
<li id="P700049702700000000000000004636F" data-uri="chapter10.xhtml#P700049702700000000000000004636F" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000046370" data-uri="chapter10.xhtml#P7000497027000000000000000046370" class="pcalibre1 pcalibre2 pcalibre40"><span class="pcalibre1 pcalibre2 pcalibre41">Reading and writing files. </span>A <i class="pcalibre17 pcalibre2 pcalibre1">read</i> operation copies <var class="pcalibre17 pcalibre2 pcalibre1">n</var> &gt; 0 bytes from a file to memory, starting at the current file position <var class="pcalibre17 pcalibre2 pcalibre1">k</var> and then incrementing <var class="pcalibre17 pcalibre2 pcalibre1">k</var> by <var class="pcalibre17 pcalibre2 pcalibre1">n</var>. Given a file with a size of <var class="pcalibre17 pcalibre2 pcalibre1">m</var> bytes, performing a read operation when <var class="pcalibre17 pcalibre2 pcalibre1">k</var> ≥ <var class="pcalibre17 pcalibre2 pcalibre1">m</var> triggers a condition known as <i class="pcalibre17 pcalibre2 pcalibre1">end-of-file (EOF)</i>, which can be detected by the application. There is no explicit "EOF character" at the end of a file.</p>
<p id="P7000497027000000000000000046371" data-uri="chapter10.xhtml#P7000497027000000000000000046371" class="pcalibre1 pcalibre2 pcalibre42">Similarly, a <i class="pcalibre17 pcalibre2 pcalibre1">write</i> operation copies <var class="pcalibre17 pcalibre2 pcalibre1">n</var> &gt; 0 bytes from memory to a file, starting at the current file position <var class="pcalibre17 pcalibre2 pcalibre1">k</var> and then updating <var class="pcalibre17 pcalibre2 pcalibre1">k</var>.</p></li>
<li id="P7000497027000000000000000046372" data-uri="chapter10.xhtml#P7000497027000000000000000046372" class="pcalibre39 pcalibre2 pcalibre1"><p id="P7000497027000000000000000046373" data-uri="chapter10.xhtml#P7000497027000000000000000046373" class="pcalibre1 pcalibre2 pcalibre40"><span class="pcalibre1 pcalibre2 pcalibre41">Closing files. </span>When an application has finished accessing a file, it informs the kernel by asking it to <i class="pcalibre17 pcalibre2 pcalibre1">close</i> the file. The kernel responds by freeing the data structures it created when the file was opened and restoring the descriptor to a pool of available descriptors. When a process terminates for any reason, the kernel closes all open files and frees their memory resources.</p></li>
</ul>
</section></body></html>
